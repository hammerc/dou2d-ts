var dou;!function(){let t,e;e=Object.prototype,Object.defineProperties(e,{clearAllProperty:{value:function(){for(let t in this)delete this[t]},enumerable:!1}}),e=String.prototype,Object.defineProperties(e,{splitNum:{value:function(t,e){let i=this.split(t,e);for(let t=0,e=i.length;t<e;t++)i[t]=parseFloat(i[t]);return i},enumerable:!1}}),(t=Array).NORMAL=0,t.CASEINSENSITIVE=1,t.DESCENDING=2,t.RETURNINDEXEDARRAY=4,t.NUMERIC=8,e=Array.prototype,Object.defineProperties(e,{pushUnique:{value:function(...t){for(let e of t)-1==this.indexOf(e)&&(this[this.length]=e);return this.length},enumerable:!1},sortOn:{value:function(t,e){let i=this;Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]),t.length!==e.length&&(e=new Array(t.length).fill(0));let s=e[0]&Array.RETURNINDEXEDARRAY;s&&(i=Array.from(i));let n=t.map((function(t,i){return function(t,e){e=e||0;let i=[];t&&i.push((function(){return this[t]}));i.push(e&Array.NUMERIC?function(){return parseFloat(this)}:function(){return"string"==typeof this&&this||"number"==typeof this&&""+this||this&&this.toString()||this}),e&Array.CASEINSENSITIVE&&i.push(String.prototype.toLowerCase);i.apply=Array.prototype.reduce.bind(i,(function(t,e){return e.apply(t)}));let s=e&Array.DESCENDING?-1:1,n=-s;return function(t,e){return(t=i.apply(t))>(e=i.apply(e))||null!=t&&null==e?s:t<e||null==t&&null!=e?n:0}}(t,e[i])})),r=i.sort((function(t,e){return n.reduce((function(i,s){return i||s(t,e)}),0)}));return s?r:void 0},enumerable:!1},remove:{value:function(t){let e=this.indexOf(t);return e>-1&&(this.splice(e,1),!0)},enumerable:!1},shuffle:{value:function(){for(let t=0,e=this.length;t<e;t++){let i=Math.round(Math.random()*(e-1)),s=this[t];this[t]=this[i],this[i]=s}return this},enumerable:!1}}),e=Date.prototype,Object.defineProperties(e,{format:{value:function(t){let e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(let i in e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("00"+e[i]).substr((""+e[i]).length)));return t},enumerable:!1}})}(),function(t){class e{constructor(){this._lastTimeStamp=0,this._paused=!1,e.$startTime=Date.now(),this._frameRateList=[60,30,20,15,12,10,6,5,4,3,2,1],this.frameRate=60}set frameRate(t){this.setFrameRate(t),this._frameCount=60/this._frameRate,this._lastCount=0}get frameRate(){return this._frameRate}get paused(){return this._paused}setFrameRate(t){t=+t||0;for(let e=0,i=this._frameRateList.length;e<i;e++){let i=this._frameRateList[e];if(t>=i)return void(this._frameRate=i)}this._frameRate=1}pause(){this._paused=!0}resume(){this._paused=!1}update(){if(!this._paused&&(this._lastCount++,this._lastCount>=this._frameCount)){this._lastCount=0;let e=t.getTimer(),i=e-this._lastTimeStamp;this._lastTimeStamp=e,this.updateLogic(i)}}}e.$startTime=0,t.TickerBase=e}(dou||(dou={})),function(t){t.EventDispatcher=class{constructor(t){this._eventMap={},this._eventTarget=t}on(t,e,i){this.addEventListener(t,e,i,!1)}once(t,e,i){this.addEventListener(t,e,i,!0)}addEventListener(i,s,n,r){let o=this._eventMap;o.hasOwnProperty(i)||(o[i]=[]);let a=o[i];for(let t=0,e=a.length;t<e;t++){let e=a[t];if(e.listener==s&&e.thisObj==n)return!1}let h=t.recyclable(e);return h.listener=s,h.thisObj=n,h.once=r,a.push(h),!0}has(t){return this._eventMap.hasOwnProperty(t)&&this._eventMap[t].length>0}dispatch(t){return t.$setTarget(this._eventTarget||this),this.$notify(t)}$notify(t){let e=this._eventMap;if(!e.hasOwnProperty(t.type))return!0;let i=e[t.type];if(0==i.length)return!0;let s=0;for(var n=0,r=i.length;n<r;n++){let e=i[n];if(e){let r=e.listener,o=e.thisObj;e.once?(e.recycle(),i[n]=null):(s!=n&&(i[s]=e,i[n]=null),s++),r.call(o,t)}}if(s!=n){for(length=i.length;n<length;)i[s++]=i[n++];i.length=s}return t.$setTarget(null),!t.$isDefaultPrevented()}off(t,e,i){let s=this._eventMap;if(s.hasOwnProperty(t)){let n=s[t];for(let t=0,s=n.length;t<s;t++){let s=n[t];if(s&&s.listener==e&&s.thisObj==i){s.recycle(),n[t]=null;break}}}}};class e{onRecycle(){this.listener=this.thisObj=this.once=null}}}(dou||(dou={})),Object.defineProperties(dou.EventDispatcher.prototype,{dispatchEvent:{value:function(t,e,i){let s=dou.recyclable(dou.Event);s.$initEvent(t,e,i);let n=this.dispatch(s);return s.recycle(),n},enumerable:!1}}),function(t){class e{constructor(){this._isDefaultPrevented=!1}get type(){return this._type}get data(){return this._data}get cancelable(){return this._cancelable}get target(){return this._target}$initEvent(t,e,i){this._type=t,this._data=e,this._cancelable=i}$setTarget(t){this._target=t}preventDefault(){this._cancelable&&(this._isDefaultPrevented=!0)}$isDefaultPrevented(){return this._isDefaultPrevented}onRecycle(){this._type=null,this._data=null,this._cancelable=null,this._isDefaultPrevented=!1,this._target=null}}e.OPEN="open",e.CHANGE="change",e.COMPLETE="complete",e.SOUND_COMPLETE="soundComplete",e.MESSAGE="message",e.CLOSE="close",t.Event=e}(dou||(dou={})),Object.defineProperties(dou.EventDispatcher.prototype,{dispatchIOErrorEvent:{value:function(t,e,i){let s=dou.recyclable(dou.IOErrorEvent);s.$initIOErrorEvent(t,e,i);let n=this.dispatch(s);return s.recycle(),n},enumerable:!1}}),function(t){class e extends t.Event{get msg(){return this._msg}$initIOErrorEvent(t,e,i){this.$initEvent(t,null,i),this._msg=e}onRecycle(){super.onRecycle(),this._msg=null}}e.IO_ERROR="ioError",t.IOErrorEvent=e}(dou||(dou={})),Object.defineProperties(dou.EventDispatcher.prototype,{dispatchProgressEvent:{value:function(t,e,i,s){let n=dou.recyclable(dou.ProgressEvent);n.$initProgressEvent(t,e,i,s);let r=this.dispatch(n);return n.recycle(),r},enumerable:!1}}),function(t){class e extends t.Event{get loaded(){return this._loaded}get total(){return this._total}$initProgressEvent(t,e,i,s){this.$initEvent(t,null,s),this._loaded=e,this._total=i}onRecycle(){super.onRecycle(),this._loaded=null,this._total=null}}e.PROGRESS="progress",t.ProgressEvent=e}(dou||(dou={})),function(t){t.RequestAnalyzerBase=class{load(e,i,s){let n=new t.HttpRequest;n.responseType=this.getResponseType(),n.on(t.Event.COMPLETE,t=>{i.call(s,e,this.dataAnalyze(n.response))},this),n.on(t.IOErrorEvent.IO_ERROR,t=>{i.call(s,e)},this),n.open(e,t.HttpMethod.GET),n.send()}release(t){return!0}}}(dou||(dou={})),function(t){class e extends t.RequestAnalyzerBase{getResponseType(){return t.HttpResponseType.text}dataAnalyze(t){return t}}t.TextAnalyzer=e}(dou||(dou={})),function(t){class e extends t.RequestAnalyzerBase{getResponseType(){return t.HttpResponseType.text}dataAnalyze(t){return JSON.parse(t)}}t.JsonAnalyzer=e}(dou||(dou={})),function(t){class e extends t.RequestAnalyzerBase{getResponseType(){return t.HttpResponseType.arraybuffer}dataAnalyze(e){return new t.ByteArray(e)}}t.BytesAnalyzer=e}(dou||(dou={})),function(t){t.SoundAnalyzer=class{load(e,i,s){let n=new t.Sound;n.on(t.Event.COMPLETE,()=>{i.call(s,e,n)}),n.on(t.IOErrorEvent.IO_ERROR,()=>{i.call(s,e)}),n.load(e)}release(t){return!!t&&(t.close(),!0)}}}(dou||(dou={})),function(t){class e{constructor(){this._maxLoadingThread=5,this._resourceRoot="",this._nowLoadingThread=0,this._analyzerMap={},this._extensionMap={},this._priorityList=[],this._priorityMap={},this._keyMap={},this._loadingMap={},this._cacheTypeMap={},this._cacheDataMap={}}static get instance(){return e._instance||(e._instance=new e)}set maxLoadingThread(t){this._maxLoadingThread=t}get maxLoadingThread(){return this._maxLoadingThread}set resourceRoot(t){this._resourceRoot=t||""}get resourceRoot(){return this._resourceRoot}registerAnalyzer(t,e){this._analyzerMap[t]=e}registerExtension(t,e){this._extensionMap[t]=e}load(t,e,i,s,n=0,r=!0){if(this.isLoaded(t))return void e.call(i,this.get(t),t);if(s||(s=this.getDefaultType(t)),!this._analyzerMap[s])return void console.error(`Can not find resource type: "${s}"`);let o={url:t,type:s,priority:n,cache:r,callback:e,thisObj:i};this._priorityMap[n]||(this._priorityList.push(n),this._priorityList.sort(this.sortFunc),this._priorityMap[n]=[]),this._priorityMap[n].push(o),this._keyMap[o.url]||(this._keyMap[o.url]=[]),this._keyMap[o.url].push(o),this.loadNext()}getDefaultType(t){let e,i=/\.(\w+)\?|\.(\w+)$/.exec(t);return i&&(e=i[1]||i[2]),this._extensionMap.hasOwnProperty(e)?this._extensionMap[e]:e}sortFunc(t,e){return e-t}loadNext(){if(this._nowLoadingThread>=this._maxLoadingThread)return;let t;for(let e of this._priorityList){let i=this._priorityMap[e];if(i.length>0){t=i.shift();break}}if(t)if(this._loadingMap[t.url])this.loadNext();else{this._nowLoadingThread++,this._loadingMap[t.url]=!0,this._analyzerMap[t.type].load(this._resourceRoot+t.url,(t,e)=>{this._nowLoadingThread--,delete this._loadingMap[t];let i=this._keyMap[t];if(i&&i.length>0){for(let s of i){if(this._priorityMap[s.priority]){let t=this._priorityMap[s.priority],e=t.indexOf(s);-1!=e&&t.splice(e,1)}s.cache&&e&&(this._cacheTypeMap[s.url]=s.type,this._cacheDataMap[s.url]=e),s.callback&&s.callback.call(s.thisObj,e,t)}delete this._keyMap[t]}this.loadNext()},this)}}loadAsync(t,e,i=0,s=!0){return new Promise((n,r)=>{this.load(t,(t,e)=>{t?n(t):r("Load Error: "+e)},this,e,i,s)})}loadGroup(t,e,i){let s=0,n=t.length,r=(t,r)=>{s++,e.call(i,s,n,t,r)};for(let e of t)this.load(e.url,r,this,e.type,e.priority,e.cache)}loadGroupAsync(t){return new Promise((e,i)=>{this.loadGroup(t,(t,i,s,n)=>{t==i&&e()},this)})}isLoaded(t){return this._cacheDataMap.hasOwnProperty(t)}get(t){return this._cacheDataMap[t]}release(t){if(this.isLoaded(t)){let e=this._cacheTypeMap[t],i=this._analyzerMap[e];if(!i)return!1;let s=this._cacheDataMap[t],n=i.release(s);return n&&(delete this._cacheTypeMap[t],delete this._cacheDataMap[t]),n}return!1}}t.LoadManager=e,t.loader=e.instance}(dou||(dou={})),function(t){!function(e){class i extends t.EventDispatcher{constructor(t){super(t)}static pop(t){let e=i._audios[t];return e&&e.length>0?e.pop():null}static recycle(t,e){if(i._clearAudios[t])return;let s=i._audios[t];null==i._audios[t]&&(s=i._audios[t]=[]),s.push(e)}static clear(t){i._clearAudios[t]=!0;let e=i._audios[t];e&&(e.length=0)}get length(){if(this._originAudio)return this._originAudio.duration;throw new Error("Sound not loaded.")}load(e){this._url=e;let s=new Audio(e);s.addEventListener("canplaythrough",o),s.addEventListener("error",a);let n=navigator.userAgent.toLowerCase();n.indexOf("firefox")>=0&&(s.autoplay=!0,s.muted=!0),s.load(),this._originAudio=s,i._clearAudios[this._url]&&delete i._clearAudios[this._url];let r=this;function o(){i.recycle(r._url,s),h(),n.indexOf("firefox")>=0&&(s.pause(),s.muted=!1),r._loaded=!0,r.dispatchEvent(t.Event.COMPLETE)}function a(){h(),r.dispatchIOErrorEvent(t.IOErrorEvent.IO_ERROR,`Audio Error: ${r._url}`)}function h(){s.removeEventListener("canplaythrough",o),s.removeEventListener("error",a)}}play(t,s){if(!this._loaded)return void console.error("In the absence of sound is not allowed to play after loading.");let n=i.pop(this._url);n||(n=this._originAudio.cloneNode()),n.autoplay=!0;let r=new e.AudioSoundChannel(n);return r.url=this._url,r.loops=s,r.startTime=t,r.play(),r}close(){this._loaded&&this._originAudio&&(this._originAudio.src=""),this._originAudio&&(this._originAudio=null),i.clear(this._url),this._loaded=!1}}i._audios={},i._clearAudios={},e.AudioSound=i}(t.impl||(t.impl={}))}(dou||(dou={})),function(t){!function(e){class i extends t.EventDispatcher{constructor(e){super(),this.startTime=0,this._isStopped=!1,this._volume=1,this._canPlay=()=>{this._audio.removeEventListener("canplay",this._canPlay);try{this._audio.currentTime=this.startTime}catch(t){}finally{this._audio.play()}},this._onPlayEnd=()=>{if(1==this.loops)return this.stop(),void this.dispatchEvent(t.Event.SOUND_COMPLETE);this.loops>0&&this.loops--,this.play()},this._audio=e,e.addEventListener("ended",this._onPlayEnd)}set volume(t){this._isStopped?console.error("Sound has stopped, please recall Sound.play () to play the sound."):(this._volume=t,this._audio&&(this._audio.volume=t))}get volume(){return this._volume}get position(){return this._audio?this._audio.currentTime:0}play(){if(this._isStopped)console.error("Sound has stopped, please recall Sound.play () to play the sound.");else{try{this._audio.volume=this._volume,this._audio.currentTime=this.startTime}catch(t){return void this._audio.addEventListener("canplay",this._canPlay)}this._audio.play()}}stop(){if(!this._audio)return;this._isStopped=!0;let t=this._audio;t.removeEventListener("ended",this._onPlayEnd),t.removeEventListener("canplay",this._canPlay),t.volume=0,this._volume=0,this._audio=null;let i=this.url;window.setTimeout(()=>{t.pause(),e.AudioSound.recycle(i,t)},200)}}e.AudioSoundChannel=i}(t.impl||(t.impl={}))}(dou||(dou={})),function(t){!function(t){let e;!function(t){let e,i,s;t.init=function(t){e=t},t.getContext=function(){return this._context},t.addDecode=function(t){i.push(t)},t.decode=function t(){if(i.length<=0)return;if(s)return;s=!0;let n=i.shift();e.decodeAudioData(n.buffer,e=>{n.self.audioBuffer=e,n.success&&n.success(),s=!1,t()},()=>{console.warn("Sound decode error."),n.fail&&n.fail(),s=!1,t()})}}(e=t.AudioAPIDecode||(t.AudioAPIDecode={}))}(t.impl||(t.impl={}))}(dou||(dou={})),function(t){!function(e){class i extends t.EventDispatcher{constructor(t){super(t),this._loaded=!1}get length(){if(this._audioBuffer)return this._audioBuffer.duration;throw new Error("sound not loaded!")}load(i){this._url=i;let s=this,n=new XMLHttpRequest;function r(){s._loaded=!0,s.dispatchEvent(t.Event.COMPLETE)}function o(){s.dispatchIOErrorEvent(t.IOErrorEvent.IO_ERROR,`Audio Error: ${s._url}`)}n.open("GET",i,!0),n.responseType="arraybuffer",n.addEventListener("load",(function(){n.status>=400?s.dispatchIOErrorEvent(t.IOErrorEvent.IO_ERROR,`Audio Error: ${s._url}`):(e.AudioAPIDecode.addDecode({buffer:n.response,success:r,fail:o,self:s}),e.AudioAPIDecode.decode())})),n.addEventListener("error",(function(){s.dispatchIOErrorEvent(t.IOErrorEvent.IO_ERROR,`Audio Error: ${s._url}`)})),n.send()}play(t,i){if(!this._loaded)return void console.error("In the absence of sound is not allowed to play after loading.");let s=new e.AudioAPISoundChannel;return s.url=this._url,s.loops=i,s.audioBuffer=this._audioBuffer,s.startTime=t,s.play(),s}close(){}}e.AudioAPISound=i}(t.impl||(t.impl={}))}(dou||(dou={})),function(t){!function(e){class i extends t.EventDispatcher{constructor(){super(),this.startTime=0,this._isStopped=!1,this._recordStartTime=0,this._volume=1,this._onPlayEnd=()=>{if(1==this.loops)return this.stop(),void this.dispatchEvent(t.Event.SOUND_COMPLETE);this.loops>0&&this.loops--,this.play()},this._context=e.AudioAPIDecode.getContext(),this._context.createGain?this._gain=this._context.createGain():this._gain=this._context.createGainNode()}set volume(t){this._isStopped?console.error("Sound has stopped, please recall Sound.play () to play the sound."):(this._volume=t,this._gain.gain.value=t)}get volume(){return this._volume}get position(){return this._bufferSource?(Date.now()-this._recordStartTime)/1e3+this.startTime:0}play(){if(this._isStopped)return void console.error("Sound has stopped, please recall Sound.play () to play the sound.");this._bufferSource&&(this._bufferSource.onended=null,this._bufferSource=null);let t=this._context,e=this._gain,i=t.createBufferSource();this._bufferSource=i,i.buffer=this.audioBuffer,i.connect(e),e.connect(t.destination),i.onended=this._onPlayEnd,this._recordStartTime=Date.now(),this._gain.gain.value=this._volume,i.start(0,this.startTime)}stop(){if(this._bufferSource){let t=this._bufferSource;t.stop?t.stop(0):t.noteOff(0),t.onended=null,t.disconnect(),this._bufferSource=null,this.audioBuffer=null}this._isStopped=!0}}e.AudioAPISoundChannel=i}(t.impl||(t.impl={}))}(dou||(dou={})),function(t){!function(t){let e;try{e=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}catch(t){}e?(t.AudioAPIDecode.init(e),t.soundImpl=t.AudioAPISound):t.soundImpl=t.AudioSound}(t.impl||(t.impl={}))}(dou||(dou={})),function(t){t.Sound=class{constructor(){this._impl=new t.impl.soundImpl(this)}get length(){return this._impl.length}load(t){this._impl.load(t)}play(t,e){return this._impl.play(t,e)}close(){return this._impl.close()}on(t,e,i){this._impl.on(t,e,i)}once(t,e,i){this._impl.once(t,e,i)}has(t){return this._impl.has(t)}dispatch(t){return this._impl.dispatch(t)}off(t,e,i){this._impl.off(t,e,i)}}}(dou||(dou={})),function(t){let e;!function(t){t[t.GET=0]="GET",t[t.POST=1]="POST"}(e=t.HttpMethod||(t.HttpMethod={}))}(dou||(dou={})),function(t){let e;!function(t){t[t.arraybuffer=1]="arraybuffer",t[t.blob=2]="blob",t[t.document=3]="document",t[t.json=4]="json",t[t.text=5]="text"}(e=t.HttpResponseType||(t.HttpResponseType={}))}(dou||(dou={})),function(t){class e extends t.EventDispatcher{constructor(){super()}set responseType(t){this._responseType=t}get responseType(){return this._responseType}set withCredentials(t){this._withCredentials=t}get withCredentials(){return this._withCredentials}get response(){return this._xhr?this._xhr.response:null}setRequestHeader(t,e){this._headerMap||(this._headerMap={}),this._headerMap[t]=e}getResponseHeader(t){return this._headerMap[t]}getAllResponseHeaders(){return this._headerMap}open(e,i=t.HttpMethod.GET){this._url=e,this._method=i,this._xhr&&(this._xhr.abort(),this._xhr=null),this._xhr=new XMLHttpRequest,this._xhr.onreadystatechange=this.onReadyStateChange.bind(this),this._xhr.onprogress=this.updateProgress.bind(this),this._xhr.open(t.HttpMethod[this._method],this._url,!0)}send(e){if(this._responseType&&(this._xhr.responseType=t.HttpResponseType[this._responseType]),this._withCredentials&&(this._xhr.withCredentials=!0),this._headerMap)for(let t in this._headerMap)this._xhr.setRequestHeader(t,this._headerMap[t]);this._xhr.send(e)}onReadyStateChange(e){let i=this._xhr;if(4==i.readyState){let e=i.status>=400||0==i.status;setTimeout(()=>{e?this.dispatchIOErrorEvent(t.IOErrorEvent.IO_ERROR,`Request Error: ${this._url}`):this.dispatchEvent(t.Event.COMPLETE)},0)}}updateProgress(e){e.lengthComputable&&this.dispatchProgressEvent(t.ProgressEvent.PROGRESS,e.loaded,e.total)}abort(){this._xhr&&(this._xhr.abort(),this._xhr=null),this._url=null,this._method=null}}t.HttpRequest=e}(dou||(dou={})),function(t){class e extends t.EventDispatcher{set crossOrigin(t){this._crossOrigin=t}get crossOrigin(){return this._crossOrigin}get data(){return this._data}load(t){this._data=null;let i=this._currentImage=new Image;null!==this._crossOrigin?this._crossOrigin&&(i.crossOrigin="anonymous"):e.crossOrigin&&(i.crossOrigin="anonymous"),i.onload=this.onLoad.bind(this),i.onerror=this.onError.bind(this),i.src=t}getImage(t){return t.onload=t.onerror=null,this._currentImage===t?(this._data=t,this._currentImage=null,t):null}onLoad(e){this.getImage(e.target)&&setTimeout(()=>{this.dispatchEvent(t.Event.COMPLETE)},0)}onError(e){let i=this.getImage(e.target);i&&setTimeout(()=>{this.dispatchIOErrorEvent(t.IOErrorEvent.IO_ERROR,`Image load error: ${i.src}`)},0)}}e.crossOrigin=!1,t.ImageLoader=e}(dou||(dou={})),function(t){class e extends t.EventDispatcher{constructor(t,e){super(),this._endian=1,this._connected=!1,this._cacheInput=!0,this._addInputPosition=0,t&&e>0&&e<65535&&this.connect(t,e)}set endian(t){this._endian=t}get endian(){return this._endian}get input(){return this._input}get output(){return this._output}get url(){return this._url}get connected(){return this._connected}set cacheInput(t){this._cacheInput=t}get cacheInput(){return this._cacheInput}connect(t,e){let i;i="https:"==window.location.protocol?"wss://"+t+":"+e:"ws://"+t+":"+e,this.connectByUrl(i)}connectByUrl(e){this._webSocket&&this.close(),this._url=e,this._webSocket=new WebSocket(e),this._webSocket.binaryType="arraybuffer",this._input=new t.ByteArray,this._input.endian=this.endian,this._output=new t.ByteArray,this._output.endian=this.endian,this._addInputPosition=0,this._webSocket.onopen=t=>{this.onOpen(t)},this._webSocket.onmessage=t=>{this.onMessage(t)},this._webSocket.onclose=t=>{this.onClose(t)},this._webSocket.onerror=t=>{this.onError(t)}}onOpen(e){this._connected=!0,this.dispatchEvent(t.Event.OPEN)}onMessage(e){if(!e||!e.data)return;let i=e.data;if(!this._cacheInput&&i)return void this.dispatchEvent(t.Event.MESSAGE,i);this._input.length>0&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);let s=this._input.position;this._addInputPosition||(this._addInputPosition=0),this._input.position=this._addInputPosition,i&&("string"==typeof i?this._input.writeUTFBytes(i):this._input.writeUint8Array(new Uint8Array(i)),this._addInputPosition=this._input.position,this._input.position=s),this.dispatchEvent(t.Event.MESSAGE,i)}onClose(e){this._connected=!1,this.dispatchEvent(t.Event.CLOSE)}onError(e){this.dispatchIOErrorEvent(t.IOErrorEvent.IO_ERROR,`Socket connect error: ${this._url}`)}send(t){this._webSocket.send(t)}flush(){if(this._output&&this._output.length>0){let e;try{this._webSocket&&this._webSocket.send(this._output.buffer)}catch(t){e=t}this._output.endian=this.endian,this._output.clear(),e&&this.dispatchIOErrorEvent(t.IOErrorEvent.IO_ERROR,`Socket connect error: ${this._url}`)}}close(){this._webSocket&&this.cleanSocket()}cleanSocket(){this._webSocket.close(),this._connected=!1,this._webSocket.onopen=null,this._webSocket.onmessage=null,this._webSocket.onclose=null,this._webSocket.onerror=null,this._webSocket=null,this._url=null}}t.Socket=e}(dou||(dou={})),function(t){let e;!function(t){function e(t){return function(e){return Math.pow(e,t)}}function i(t){return function(e){return 1-Math.pow(1-e,t)}}function s(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}var n;function r(t){return 1-o(1-t)}function o(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}t.quadIn=e(2),t.quadOut=i(2),t.quadInOut=s(2),t.cubicIn=e(3),t.cubicOut=i(3),t.cubicInOut=s(3),t.quartIn=e(4),t.quartOut=i(4),t.quartInOut=s(4),t.quintIn=e(5),t.quintOut=i(5),t.quintInOut=s(5),t.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)},t.sineOut=function(t){return Math.sin(t*Math.PI/2)},t.sineInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},t.backIn=(n=1.7,function(t){return t*t*((n+1)*t-n)}),t.backOut=function(t){return function(e){return--e*e*((t+1)*e+t)+1}}(1.7),t.backInOut=function(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}(1.7),t.circIn=function(t){return-(Math.sqrt(1-t*t)-1)},t.circOut=function(t){return Math.sqrt(1- --t*t)},t.circInOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},t.bounceIn=r,t.bounceOut=o,t.bounceInOut=function(t){return t<.5?.5*r(2*t):.5*o(2*t-1)+.5},t.elasticIn=function(t,e){let i=2*Math.PI;return function(s){if(0==s||1==s)return s;let n=e/i*Math.asin(1/t);return-t*Math.pow(2,10*(s-=1))*Math.sin((s-n)*i/e)}}(1,.3),t.elasticOut=function(t,e){let i=2*Math.PI;return function(s){if(0==s||1==s)return s;let n=e/i*Math.asin(1/t);return t*Math.pow(2,-10*s)*Math.sin((s-n)*i/e)+1}}(1,.3),t.elasticInOut=function(t,e){let i=2*Math.PI;return function(s){let n=e/i*Math.asin(1/t);return(s*=2)<1?t*Math.pow(2,10*(s-=1))*Math.sin((s-n)*i/e)*-.5:t*Math.pow(2,-10*(s-=1))*Math.sin((s-n)*i/e)*.5+1}}(1,.3*1.5)}(e=t.Ease||(t.Ease={}))}(dou||(dou={})),function(t){class e extends t.EventDispatcher{constructor(t,e){super(),this._useTicks=!1,this._ignoreGlobalPause=!1,this._loop=!1,this._paused=!1,this._duration=0,this._prevPos=-1,this._prevPosition=0,this._stepPosition=0,this._passive=!1,this.initialize(t,e)}static tick(t,i=!1){let s=e._tweens.concat();for(let e=s.length-1;e>=0;e--){let n=s[e];i&&!n._ignoreGlobalPause||n._paused||n.$tick(n._useTicks?1:t)}}static get(t,i,s=!1){return s&&e.removeTweens(t),new e(t,i)}static pauseTweens(t){if(!t.tween_count)return;let i=e._tweens;for(let e=i.length-1;e>=0;e--)i[e]._target==t&&(i[e]._paused=!0)}static resumeTweens(t){if(!t.tween_count)return;let i=e._tweens;for(let e=i.length-1;e>=0;e--)i[e]._target==t&&(i[e]._paused=!1)}static removeTweens(t){if(!t.tween_count)return;let i=e._tweens;for(let e=i.length-1;e>=0;e--)i[e]._target==t&&(i[e]._paused=!0,i.splice(e,1));t.tween_count=0}static removeAllTweens(){let t=e._tweens;for(let e=0,i=t.length;e<i;e++){let i=t[e];i._paused=!0,i._target.tween_count=0}t.length=0}static _register(t,i){let s=t._target,n=e._tweens;if(i)s&&(s.tween_count=s.tween_count>0?s.tween_count+1:1),n.push(t);else{s&&s.tween_count--;let e=n.length;for(;e--;)if(n[e]==t)return void n.splice(e,1)}}initialize(i,s){this._target=i,s&&(this._useTicks=s.useTicks,this._ignoreGlobalPause=s.ignoreGlobalPause,this._loop=s.loop,s.onChange&&this.on(t.Event.CHANGE,s.onChange,s.onChangeObj),s.override&&e.removeTweens(i)),this._curQueueProps={},this._initQueueProps={},this._steps=[],s&&s.paused?this._paused=!0:e._register(this,!0),s&&s.position&&this.setPosition(s.position,e.NONE)}setPaused(t){return this._paused==t?this:(this._paused=t,e._register(this,!t),this)}wait(t,e){if(null==t||t<=0)return this;let i=this._cloneProps(this._curQueueProps);return this._addStep({d:t,p0:i,p1:i,v:e})}to(t,e,i){return(isNaN(e)||e<0)&&(e=0),this._addStep({d:e||0,p0:this._cloneProps(this._curQueueProps),e:i,p1:this._cloneProps(this._appendQueueProps(t))}),this.set(t)}call(t,e,i){return this._addAction({f:t,p:i||[],o:e||this._target})}set(t,e){return this._appendQueueProps(t),this._addAction({f:this._set,o:this,p:[t,e||this._target]})}play(t){return t||(t=this),this.call(t.setPaused,t,[!1])}pause(t){return t||(t=this),this.call(t.setPaused,t,[!0])}$tick(t){this._paused||this.setPosition(this._prevPosition+t)}setPosition(e,i=1){e<0&&(e=0);let s=e,n=!1;if(s>=this._duration)if(this._loop){var r=s%this._duration;s=s>0&&0===r?this._duration:r}else s=this._duration,n=!0;if(s==this._prevPos)return n;n&&this.setPaused(!0);let o=this._prevPos;if(this._position=this._prevPos=s,this._prevPosition=e,this._target&&this._steps.length>0){let t=this._steps.length,e=-1;for(let i=0;i<t&&!("step"==this._steps[i].type&&(e=i,this._steps[i].t<=s&&this._steps[i].t+this._steps[i].d>=s));i++);for(let n=0;n<t;n++)if("action"==this._steps[n].type)0!=i&&(this._useTicks?this._runAction(this._steps[n],s,s):1==i&&s<o?(o!=this._duration&&this._runAction(this._steps[n],o,this._duration),this._runAction(this._steps[n],0,s,!0)):this._runAction(this._steps[n],o,s));else if("step"==this._steps[n].type&&e==n){let t=this._steps[e];this._updateTargetProps(t,Math.min((this._stepPosition=s-t.t)/t.d,1))}}return this.dispatchEvent(t.Event.COMPLETE),n}_runAction(t,e,i,s=!1){let n=e,r=i;e>i&&(n=i,r=e);let o=t.t;(o==r||o>n&&o<r||s&&o==e)&&t.f.apply(t.o,t.p)}_updateTargetProps(t,e){let i,s,n,r,o;if(t||1!=e){if(this._passive=!!t.v,this._passive)return;t.e&&(e=t.e(e,0,1,1)),i=t.p0,s=t.p1}else this._passive=!1,i=s=this._curQueueProps;for(let t in this._initQueueProps)null==(n=i[t])&&(i[t]=n=this._initQueueProps[t]),null==(r=s[t])&&(s[t]=r=n),o=n==r||0==e||1==e||"number"!=typeof n?1==e?r:n:n+(r-n)*e,this._target[t]=o}_cloneProps(t){let e={};for(let i in t)e[i]=t[i];return e}_addStep(t){return t.d>0&&(t.type="step",this._steps.push(t),t.t=this._duration,this._duration+=t.d),this}_appendQueueProps(t){let e;for(let i in t)void 0===this._initQueueProps[i]?(e=this._target[i],this._initQueueProps[i]=this._curQueueProps[i]=void 0===e?null:e):e=this._curQueueProps[i];for(let i in t)e=this._curQueueProps[i],this._curQueueProps[i]=t[i];return this._curQueueProps}_addAction(t){return t.t=this._duration,t.type="action",this._steps.push(t),this}_set(t,e){for(let i in t)e[i]=t[i]}}e.NONE=0,e.LOOP=1,e.REVERSE=2,e._tweens=[],t.Tween=e}(dou||(dou={})),function(t){t.getTimer=function(){return Date.now()-t.TickerBase.$startTime}}(dou||(dou={})),function(t){t.ObjectPool=class{constructor(t,e=50){this._creator=t,this._maxCount=e,this._list=[],this._map=new Map}get size(){return this._list.length}join(t){"function"==typeof t.onRecycle&&t.onRecycle(),this._list.length<this._maxCount&&(this._map.has(t)||(this._map.set(t,!0),this._list.push(t)))}take(){let t;return 0==this._list.length?t=new this._creator:(t=this._list.pop(),this._map.delete(t),"function"==typeof t.onReuse&&t.onReuse()),t}clear(){this._list.length=0,this._map.clear()}}}(dou||(dou={})),function(t){t.recyclable=function(e){let i;if(e.hasOwnProperty("__pool"))i=e.__pool;else{let s=e.prototype.constructor.__cacheMaxCount||50;i=new t.ObjectPool(e,s);let n=e.prototype;n.hasOwnProperty("recycle")||(n.recycle=function(){i.join(this)}),e.__pool=i}return i.take()},t.deployPool=function(t,e){t.prototype.constructor.__cacheMaxCount=e}}(dou||(dou={})),function(t){t.ByteArray=class{constructor(t,e=0){this._bufferExtSize=0,this._eofByte=-1,this._eofCodePoint=-1,e<0&&(e=0),this._bufferExtSize=e;let i,s=0;if(t){let n;if(t instanceof Uint8Array?(n=t,s=t.length):(s=t.byteLength,n=new Uint8Array(t)),0==e)i=new Uint8Array(s);else{i=new Uint8Array((1+(s/e|0))*e)}i.set(n)}else i=new Uint8Array(e);this._writePosition=s,this._position=0,this._bytes=i,this._data=new DataView(i.buffer),this._endian=1}set endian(t){this._endian=t}get endian(){return this._endian}get readAvailable(){return this._writePosition-this._position}get buffer(){return this._data.buffer.slice(0,this._writePosition)}get rawBuffer(){return this._data.buffer}set buffer(t){let e,i=t.byteLength,s=new Uint8Array(t),n=this._bufferExtSize;if(0==n)e=new Uint8Array(i);else{e=new Uint8Array((1+(i/n|0))*n)}e.set(s),this._writePosition=i,this._bytes=e,this._data=new DataView(e.buffer)}get bytes(){return this._bytes}get dataView(){return this._data}set dataView(t){this.buffer=t.buffer}get bufferOffset(){return this._data.byteOffset}set position(t){this._position=t,t>this._writePosition&&(this._writePosition=t)}get position(){return this._position}set length(t){this._writePosition=t,this._data.byteLength>t&&(this._position=t),this.validateBuffer(t)}get length(){return this._writePosition}validateBuffer(t){if(this._data.byteLength<t){let e,i=this._bufferExtSize;if(0==i)e=new Uint8Array(t);else{e=new Uint8Array((1+(t/i>>0))*i)}e.set(this._bytes),this._bytes=e,this._data=new DataView(e.buffer)}}get bytesAvailable(){return this._data.byteLength-this._position}validate(t){let e=this._bytes.length;if(e>0&&this._position+t<=e)return!0;console.error("End of the file")}validateBuffer2(t){this._writePosition=t>this._writePosition?t:this._writePosition,t+=this._position,this.validateBuffer(t)}readBoolean(){if(this.validate(1))return!!this._bytes[this.position++]}readByte(){if(this.validate(1))return this._data.getInt8(this.position++)}readUnsignedByte(){if(this.validate(1))return this._bytes[this.position++]}readShort(){if(this.validate(2)){let t=this._data.getInt16(this._position,0==this._endian);return this.position+=2,t}}readUnsignedShort(){if(this.validate(2)){let t=this._data.getUint16(this._position,0==this._endian);return this.position+=2,t}}readInt(){if(this.validate(4)){let t=this._data.getInt32(this._position,0==this._endian);return this.position+=4,t}}readUnsignedInt(){if(this.validate(4)){let t=this._data.getUint32(this._position,0==this._endian);return this.position+=4,t}}readFloat(){if(this.validate(4)){let t=this._data.getFloat32(this._position,0==this._endian);return this.position+=4,t}}readDouble(){if(this.validate(8)){let t=this._data.getFloat64(this._position,0==this._endian);return this.position+=8,t}}readBytes(t,e=0,i=0){if(!t)return;let s=this._position,n=this._writePosition-s;if(n<0)return void console.error("End of the file");if(0==i)i=n;else if(i>n)return void console.error("End of the file");const r=t._position;t._position=0,t.validateBuffer2(e+i),t._position=r,t._bytes.set(this._bytes.subarray(s,s+i),e),this.position+=i}readUTF(){let t=this.readUnsignedShort();return t>0?this.readUTFBytes(t):""}readUTFBytes(t){if(!this.validate(t))return;let e=this._data,i=new Uint8Array(e.buffer,e.byteOffset+this._position,t);return this.position+=t,this.decodeUTF8(i)}decodeUTF8(t){let e,i=0,s="",n=0,r=0,o=0,a=0;for(;t.length>i;){let h=t[i++];if(h==this._eofByte)e=0!=r?this.decoderError(!1):this._eofCodePoint;else if(0==r)this.inRange(h,0,127)?e=h:(this.inRange(h,194,223)?(r=1,a=128,n=h-192):this.inRange(h,224,239)?(r=2,a=2048,n=h-224):this.inRange(h,240,244)?(r=3,a=65536,n=h-240):this.decoderError(!1),n*=Math.pow(64,r),e=null);else if(this.inRange(h,128,191))if(o+=1,n+=(h-128)*Math.pow(64,r-o),o!==r)e=null;else{let t=n,i=a;n=0,r=0,o=0,a=0,e=this.inRange(t,i,1114111)&&!this.inRange(t,55296,57343)?t:this.decoderError(!1,h)}else n=0,r=0,o=0,a=0,i--,e=this.decoderError(!1,h);null!==e&&e!==this._eofCodePoint&&(e<=65535?e>0&&(s+=String.fromCharCode(e)):(e-=65536,s+=String.fromCharCode(55296+(e>>10&1023)),s+=String.fromCharCode(56320+(1023&e))))}return s}inRange(t,e,i){return e<=t&&t<=i}decoderError(t,e){return t&&console.error("Decoding error"),e||65533}writeBoolean(t){this.validateBuffer2(1),this._bytes[this.position++]=+t}writeByte(t){this.validateBuffer2(1),this._bytes[this.position++]=255&t}writeShort(t){this.validateBuffer2(2),this._data.setInt16(this._position,t,0==this._endian),this.position+=2}writeUnsignedShort(t){this.validateBuffer2(2),this._data.setUint16(this._position,t,0==this._endian),this.position+=2}writeInt(t){this.validateBuffer2(4),this._data.setInt32(this._position,t,0==this._endian),this.position+=4}writeUnsignedInt(t){this.validateBuffer2(4),this._data.setUint32(this._position,t,0==this._endian),this.position+=4}writeFloat(t){this.validateBuffer2(4),this._data.setFloat32(this._position,t,0==this._endian),this.position+=4}writeDouble(t){this.validateBuffer2(8),this._data.setFloat64(this._position,t,0==this._endian),this.position+=8}writeBytes(t,e=0,i=0){let s;e<0||i<0||(s=0==i?t.length-e:Math.min(t.length-e,i))>0&&(this.validateBuffer2(s),this._bytes.set(t._bytes.subarray(e,e+s),this._position),this.position=this._position+s)}writeUTF(t){let e=this.encodeUTF8(t),i=e.length;this.validateBuffer2(2+i),this._data.setUint16(this._position,i,0==this._endian),this.position+=2,this.writeUint8Array(e,!1)}writeUTFBytes(t){this.writeUint8Array(this.encodeUTF8(t))}encodeUTF8(t){let e=0,i=this.stringToCodePoints(t),s=[];for(;i.length>e;){let t=i[e++];if(this.inRange(t,55296,57343))console.error(`EncodingError The code point ${t} could not be encoded`);else if(this.inRange(t,0,127))s.push(t);else{let e,i;for(this.inRange(t,128,2047)?(e=1,i=192):this.inRange(t,2048,65535)?(e=2,i=224):this.inRange(t,65536,1114111)&&(e=3,i=240),s.push(this.div(t,Math.pow(64,e))+i);e>0;){let i=this.div(t,Math.pow(64,e-1));s.push(128+i%64),e-=1}}}return new Uint8Array(s)}stringToCodePoints(t){let e=[],i=0,s=t.length;for(;i<t.length;){let n=t.charCodeAt(i);if(this.inRange(n,55296,57343))if(this.inRange(n,56320,57343))e.push(65533);else if(i==s-1)e.push(65533);else{let s=t.charCodeAt(i+1);if(this.inRange(s,56320,57343)){let t=1023&n,r=1023&s;i+=1,e.push(65536+(t<<10)+r)}else e.push(65533)}else e.push(n);i+=1}return e}writeUint8Array(t,e=!0){let i=this._position,s=i+t.length;e&&this.validateBuffer2(s),this.bytes.set(t,i),this.position=s}div(t,e){return Math.floor(t/e)}clear(){let t=new ArrayBuffer(this._bufferExtSize);this._data=new DataView(t),this._bytes=new Uint8Array(t),this._position=0,this._writePosition=0}toString(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable}}}(dou||(dou={})),function(t){let e;!function(t){function e(t,e,i,s,n,r,o){let a=new XMLHttpRequest;switch(a.onreadystatechange=()=>{if(4==a.readyState){a.status>=400||0==a.status?r&&r.call(o,a.status):s&&s.call(n,a.response)}},a.open(t,e,!0),typeof i){case"string":break;case"object":i=JSON.stringify(i);break;default:i=""+i}a.send(i)}t.addParamToUrl=function(t,e){if(e){for(let i in e){t+="&"+i+"="+e[i]}-1==t.indexOf("?")&&(t=t.replace("&","?"))}return t},t.get=function(t,i,s,n,r){e("GET",t,null,i,s,n,r)},t.post=function(t,i,s,n,r,o){e("POST",t,i,s,n,r,o)}}(e=t.HttpUtil||(t.HttpUtil={}))}(dou||(dou={})),function(t){let e;!function(t){t.loadJSSync=function(t){document.write(`<script type="text/javascript" src="${t}"><\/script>`)},t.loadJSAsync=function(t){let e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",t),document.getElementsByTagName("head")[0].appendChild(e)},t.loadJS=function(t,e,i,s,...n){let r=document.createElement("script");r.async=!1,r.src=t,e&&(r.crossOrigin="anonymous"),r.addEventListener("load",(function(){r.parentNode.removeChild(r),r.removeEventListener("load",arguments.callee,!1),i.apply(s,n)}),!1),document.body.appendChild(r)}}(e=t.ScriptUtil||(t.ScriptUtil={}))}(dou||(dou={})),function(t){let e;!function(t){t.setBit=function(t,e,i){return i?t|=1<<e:t&=~(1<<e),t},t.getBit=function(t,e){return t==(t|1<<e)},t.switchBit32=function(t,e){return t^=1<<e}}(e=t.BitUtil||(t.BitUtil={}))}(dou||(dou={})),function(t){let e;!function(t){t.substitute=function(t,...e){let i=e.length;for(let s=0;s<i;s++)t=t.replace(new RegExp("\\{"+s+"\\}","g"),e[s]);return t},t.isAllWhitespace=function(t){return/^[ \t\r\n\f]*$/.test(t)}}(e=t.StringUtil||(t.StringUtil={}))}(dou||(dou={})),function(t){t.superGetter=function(t,e,i){let s,n=t.prototype;t.hasOwnProperty("__gets__")||Object.defineProperty(t,"__gets__",{value:{}});let r=(s=t.__gets__)[i];if(r)return r.call(e);let o=Object.getPrototypeOf(n);if(null!=o){for(;!o.hasOwnProperty(i);)if(null==(o=Object.getPrototypeOf(o)))return;return r=Object.getOwnPropertyDescriptor(o,i).get,s[i]=r,r.call(e)}}}(dou||(dou={})),function(t){t.superSetter=function(t,e,i,...s){let n,r=t.prototype;t.hasOwnProperty("__sets__")||Object.defineProperty(t,"__sets__",{value:{}});let o=(n=t.__sets__)[i];if(o)return o.apply(e,s);let a=Object.getPrototypeOf(r);if(null!=a){for(;!a.hasOwnProperty(i);)if(null==(a=Object.getPrototypeOf(a)))return;o=Object.getOwnPropertyDescriptor(a,i).set,n[i]=o,o.apply(e,s)}}}(dou||(dou={}));