var dou2d;!function(t){!function(t){t.glContext="glContext",t.unpackPremultiplyAlphaWebgl="unpackPremultiplyAlphaWebgl",t.engineDefaultEmptyTexture="engineDefaultEmptyTexture",t.smoothing="smoothing"}(t.sys||(t.sys={}))}(dou2d||(dou2d={})),window.isNaN=function(t){return(t=+t)!=t},function(t){!function(t){t.markCannotUse=function(t,e,i){Object.defineProperty(t.prototype,e,{get:function(){return console.warn(`This class cannot use the property "${e}"`),i},set:function(t){console.warn(`This class cannot use the property "${e}"`)},enumerable:!0,configurable:!0})}}(t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){!function(t){t.textureScaleFactor=1,t.enterFrameCallBackList=[],t.enterFrameOnceCallBackList=[],t.fixedEnterFrameCallBackList=[],t.fixedEnterFrameOnceCallBackList=[],t.invalidateRenderFlag=!1,t.renderCallBackList=[],t.renderOnceCallBackList=[]}(t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){class e{constructor(t=1,e=0,i=0,s=1,r=0,a=0){this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=a}get scaleX(){let t=this;if(0==t.b)return t.a;let e=Math.sqrt(t.a*t.a+t.b*t.b);return this.getDeterminant()<0?-e:e}get scaleY(){let t=this;if(0==t.c)return t.d;let e=Math.sqrt(t.c*t.c+t.d*t.d);return this.getDeterminant()<0?-e:e}get skewX(){return this.d<0?Math.atan2(this.d,this.c)+t.MathUtil.PI_HALF:Math.atan2(this.d,this.c)-t.MathUtil.PI_HALF}get skewY(){return this.a<0?Math.atan2(this.b,this.a)-Math.PI:Math.atan2(this.b,this.a)}getDeterminant(){return this.a*this.d-this.b*this.c}set(t,e,i,s,r,a){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=a,this}multiply(t,e){e||(e=t,t=this);let i=t.a*e.a,s=0,r=0,a=t.d*e.d,n=t.tx*e.a+e.tx,h=t.ty*e.d+e.ty;return 0===t.b&&0===t.c&&0===e.b&&0===e.c||(i+=t.b*e.c,a+=t.c*e.b,s+=t.a*e.b+t.b*e.d,r+=t.c*e.a+t.d*e.c,n+=t.ty*e.c,h+=t.tx*e.b),this.a=i,this.b=s,this.c=r,this.d=a,this.tx=n,this.ty=h,this}premultiply(t,e){e||(e=t,t=this);let i=e.a*t.a,s=0,r=0,a=e.d*t.d,n=e.tx*t.a+t.tx,h=e.ty*t.d+t.ty;return 0===e.b&&0===e.c&&0===t.b&&0===t.c||(i+=e.b*t.c,a+=e.c*t.b,s+=e.a*t.b+e.b*t.d,r+=e.c*t.a+e.d*t.c,n+=e.ty*t.c,h+=e.tx*t.b),this.a=i,this.b=s,this.c=r,this.d=a,this.tx=n,this.ty=h,this}inverse(t){let e=(t=t||this).a,i=t.b,s=t.c,r=t.d,a=t.tx,n=t.ty;if(0==i&&0==s)return this.b=this.c=0,0==e||0==r?this.a=this.d=this.tx=this.ty=0:(e=this.a=1/e,r=this.d=1/r,this.tx=-e*a,this.ty=-r*n),this;let h=e*r-i*s;if(0==h)return this.identity(),this;h=1/h;let o=this.a=r*h;return i=this.b=-i*h,s=this.c=-s*h,r=this.d=e*h,this.tx=-(o*a+s*n),this.ty=-(i*a+r*n),this}append(t,e,i,s,r,a){let n=this.a,h=this.b,o=this.c,l=this.d;return 1==t&&0==e&&0==i&&1==s||(this.a=t*n+e*o,this.b=t*h+e*l,this.c=i*n+s*o,this.d=i*h+s*l),this.tx=r*n+a*o+this.tx,this.ty=r*h+a*l+this.ty,this}prepend(t,e,i,s,r,a){let n=this.tx;if(1!=t||0!=e||0!=i||1!=s){let r=this.a,a=this.c;this.a=r*t+this.b*i,this.b=r*e+this.b*s,this.c=a*t+this.d*i,this.d=a*e+this.d*s}return this.tx=n*t+this.ty*i+r,this.ty=n*e+this.ty*s+a,this}rotate(t){if(0!==t){let e=Math.cos(t),i=Math.sin(t),s=this.a,r=this.b,a=this.c,n=this.d,h=this.tx,o=this.ty;this.a=s*e-r*i,this.b=s*i+r*e,this.c=a*e-n*i,this.d=a*i+n*e,this.tx=h*e-o*i,this.ty=h*i+o*e}}scale(t,e){1!==t&&(this.a*=t,this.c*=t,this.tx*=t),1!==e&&(this.b*=e,this.d*=e,this.ty*=e)}translate(t,e){this.tx+=t,this.ty+=e}transformPoint(e,i,s){s=s||new t.Point;let r=this.a*e+this.c*i+this.tx,a=this.b*e+this.d*i+this.ty;return s.set(r,a),s}deltaTransformPoint(e,i){return(i=i||new t.Point).x=this.a*e.x+this.c*e.y,i.y=this.b*e.x+this.d*e.y,i}transformBounds(e,i){i=i||new t.Rectangle;let s=this.a,r=this.b,a=this.c,n=this.d,h=this.tx,o=this.ty,l=e.x,c=e.y,d=l+e.width,u=c+e.height,g=s*l+a*c+h,p=r*l+n*c+o,f=s*d+a*c+h,_=r*d+n*c+o,x=s*d+a*u+h,m=r*d+n*u+o,y=s*l+a*u+h,$=r*l+n*u+o,T=0;return g>f&&(T=g,g=f,f=T),x>y&&(T=x,x=y,y=T),i.x=Math.floor(g<x?g:x),i.width=Math.ceil((f>y?f:y)-i.x),p>_&&(T=p,p=_,_=T),m>$&&(T=m,m=$,$=T),i.y=Math.floor(p<m?p:m),i.height=Math.ceil((_>$?_:$)-i.y),i}updateScaleAndRotation(e,i,s,r){if(!(0!=s&&s!=t.MathUtil.PI_DOUBLE||0!=r&&r!=t.MathUtil.PI_DOUBLE))return this.a=e,this.b=this.c=0,void(this.d=i);let a=Math.cos(s),n=Math.sin(s);s==r?(this.a=a*e,this.b=n*e):(this.a=Math.cos(r)*e,this.b=Math.sin(r)*e),this.c=-n*i,this.d=a*i}equals(t){return this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.tx==t.tx&&this.ty==t.ty}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}clone(){return new e(this.a,this.b,this.c,this.d,this.tx,this.ty)}identity(){this.a=this.d=1,this.b=this.c=this.tx=this.ty=0}onRecycle(){this.identity()}}t.Matrix=e}(dou2d||(dou2d={})),function(t){class e{constructor(t=0,e=0){this.x=t,this.y=e}static distance(t,e){let i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}static polar(t,i,s){return(s=s||new e).x=t*Math.cos(i),s.y=t*Math.sin(i),s}static intersection(t,e,i,s,r){let a=(s.y-i.y)*(e.x-t.x)-(s.x-i.x)*(e.y-t.y);if(0==a)return!1;if(r){let n=((s.x-i.x)*(t.y-i.y)-(s.y-i.y)*(t.x-i.x))/a;r.x=t.x+n*(e.x-t.x),r.y=t.y+n*(e.y-t.y)}return!0}static lerp(t,i,s,r){return(r=r||new e).x=t.x*(1-s)+i.x*s,r.y=t.y*(1-s)+i.y*s,r}get sqrtLength(){let{x:t,y:e}=this;return t*t+e*e}get length(){let{x:t,y:e}=this;return Math.sqrt(t*t+e*e)}set(t,e){return this.x=t,this.y=e,this}add(t,e){return e||(e=t,t=this),this.x=t.x+e.x,this.y=t.y+e.y,this}subtract(t,e){return e||(e=t,t=this),this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t,e){return e||(e=t,t=this),this.x=t.x*e.x,this.y=t.y*e.y,this}addScalar(t,e){return e=e||this,this.x=e.x+t,this.y=e.y+t,this}multiplyScalar(t,e){return e=e||this,this.x=t*e.x,this.y=t*e.y,this}dot(t){return this.x*t.x+this.y*t.y}getAngle(t){let i=dou.recyclable(e);i.normalize(this);let s=dou.recyclable(e);s.normalize(t);let r=Math.acos(i.dot(s));return i.recycle(),s.recycle(),r}cross(t){return this.x*t.y-this.y*t.x}normalize(t){t=t||this;let{x:e,y:i}=t,s=Math.sqrt(e*e+i*i);return s>0?(s=1/s,this.x=e*s,this.y=i*s):(this.x=1,this.y=0),this}equal(t){return this.x==t.x&&this.y==t.y}copy(t){return this.set(t.x,t.y)}clone(){return new e(this.x,this.y)}clear(){return this.x=0,this.y=0,this}onRecycle(){this.clear()}}e.ZERO=new e(0,0),e.ONE=new e(1,1),e.MINUS_ONE=new e(-1,-1),t.Point=e}(dou2d||(dou2d={})),function(t){class e{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s}set top(t){this.height+=this.y-t,this.y=t}get top(){return this.y}set bottom(t){this.height=t-this.y}get bottom(){return this.y+this.height}set left(t){this.width+=this.x-t,this.x=t}get left(){return this.x}set right(t){this.width=t-this.x}get right(){return this.x+this.width}set topLeft(t){this.top=t.y,this.left=t.x}get topLeft(){return new t.Point(this.left,this.top)}set bottomRight(t){this.bottom=t.y,this.right=t.x}get bottomRight(){return new t.Point(this.right,this.bottom)}set(t,e,i,s){return this.x=t,this.y=e,this.width=i,this.height=s,this}isEmpty(){return this.width<=0||this.height<=0}contains(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e}containsPoint(t){return this.x<=t.x&&this.x+this.width>t.x&&this.y<=t.y&&this.y+this.height>t.y}containsRect(t){let e=t.x+t.width,i=t.y+t.height,s=this.x+this.width,r=this.y+this.height;return t.x>=this.x&&t.x<s&&t.y>=this.y&&t.y<r&&e>this.x&&e<=s&&i>this.y&&i<=r}intersects(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)}intersection(t,e){e=e||this;let i=this.x,s=this.y,r=t.x,a=t.y,n=Math.max(i,r),h=Math.min(i+this.width,r+t.width);if(n<=h){let i=Math.max(s,a),r=Math.min(s+this.height,a+t.height);i<=r?e.set(n,i,h-n,r-i):e.clear()}else e.clear();return e}union(t,e){if(e=e||this,t.isEmpty())return e;if(e.isEmpty())return e.copy(t),e;let i=Math.min(e.x,t.x),s=Math.min(e.y,t.y);return e.set(i,s,Math.max(e.right,t.right)-i,Math.max(e.bottom,t.bottom)-s),e}equals(t){return this===t||this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}copy(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}clone(){return new e(this.x,this.y,this.width,this.height)}clear(){return this.x=0,this.y=0,this.width=0,this.height=0,this}onRecycle(){this.clear()}}t.Rectangle=e}(dou2d||(dou2d={})),function(t){!function(e){class i extends dou.TickerBase{constructor(){super(),this._tickList=[]}startTick(t,e){-1==this.getTickIndex(t,e)&&(this.concatTick(),this._tickList.push({method:t,thisObj:e}))}getTickIndex(t,e){let i=this._tickList;for(let s=0,r=i.length;s<r;s++){let r=i[s];if(r.method===t&&r.thisObj===e)return s}return-1}concatTick(){this._tickList=this._tickList.concat()}stopTick(t,e){let i=this.getTickIndex(t,e);-1!=i&&(this.concatTick(),this._tickList.splice(i,1))}updateLogic(i){let s,r;e.deltaTime=i,s=t.Time.time,dou.Tween.tick(i,!1),this.broadcastDelay(i),this.broadcastTick(i),this.broadcastRender(),r=t.Time.time;let a=e.player.render(i);r=t.Time.time-r,this.broadcastEnterFrame(),this.broadcastFixedEnterFrame(i),s=t.Time.time-s-r,e.stat.onFrame(s,r,a)}broadcastDelay(t){e.updateCallLater(),e.updateInterval(t),e.updateTimeout(t)}broadcastTick(t){let e=this._tickList;for(let i=0,s=e.length;i<s;i++){let s=e[i];s.method.call(s.thisObj,t)}}broadcastRender(){if(e.invalidateRenderFlag){if(e.invalidateRenderFlag=!1,e.renderCallBackList.length>0){let i=e.renderCallBackList.concat();for(let e of i)e.dispatchEvent(t.Event2D.RENDER)}if(e.renderOnceCallBackList.length>0){let i=e.renderOnceCallBackList;e.renderOnceCallBackList=[];for(let e of i)e.dispatchEvent(t.Event2D.RENDER)}}}broadcastEnterFrame(){if(e.enterFrameCallBackList.length>0){let i=e.enterFrameCallBackList.concat();for(let e of i)e.dispatchEvent(t.Event2D.ENTER_FRAME)}if(e.enterFrameOnceCallBackList.length>0){let i=e.enterFrameOnceCallBackList;e.enterFrameOnceCallBackList=[];for(let e of i)e.dispatchEvent(t.Event2D.ENTER_FRAME)}}broadcastFixedEnterFrame(i){e.fixedPassedTime+=i;let s=~~(e.fixedPassedTime/e.fixedDeltaTime);if(s>0){if(e.fixedPassedTime%=e.fixedDeltaTime,e.fixedEnterFrameCallBackList.length>0){let i=e.fixedEnterFrameCallBackList.concat();for(let e of i)for(let i=0;i<s;i++)e.dispatchEvent(t.Event2D.FIXED_ENTER_FRAME)}if(e.fixedEnterFrameOnceCallBackList.length>0){let i=e.fixedEnterFrameOnceCallBackList;e.fixedEnterFrameOnceCallBackList=[];for(let e of i)for(let i=0;i<s;i++)e.dispatchEvent(t.Event2D.FIXED_ENTER_FRAME)}}}}e.Ticker=i}(t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){!function(e){e.Player=class{constructor(t,e,i){this._isPlaying=!1,this._screenDisplayList=this.createDisplayList(e,t),this._stage=e,this._rootClass=i}createDisplayList(e,i){let s=new t.rendering.DisplayList(e);return s.renderBuffer=i,e.$displayList=s,s}start(){this._isPlaying||(this._isPlaying=!0,this._root||this.initialize())}initialize(){this._root=new this._rootClass,this._root instanceof t.DisplayObject?this._stage.addChild(this._root):console.error("Root class must inherit from dou2d.DisplayObject.")}pause(){this._isPlaying&&(this._isPlaying=!1)}render(t){return this._stage.$displayList.drawToSurface()}updateStageSize(e,i){let s=this._stage;s.$setStageSize(e,i),this._screenDisplayList.setClipRect(e,i),s.dispatchEvent2D(t.Event2D.RESIZE)}}}(t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){const e=new t.Rectangle;class i extends dou.EventDispatcher{constructor(){super(),this.$useTranslate=!1,this.$cacheDirty=!1,this.$renderDirty=!1,this.$tintRGB=0,this.$sortDirty=!1,this.$lastSortedIndex=0,this._nestLevel=0,this._name="",this._matrixDirty=!1,this._x=0,this._y=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._skewX=0,this._skewXdeg=0,this._skewY=0,this._skewYdeg=0,this._explicitWidth=NaN,this._explicitHeight=NaN,this._anchorOffsetX=0,this._anchorOffsetY=0,this._visible=!0,this._invisible=!1,this._finalVisible=!0,this._alpha=1,this._tint=0,this._blendMode="normal",this._cacheAsBitmap=!1,this._touchEnabled=i.defaultTouchEnabled,this._dropEnabled=!1,this._zIndex=0,this._sortableChildren=!1,this._matrix=new t.Matrix,this.tint=16777215}get parent(){return this._parent}$setParent(t){this._parent=t}get $children(){return this._children}get stage(){return this._stage}set name(t){this._name=t}get name(){return this._name}set matrix(t){this.$setMatrix(t)}get matrix(){return this.$getMatrix().clone()}$setMatrix(e,i=!0){let s=this._matrix;s.a=e.a,s.b=e.b,s.c=e.c,s.d=e.d,this._x=e.tx,this._y=e.ty,this._matrixDirty=!1,1==s.a&&0==s.b&&0==s.c&&1==s.d?this.$useTranslate=!1:this.$useTranslate=!0,i&&(this._scaleX=s.scaleX,this._scaleY=s.scaleY,this._skewX=e.skewX,this._skewY=e.skewY,this._skewXdeg=t.MathUtil.clampRotation(180*this._skewX/Math.PI),this._skewYdeg=t.MathUtil.clampRotation(180*this._skewY/Math.PI),this._rotation=t.MathUtil.clampRotation(180*this._skewY/Math.PI))}$getMatrix(){return this._matrixDirty&&(this._matrixDirty=!1,this._matrix.updateScaleAndRotation(this._scaleX,this._scaleY,this._skewX,this._skewY)),this._matrix.tx=this._x,this._matrix.ty=this._y,this._matrix}$getConcatenatedMatrix(){let e=this._concatenatedMatrix;e||(e=this._concatenatedMatrix=new t.Matrix),this._parent?e.premultiply(this._parent.$getConcatenatedMatrix(),this.$getMatrix()):e.copy(this.$getMatrix());let i=this._anchorOffsetX,s=this._anchorOffsetY,r=this._scrollRect;if(r){let a=dou.recyclable(t.Matrix);a.set(1,0,0,1,-r.x-i,-r.y-s),e.premultiply(e,a),a.recycle()}else if(0!=i||0!=s){let r=dou.recyclable(t.Matrix);r.set(1,0,0,1,-i,-s),e.premultiply(e,r),r.recycle()}return this._concatenatedMatrix}$getInvertedConcatenatedMatrix(){return this._invertedConcatenatedMatrix||(this._invertedConcatenatedMatrix=new t.Matrix),this._invertedConcatenatedMatrix.inverse(this.$getConcatenatedMatrix()),this._invertedConcatenatedMatrix}set x(t){this.$setX(t)}get x(){return this.$getX()}$setX(t){if(this._x==t)return!1;this._x=t;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;return i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp()),!0}$getX(){return this._x}set y(t){this.$setY(t)}get y(){return this.$getY()}$setY(t){if(this._y==t)return!1;this._y=t;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;return i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp()),!0}$getY(){return this._y}set scaleX(t){this.$setScaleX(t)}get scaleX(){return this.$getScaleX()}$setScaleX(t){if(this._scaleX==t)return;this._scaleX=t,this._matrixDirty=!0,this.updateUseTransform();let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getScaleX(){return this._scaleX}set scaleY(t){this.$setScaleY(t)}get scaleY(){return this.$getScaleY()}$setScaleY(t){if(this._scaleY==t)return;this._scaleY=t,this._matrixDirty=!0,this.updateUseTransform();let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getScaleY(){return this._scaleY}set rotation(t){this.$setRotation(t)}get rotation(){return this.$getRotation()}$setRotation(e){if((e=t.MathUtil.clampRotation(e))==this._rotation)return;let i=(e-this._rotation)/180*Math.PI;this._skewX+=i,this._skewY+=i,this._rotation=e,this._matrixDirty=!0,this.updateUseTransform();let s=this._parent;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp());let r=this.$maskedObject;r&&!r.$cacheDirty&&(r.$cacheDirty=!0,r.$cacheDirtyUp())}$getRotation(){return this._rotation}set skewX(t){this.$setSkewX(t)}get skewX(){return this.$getSkewX()}$setSkewX(e){if(e==this._skewXdeg)return;this._skewXdeg=e,e=(e=t.MathUtil.clampRotation(e))/180*Math.PI,this._skewX=e,this._matrixDirty=!0,this.updateUseTransform();let i=this._parent;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp());let s=this.$maskedObject;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp())}$getSkewX(){return this._skewXdeg}set skewY(t){this.$setSkewY(t)}get skewY(){return this.$getSkewY()}$setSkewY(e){if(e==this._skewYdeg)return;this._skewYdeg=e,e=((e=t.MathUtil.clampRotation(e))+this._rotation)/180*Math.PI,this._skewY=e,this._matrixDirty=!0,this.updateUseTransform();let i=this._parent;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp());let s=this.$maskedObject;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp())}$getSkewY(){return this._skewYdeg}set width(t){this.$setWidth(t)}get width(){return this.$getWidth()}$setWidth(t){t=isNaN(t)?NaN:t,this._explicitWidth!=t&&(this._explicitWidth=t)}$getWidth(){return isNaN(this._explicitWidth)?this.$getOriginalBounds().width:this._explicitWidth}set height(t){this.$setHeight(t)}get height(){return this.$getHeight()}$setHeight(t){t=isNaN(t)?NaN:t,this._explicitHeight!=t&&(this._explicitHeight=t)}$getHeight(){return isNaN(this._explicitHeight)?this.$getOriginalBounds().height:this._explicitHeight}get measuredWidth(){return this.$getOriginalBounds().width}get measuredHeight(){return this.$getOriginalBounds().height}set anchorOffsetX(t){this.$setAnchorOffsetX(t)}get anchorOffsetX(){return this.$getAnchorOffsetX()}$setAnchorOffsetX(t){if(this._anchorOffsetX==t)return;this._anchorOffsetX=t;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getAnchorOffsetX(){return this._anchorOffsetX}set anchorOffsetY(t){this.$setAnchorOffsetY(t)}get anchorOffsetY(){return this.$getAnchorOffsetY()}$setAnchorOffsetY(t){if(this._anchorOffsetY==t)return;this._anchorOffsetY=t;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getAnchorOffsetY(){return this._anchorOffsetY}set visible(t){this._visible=t,this.$setVisible(this._visible&&!this._invisible)}get visible(){return this._visible}set invisible(t){this._invisible=t,this.$setVisible(this._visible&&!this._invisible)}get invisible(){return this._invisible}get finalVisible(){return this.$getVisible()}$setVisible(e){if(this._finalVisible==e)return;this._finalVisible=e,this.$updateRenderMode();let i=this._parent;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp());let s=this.$maskedObject;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp()),this.dispatchEvent2D(e?t.Event2D.SHOWED:t.Event2D.HIDDEN)}$getVisible(){return this._finalVisible}set alpha(t){this.$setAlpha(t)}get alpha(){return this.$getAlpha()}$setAlpha(t){if(this._alpha==t)return;this._alpha=t,this.$updateRenderMode();let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getAlpha(){return this._alpha}set tint(t){this._tint=t,this.$tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}get tint(){return this._tint}set blendMode(t){this.$setBlendMode(t)}get blendMode(){return this.$getBlendMode()}$setBlendMode(t){if(this._blendMode==t)return;this._blendMode=t,this.$updateRenderMode();let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getBlendMode(){return this._blendMode}set scrollRect(t){this.$setScrollRect(t)}get scrollRect(){return this.$getScrollRect()}$setScrollRect(e){if(!e&&!this._scrollRect)return void this.$updateRenderMode();e?(this._scrollRect||(this._scrollRect=new t.Rectangle),this._scrollRect.copy(e)):this._scrollRect=null,this.$updateRenderMode();let i=this._parent;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp());let s=this.$maskedObject;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp())}$getScrollRect(){return this._scrollRect}set mask(t){this.$setMask(t)}get mask(){return this.$getMask()}$setMask(e){if(e!==this){if(e)if(e instanceof i){if(e==this.$mask)return;e.$maskedObject&&(e.$maskedObject.mask=null),e.$maskedObject=this,this.$mask=e,e.$updateRenderMode(),this.$maskRect&&(this.$maskRect=null)}else this.$maskRect||(this.$maskRect=new t.Rectangle),this.$maskRect.copy(e),this.$mask&&(this.$mask.$maskedObject=null,this.$mask.$updateRenderMode()),this.mask&&(this.$mask=null);else this.$mask&&(this.$mask.$maskedObject=null,this.$mask.$updateRenderMode()),this.mask&&(this.$mask=null),this.$maskRect&&(this.$maskRect=null);this.$updateRenderMode()}}$getMask(){return this.$mask?this.$mask:this.$maskRect}set filters(t){this.$setFilters(t)}get filters(){return this.$getFilters()}$setFilters(t){if(!this._filters&&!t){this._filters=t,this.$updateRenderMode();let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;return void(i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp()))}t&&t.length?(t=t.concat(),this._filters=t):this._filters=t,this.$updateRenderMode();let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getFilters(){return this._filters}set cacheAsBitmap(t){this._cacheAsBitmap=t,this.$setHasDisplayList(t)}get cacheAsBitmap(){return this._cacheAsBitmap}$setHasDisplayList(e){if(!!this.$displayList!=e)if(e){let e=t.rendering.DisplayList.create(this);e&&(this.$displayList=e,this.$cacheDirty=!0)}else this.$displayList=null}set touchEnabled(t){this.$setTouchEnabled(t)}get touchEnabled(){return this.$getTouchEnabled()}$setTouchEnabled(t){this._touchEnabled=!!t}$getTouchEnabled(){return this._touchEnabled}set hitArea(t){this.$setHitArea(t)}get hitArea(){return this.$getHitArea()}$setHitArea(t){this._hitArea=t}$getHitArea(){return this._hitArea}set dropEnabled(t){this.$setDropEnabled(t)}get dropEnabled(){return this.$getDropEnabled()}$setDropEnabled(e){this._dropEnabled!=e&&(this._dropEnabled=e,t.DragManager.instance.$dropRegister(this,this._dropEnabled))}$getDropEnabled(){return this._dropEnabled}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.$sortDirty=!0)}get zIndex(){return this._zIndex}set sortableChildren(t){this._sortableChildren=t}get sortableChildren(){return this._sortableChildren}$onAddToStage(e,i){this._stage=e,this._nestLevel=i,this.dispatchEvent2D(t.Event2D.ADDED_TO_STAGE)}$onRemoveFromStage(){this._nestLevel=0,this._stage=null,this.dispatchEvent2D(t.Event2D.REMOVED_FROM_STAGE)}updateUseTransform(){1==this._scaleX&&1==this._scaleY&&0==this._skewX&&0==this._skewY?this.$useTranslate=!1:this.$useTranslate=!0}$cacheDirtyUp(){let t=this._parent;t&&!t.$cacheDirty&&(t.$cacheDirty=!0,t.$cacheDirtyUp())}sortChildren(){this.$sortDirty=!1}getTransformedBounds(t,e){return this.$getTransformedBounds(t,e)}getBounds(t,e=!0){return t=this.$getTransformedBounds(this,t),e&&(0!=this._anchorOffsetX&&(t.x-=this._anchorOffsetX),0!=this._anchorOffsetY&&(t.y-=this._anchorOffsetY)),t}$getTransformedBounds(e,i){let s=this.$getOriginalBounds();if(i||(i=new t.Rectangle),i.copy(s),e==this)return i;if(e){let s=dou.recyclable(t.Matrix),r=e.$getInvertedConcatenatedMatrix();s.premultiply(r,this.$getConcatenatedMatrix()),s.transformBounds(i),s.recycle()}else{this.$getConcatenatedMatrix().transformBounds(i)}return i}globalToLocal(t=0,e=0,i){return this.$getInvertedConcatenatedMatrix().transformPoint(t,e,i)}localToGlobal(t=0,e=0,i){return this.$getConcatenatedMatrix().transformPoint(t,e,i)}$getOriginalBounds(){let t=this.$getContentBounds();this.$measureChildBounds(t);let e=this.$measureFiltersOffset(!1);return e&&(t.x+=e.minX,t.y+=e.minY,t.width+=-e.minX+e.maxX,t.height+=-e.minY+e.maxY),t}$getContentBounds(){let t=e;return t.clear(),this.$measureContentBounds(t),t}$measureContentBounds(t){}$measureChildBounds(t){}$measureFiltersOffset(t){let e=this,i=0,s=0,r=0,a=0;for(;e;){let n=e._filters;if(n&&n.length){let t=n.length;for(let e=0;e<t;e++){let t=n[e];if("blur"==t.type){let e=t.blurX,n=t.blurY;i-=e,s-=n,r+=e,a+=n}else if("glow"==t.type){let e=t.blurX,n=t.blurY;i-=e,s-=n,r+=e,a+=n;let h=t.distance||0,o=t.angle||0,l=0,c=0;0!=h&&(i+=l=(l=h*Math.cos(o))>0?Math.ceil(l):Math.floor(l),r+=l,s+=c=(c=h*Math.sin(o))>0?Math.ceil(c):Math.floor(c),a+=c)}else if("custom"==t.type){let e=t.padding;i-=e,s-=e,r+=e,a+=e}}}e=t?e._parent:null}return{minX:i=Math.min(i,0),minY:s=Math.min(s,0),maxX:r=Math.max(r,0),maxY:a=Math.max(a,0)}}$getRenderNode(){let t=this.$renderNode;return t?(this.$renderDirty&&(t.cleanBeforeRender(),this.$updateRenderNode(),this.$renderDirty=!1,t=this.$renderNode),t):null}$updateRenderMode(){!this._finalVisible||this._alpha<=0||this.$maskedObject?this.$renderMode=1:this.filters&&this.filters.length>0?this.$renderMode=2:"normal"!==this._blendMode||this.$mask&&this.$mask._stage?this.$renderMode=3:this._scrollRect||this.$maskRect?this.$renderMode=4:this.$renderMode=null}$getConcatenatedMatrixAt(e,i){let s=e.$getInvertedConcatenatedMatrix();if(0===s.a||0===s.d){let s=this,r=e._nestLevel;for(i.identity();s._nestLevel>r;){let e=s._scrollRect;if(e){let s=dou.recyclable(t.Matrix);s.set(1,0,0,1,-e.x,-e.y),i.multiply(s),s.recycle()}i.multiply(s.$getMatrix()),s=s._parent}}else i.premultiply(s,i)}$updateRenderNode(){}$hitTest(t,e){if(!(this.$renderNode&&this._finalVisible&&0!=this._scaleX&&0!=this._scaleY||this._hitArea))return null;let i=this.$getInvertedConcatenatedMatrix();if(0==i.a&&0==i.b&&0==i.c&&0==i.d&&!this._hitArea)return null;let s=this.$getContentBounds(),r=i.a*t+i.c*e+i.tx,a=i.b*t+i.d*e+i.ty;if(this._hitArea)return this._hitArea.contains(r,a)?this:null;if(s.contains(r,a)){if(!this._children){let i=this._scrollRect?this._scrollRect:this.$maskRect;if(i&&!i.contains(r,a))return null;if(this.$mask&&!this.$mask.$hitTest(t,e))return null}return this}return null}hitTestPoint(e,i,s){if(s){let s,r=this.$getInvertedConcatenatedMatrix(),a=r.a*e+r.c*i+r.tx,n=r.b*e+r.d*i+r.ty,h=this.$displayList;if(h){let t=h.renderBuffer;try{s=t.getPixels(a-h.offsetX,n-h.offsetY)}catch(t){console.error("Cross domains pictures can not get pixel information!")}}else{let e=t.sys.hitTestBuffer;e.resize(3,3);let i=dou.recyclable(t.Matrix);i.translate(1-a,1-n),t.sys.renderer.render(this,e,i),i.recycle();try{s=e.getPixels(1,1)}catch(t){console.error("Cross domains pictures can not get pixel information!")}}return 0!==s[3]}{if(0==this._scaleX||0==this._scaleY)return!1;let t=this.$getInvertedConcatenatedMatrix(),s=this.getBounds(null,!1),r=t.a*e+t.c*i+t.tx,a=t.b*e+t.d*i+t.ty;if(s.contains(r,a)){let t=this._scrollRect?this._scrollRect:this.$maskRect;return!(t&&!t.contains(r,a))}return!1}}removeSelf(){this._parent&&this._parent.removeChild(this)}addEventListener(e,i,s,r){let a=super.addEventListener(e,i,s,r);if(e==t.Event2D.ENTER_FRAME||e==t.Event2D.FIXED_ENTER_FRAME||e==t.Event2D.RENDER){let i;(i=e==t.Event2D.ENTER_FRAME?r?t.sys.enterFrameOnceCallBackList:t.sys.enterFrameCallBackList:e==t.Event2D.FIXED_ENTER_FRAME?r?t.sys.fixedEnterFrameOnceCallBackList:t.sys.fixedEnterFrameCallBackList:r?t.sys.renderOnceCallBackList:t.sys.renderCallBackList).pushUnique(this)}return a}willTrigger(t){let e=this;for(;e;){if(e.has(t))return!0;e=e._parent}return!1}dispatch(e){let i=!1;if(e instanceof t.Event2D&&e.bubbles&&(i=!0),i){let t=this.getPropagationList(this);return e.$setTarget(this),this.dispatchPropagationEvent(e,t),!e.$isDefaultPrevented()}return super.dispatch(e)}getPropagationList(t){let e=[];for(;t;)e.push(t),t=t._parent;return e}dispatchPropagationEvent(t,e){for(let i=0,s=e.length;i<s;i++){let s=e[i];if(t.$setCurrentTarget(s),s.$notify(t),t.$isPropagationStopped())break}}off(e,i,s){if(super.off(e,i,s),e==t.Event2D.ENTER_FRAME||e==t.Event2D.FIXED_ENTER_FRAME||e==t.Event2D.RENDER){let i,s;e==t.Event2D.ENTER_FRAME?(i=t.sys.enterFrameCallBackList,s=t.sys.enterFrameOnceCallBackList):e==t.Event2D.FIXED_ENTER_FRAME?(i=t.sys.fixedEnterFrameCallBackList,s=t.sys.fixedEnterFrameOnceCallBackList):(i=t.sys.renderCallBackList,s=t.sys.renderOnceCallBackList),i.remove(this),s.remove(this)}}}i.defaultTouchEnabled=!1,t.DisplayObject=i}(dou2d||(dou2d={})),function(t){class e extends t.DisplayObject{constructor(){super(),this._touchChildren=!0,this._children=[]}get numChildren(){return this._children.length}set touchChildren(t){this.$setTouchChildren(!!t)}get touchChildren(){return this.$getTouchChildren()}$setTouchChildren(t){return this._touchChildren!=t&&(this._touchChildren=t,!0)}$getTouchChildren(){return this._touchChildren}$onAddToStage(t,e){super.$onAddToStage(t,e);let i=this._children.length;e++;for(let s=0;s<i;s++){let i=this._children[s];i.$onAddToStage(t,e),i.$maskedObject&&i.$maskedObject.$updateRenderMode()}}$onRemoveFromStage(){super.$onRemoveFromStage();let t=this._children,e=t.length;for(let i=0;i<e;i++){t[i].$onRemoveFromStage()}}addChild(t){let e=this._children.length;return t.parent==this&&e--,this.$doAddChild(t,e)}addChildAt(t,e){return((e=0|+e)<0||e>=this._children.length)&&(e=this._children.length,t.parent==this&&e--),this.$doAddChild(t,e)}$doAddChild(e,i,s=!0){let r=e.parent;if(r==this)return this.doSetChildIndex(e,i),e;r&&r.removeChild(e),this._children.splice(i,0,e),e.$setParent(this);let a=this._stage;if(a&&e.$onAddToStage(a,this._nestLevel+1),s&&e.dispatchEvent2D(t.Event2D.ADDED,null,!0),e.$maskedObject&&e.$maskedObject.$updateRenderMode(),!this.$cacheDirty){this.$cacheDirty=!0;let t=this._parent;t&&!t.$cacheDirty&&(t.$cacheDirty=!0,t.$cacheDirtyUp());let e=this.$maskedObject;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp())}return this.$childAdded(e,i),e}$childAdded(t,e){}contains(t){for(;t;){if(t==this)return!0;t=t.parent}return!1}getChildAt(t){return(t=0|+t)>=0&&t<this._children.length?this._children[t]:null}getChildIndex(t){return this._children.indexOf(t)}getChildByName(t){let e,i=this._children,s=i.length;for(let r=0;r<s;r++)if((e=i[r]).name==t)return e;return null}setChildIndex(t,e){((e=0|+e)<0||e>=this._children.length)&&(e=this._children.length-1),this.doSetChildIndex(t,e)}doSetChildIndex(t,e){let i=this._children.indexOf(t);if(i!=e&&(this.$childRemoved(t,i),this._children.splice(i,1),this._children.splice(e,0,t),this.$childAdded(t,e),!this.$cacheDirty)){this.$cacheDirty=!0;let t=this._parent;t&&!t.$cacheDirty&&(t.$cacheDirty=!0,t.$cacheDirtyUp());let e=this.$maskedObject;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp())}}swapChildrenAt(t,e){e=0|+e,(t=0|+t)>=0&&t<this._children.length&&e>=0&&e<this._children.length&&this.doSwapChildrenAt(t,e)}swapChildren(t,e){let i=this._children.indexOf(t),s=this._children.indexOf(e);-1!=i&&-1!=s&&this.doSwapChildrenAt(i,s)}doSwapChildrenAt(t,e){if(t>e){let i=e;e=t,t=i}else if(t==e)return;let i=this._children,s=i[t],r=i[e];if(this.$childRemoved(s,t),this.$childRemoved(r,e),i[t]=r,i[e]=s,this.$childAdded(r,t),this.$childAdded(s,e),!this.$cacheDirty){this.$cacheDirty=!0;let t=this._parent;t&&!t.$cacheDirty&&(t.$cacheDirty=!0,t.$cacheDirtyUp());let e=this.$maskedObject;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp())}}removeChild(t){let e=this._children.indexOf(t);return e>=0?this.$doRemoveChild(e):null}removeChildAt(t){return(t=0|+t)>=0&&t<this._children.length?this.$doRemoveChild(t):null}$doRemoveChild(e,i=!0){e=0|+e;let s=this._children,r=s[e];this.$childRemoved(r,e),i&&r.dispatchEvent2D(t.Event2D.REMOVED,null,!0),this._stage&&r.$onRemoveFromStage(),r.$setParent(null);let a=s.indexOf(r);if(-1!=a&&s.splice(a,1),r.$maskedObject&&r.$maskedObject.$updateRenderMode(),!this.$cacheDirty){this.$cacheDirty=!0;let t=this._parent;t&&!t.$cacheDirty&&(t.$cacheDirty=!0,t.$cacheDirtyUp());let e=this.$maskedObject;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp())}return r}removeChildren(){for(let t=this._children.length-1;t>=0;t--)this.$doRemoveChild(t)}$childRemoved(t,e){}$measureChildBounds(e){let i=this._children,s=i.length;if(0==s)return;let r=0,a=0,n=0,h=0,o=!1,l=dou.recyclable(t.Rectangle);for(let t=-1;t<s;t++){let s;-1==t?s=e:(i[t].getBounds(l),i[t].$getMatrix().transformBounds(l),s=l),s.isEmpty()||(o?(r=Math.min(r,s.x),a=Math.max(a,s.x+s.width),n=Math.min(n,s.y),h=Math.max(h,s.y+s.height)):(o=!0,a=(r=s.x)+s.width,h=(n=s.y)+s.height))}l.recycle(),e.set(r,n,a-r,h-n)}$hitTest(t,e){if(!this._finalVisible)return null;let i=this.$getInvertedConcatenatedMatrix(),s=i.a*t+i.c*e+i.tx,r=i.b*t+i.d*e+i.ty;if(this._hitArea)return this._hitArea.contains(s,r)?this:null;let a=this._scrollRect?this._scrollRect:this.$maskRect;if(a&&!a.contains(s,r))return null;if(this.$mask&&!this.$mask.$hitTest(t,e))return null;let n,h=this._children,o=!1;for(let i=h.length-1;i>=0;i--){let s=h[i];if(!s.$maskedObject&&(n=s.$hitTest(t,e))){if(o=!0,n.touchEnabled)break;n=null}}return n?this._touchChildren?n:this:o?this:super.$hitTest(t,e)}sortChildren(){super.sortChildren(),this.$sortDirty=!1;let t=!1;const e=this._children;let i;for(let s=0,r=e.length;s<r;++s)(i=e[s]).$lastSortedIndex=s,t||0===i.zIndex||(t=!0);t&&e.length>1&&e.sort(this._sortChildrenFunc)}_sortChildrenFunc(t,e){return t.zIndex===e.zIndex?t.$lastSortedIndex-e.$lastSortedIndex:t.zIndex-e.zIndex}}t.DisplayObjectContainer=e}(dou2d||(dou2d={})),function(t){class e extends t.DisplayObject{constructor(){super(),this._graphics=new t.Graphics,this._graphics.$setTarget(this)}get graphics(){return this._graphics}$onRemoveFromStage(){super.$onRemoveFromStage(),this._graphics&&this._graphics.$onRemoveFromStage()}$measureContentBounds(t){this._graphics.$measureContentBounds(t)}}t.Shape=e}(dou2d||(dou2d={})),function(t){class e extends t.DisplayObjectContainer{constructor(){super(),this._graphics=new t.Graphics,this._graphics.$setTarget(this)}get graphics(){return this._graphics}$onRemoveFromStage(){super.$onRemoveFromStage(),this._graphics&&this._graphics.$onRemoveFromStage()}$measureContentBounds(t){this._graphics.$measureContentBounds(t)}}t.Sprite=e}(dou2d||(dou2d={})),function(t){class e extends t.DisplayObjectContainer{constructor(t){super(),this._stageWidth=0,this._stageHeight=0,this._scaleMode="showAll",this._orientation="auto",this._maxTouches=99,this._engine=t,this._stage=this,this._nestLevel=1}set frameRate(e){t.sys.ticker.frameRate=e}get frameRate(){return t.sys.ticker.frameRate}get stageWidth(){return this._stageWidth}get stageHeight(){return this._stageHeight}set scaleMode(t){this._scaleMode!=t&&(this._scaleMode=t,this._engine.updateScreenSize())}get scaleMode(){return this._scaleMode}set orientation(t){this._orientation!=t&&(this._orientation=t,this._engine.updateScreenSize())}get orientation(){return this._orientation}set textureScaleFactor(e){t.sys.textureScaleFactor=e}get textureScaleFactor(){return t.sys.textureScaleFactor}set maxTouches(t){this._maxTouches!=t&&(this._maxTouches=t,this._engine.updateMaxTouches(this._maxTouches))}get maxTouches(){return this._maxTouches}$setStageSize(t,e){this._stageWidth=t,this._stageHeight=e}setContentSize(t,e){this._engine.setContentSize(t,e)}invalidate(){t.sys.invalidateRenderFlag=!0}}t.Stage=e,t.sys.markCannotUse(e,"alpha",1),t.sys.markCannotUse(e,"visible",!0),t.sys.markCannotUse(e,"x",0),t.sys.markCannotUse(e,"y",0),t.sys.markCannotUse(e,"scaleX",1),t.sys.markCannotUse(e,"scaleY",1),t.sys.markCannotUse(e,"rotation",0),t.sys.markCannotUse(e,"cacheAsBitmap",!1),t.sys.markCannotUse(e,"scrollRect",null),t.sys.markCannotUse(e,"filters",null),t.sys.markCannotUse(e,"blendMode",null),t.sys.markCannotUse(e,"touchEnabled",!0),t.sys.markCannotUse(e,"matrix",null)}(dou2d||(dou2d={})),function(t){class e{constructor(t){this.deleteSource=!0,this.source=t,this.source&&(this.width=+t.width,this.height=+t.height)}static create(i,s,r){let a="",n="image/png";"/"===(a="arraybuffer"===i?t.Base64Util.encode(s):s).charAt(0)?n="image/jpeg":"R"===a.charAt(0)?n="image/gif":"i"===a.charAt(0)&&(n="image/png");let h=new Image;h.src="data:"+n+";base64,"+a,h.crossOrigin="*";let o=new e(h);return h.onload=function(){h.onload=void 0,o.source=h,o.height=h.height,o.width=h.width,r&&r(o)},o}static addDisplayObject(t,i){if(!e._map.has(i))return void e._map.set(i,[t]);let s=e._map.get(i);s.indexOf(t)<0&&s.push(t)}static removeDisplayObject(t,i){if(!e._map.has(i))return;let s=e._map.get(i),r=s.indexOf(t);r>=0&&s.splice(r,1)}static invalidate(i){if(!e._map.has(i))return;let s=e._map.get(i);for(let e=0;e<s.length;e++){s[e]instanceof t.Bitmap&&s[e].$refreshImageData();let i=s[e];i.$renderDirty=!0;let r=i.parent;r&&!r.$cacheDirty&&(r.$cacheDirty=!0,r.$cacheDirtyUp());let a=i.$maskedObject;a&&!a.$cacheDirty&&(a.$cacheDirty=!0,a.$cacheDirtyUp())}}static dispose(i){if(!e._map.has(i))return;let s=e._map.get(i);for(let e of s){e instanceof t.Bitmap&&(e.$bitmapData=null),e.$renderDirty=!0;let i=e.parent;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp());let s=e.$maskedObject;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp())}e._map.delete(i)}dispose(){this.webGLTexture&&(t.WebGLUtil.deleteTexture(this.webGLTexture),this.webGLTexture=null),this.source&&this.source.dispose&&this.source.dispose(),this.source&&this.source.src&&(this.source.src=""),this.source=null,e.dispose(this)}}e._map=new Map,t.BitmapData=e}(dou2d||(dou2d={})),function(t){class e extends t.DisplayObject{constructor(i){super(),this._bitmapX=0,this._bitmapY=0,this._bitmapWidth=0,this._bitmapHeight=0,this._offsetX=0,this._offsetY=0,this._textureWidth=0,this._textureHeight=0,this._sourceWidth=0,this._sourceHeight=0,this._explicitBitmapWidth=NaN,this._explicitBitmapHeight=NaN,this._fillMode="scale",this._smoothing=e.defaultSmoothing,this._pixelHitTest=!1,this.$renderNode=new t.rendering.NormalBitmapNode,this.$setTexture(i),i&&(this.$renderNode.rotated=i.rotated)}set texture(t){this.$setTexture(t),t&&this.$renderNode&&(this.$renderNode.rotated=t.rotated)}get texture(){return this.$getTexture()}$setTexture(e){let i=this._texture;if(e==i)return!1;if(this._texture=e,!e){i&&t.BitmapData.removeDisplayObject(this,i.bitmapData),this.setImageData(null,0,0,0,0,0,0,0,0,0,0),this.$renderDirty=!0;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let s=this.$maskedObject;return s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp()),!0}if(this.$refreshImageData(),this._stage){if(i&&i.bitmapData){if(i.bitmapData===e.bitmapData){this.$renderDirty=!0;let t=this._parent;t&&!t.$cacheDirty&&(t.$cacheDirty=!0,t.$cacheDirtyUp());let e=this.$maskedObject;return e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp()),!0}t.BitmapData.removeDisplayObject(this,i.bitmapData)}t.BitmapData.addDisplayObject(this,e.bitmapData)}this.$renderDirty=!0;let s=this._parent;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp());let r=this.$maskedObject;return r&&!r.$cacheDirty&&(r.$cacheDirty=!0,r.$cacheDirtyUp()),!0}$getTexture(){return this._texture}set scale9Grid(t){this.$setScale9Grid(t)}get scale9Grid(){return this.$getScale9Grid()}$setScale9Grid(t){this._scale9Grid=t,this.$renderDirty=!0;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getScale9Grid(){return this._scale9Grid}set fillMode(t){this.$setFillMode(t)}get fillMode(){return this.$getFillMode()}$setFillMode(t){if(t==this._fillMode)return!1;this._fillMode=t,this.$renderDirty=!0;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;return i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp()),!0}$getFillMode(){return this._fillMode}set smoothing(t){this.$setSmoothing(t)}get smoothing(){return this.$getSmoothing()}$setSmoothing(t){if(t==this._smoothing)return;this._smoothing=t,this.$renderNode.smoothing=t;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getSmoothing(){return this._smoothing}set pixelHitTest(t){this._pixelHitTest=!!t}get pixelHitTest(){return this._pixelHitTest}$onAddToStage(e,i){super.$onAddToStage(e,i);let s=this._texture;s&&s.bitmapData&&t.BitmapData.addDisplayObject(this,s.bitmapData)}$onRemoveFromStage(){super.$onRemoveFromStage();let e=this._texture;e&&t.BitmapData.removeDisplayObject(this,e.bitmapData)}$setWidth(t){if(t<0||t==this._explicitBitmapWidth)return!1;this._explicitBitmapWidth=t,this.$renderDirty=!0;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;return i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp()),!0}$getWidth(){return isNaN(this._explicitBitmapWidth)?this.$getContentBounds().width:this._explicitBitmapWidth}$setHeight(t){if(t<0||t==this._explicitBitmapHeight)return!1;this._explicitBitmapHeight=t,this.$renderDirty=!0;let e=this._parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;return i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp()),!0}$getHeight(){return isNaN(this._explicitBitmapHeight)?this.$getContentBounds().height:this._explicitBitmapHeight}$measureContentBounds(t){if(this.$bitmapData){let e=isNaN(this._explicitBitmapWidth)?this._textureWidth:this._explicitBitmapWidth,i=isNaN(this._explicitBitmapHeight)?this._textureHeight:this._explicitBitmapHeight;t.set(0,0,e,i)}else{let e=isNaN(this._explicitBitmapWidth)?0:this._explicitBitmapWidth,i=isNaN(this._explicitBitmapHeight)?0:this._explicitBitmapHeight;t.set(0,0,e,i)}}$updateRenderNode(){if(this._texture){let e=isNaN(this._explicitBitmapWidth)?this._textureWidth:this._explicitBitmapWidth,i=isNaN(this._explicitBitmapHeight)?this._textureHeight:this._explicitBitmapHeight,s=this.scale9Grid;s?(this.$renderNode instanceof t.rendering.NormalBitmapNode&&(this.$renderNode=new t.rendering.BitmapNode),t.rendering.BitmapNode.updateTextureDataWithScale9Grid(this.$renderNode,this.$bitmapData,s,this._bitmapX,this._bitmapY,this._bitmapWidth,this._bitmapHeight,this._offsetX,this._offsetY,this._textureWidth,this._textureHeight,e,i,this._sourceWidth,this._sourceHeight,this._smoothing)):("repeat"==this.fillMode&&this.$renderNode instanceof t.rendering.NormalBitmapNode&&(this.$renderNode=new t.rendering.BitmapNode),t.rendering.NormalBitmapNode.updateTextureData(this.$renderNode,this.$bitmapData,this._bitmapX,this._bitmapY,this._bitmapWidth,this._bitmapHeight,this._offsetX,this._offsetY,this._textureWidth,this._textureHeight,e,i,this._sourceWidth,this._sourceHeight,this._fillMode,this._smoothing))}}$hitTest(t,e){let i=super.$hitTest(t,e);if(i&&this._pixelHitTest){this.hitTestPoint(t,e,!0)||(i=null)}return i}$refreshImageData(){let t=this._texture;t&&this.setImageData(t.bitmapData,t.bitmapX,t.bitmapY,t.bitmapWidth,t.bitmapHeight,t.offsetX,t.offsetY,t.$getTextureWidth(),t.$getTextureHeight(),t.sourceWidth,t.sourceHeight)}setImageData(t,e,i,s,r,a,n,h,o,l,c){this.$bitmapData=t,this._bitmapX=e,this._bitmapY=i,this._bitmapWidth=s,this._bitmapHeight=r,this._offsetX=a,this._offsetY=n,this._textureWidth=h,this._textureHeight=o,this._sourceWidth=l,this._sourceHeight=c}}e.defaultSmoothing=!0,t.Bitmap=e}(dou2d||(dou2d={})),function(t){t.Graphics=class{constructor(){this._lastX=0,this._lastY=0,this._topLeftStrokeWidth=0,this._bottomRightStrokeWidth=0,this._includeLastPosition=!0,this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0,this._renderNode=new t.rendering.GraphicsNode}$setTarget(t){this._targetDisplay&&(this._targetDisplay.$renderNode=null),t.$renderNode=this._renderNode,this._targetDisplay=t}setStrokeWidth(t){switch(t){case 1:this._topLeftStrokeWidth=0,this._bottomRightStrokeWidth=1;break;case 3:this._topLeftStrokeWidth=1,this._bottomRightStrokeWidth=2;break;default:let e=0|Math.ceil(.5*t);this._topLeftStrokeWidth=e,this._bottomRightStrokeWidth=e}}beginFill(t,e=1){t=+t||0,e=+e||0,this._fillPath=this._renderNode.beginFill(t,e,this._strokePath),this._renderNode.drawData.length>1&&this._fillPath.moveTo(this._lastX,this._lastY)}beginGradientFill(t,e,i,s,r=null){this._fillPath=this._renderNode.beginGradientFill(t,e,i,s,r,this._strokePath),this._renderNode.drawData.length>1&&this._fillPath.moveTo(this._lastX,this._lastY)}endFill(){this._fillPath=null}lineStyle(t=NaN,e=0,i=1,s="round",r="round",a=3,n){e=+e||0,i=+i||0,a=+a||0,(t=+t||0)<=0?(this._strokePath=null,this.setStrokeWidth(0)):(this.setStrokeWidth(t),this._strokePath=this._renderNode.lineStyle(t,e,i,s,r,a,n),this._renderNode.drawData.length>1&&this._strokePath.moveTo(this._lastX,this._lastY))}drawRect(t,e,i,s){t=+t||0,e=+e||0,i=+i||0,s=+s||0;let r=this._fillPath,a=this._strokePath;r&&r.drawRect(t,e,i,s),a&&a.drawRect(t,e,i,s),this.extendBoundsByPoint(t+i,e+s),this.updatePosition(t,e),this.dirty()}drawRoundRect(t,e,i,s,r,a){t=+t||0,e=+e||0,i=+i||0,s=+s||0,r=+r||0,a=+a||0;let n=this._fillPath,h=this._strokePath;n&&n.drawRoundRect(t,e,i,s,r,a),h&&h.drawRoundRect(t,e,i,s,r,a);let o=t+i,l=e+s,c=l-(a?.5*a|0:.5*r|0);this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(o,l),this.updatePosition(o,c),this.dirty()}drawCircle(t,e,i){t=+t||0,e=+e||0,i=+i||0;let s=this._fillPath,r=this._strokePath;s&&s.drawCircle(t,e,i),r&&r.drawCircle(t,e,i),this.extendBoundsByPoint(t-i-1,e-i-1),this.extendBoundsByPoint(t+i+2,e+i+2),this.updatePosition(t+i,e),this.dirty()}drawEllipse(t,e,i,s){t=+t||0,e=+e||0,i=+i||0,s=+s||0;let r=this._fillPath,a=this._strokePath;r&&r.drawEllipse(t,e,i,s),a&&a.drawEllipse(t,e,i,s),this.extendBoundsByPoint(t-1,e-1),this.extendBoundsByPoint(t+i+2,e+s+2),this.updatePosition(t+i,e+.5*s),this.dirty()}moveTo(t,e){t=+t||0,e=+e||0;let i=this._fillPath,s=this._strokePath;i&&i.moveTo(t,e),s&&s.moveTo(t,e),this._includeLastPosition=!1,this._lastX=t,this._lastY=e,this.dirty()}lineTo(t,e){t=+t||0,e=+e||0;let i=this._fillPath,s=this._strokePath;i&&i.lineTo(t,e),s&&s.lineTo(t,e),this.updatePosition(t,e),this.dirty()}curveTo(t,e,i,s){t=+t||0,e=+e||0,i=+i||0,s=+s||0;let r=this._fillPath,a=this._strokePath;r&&r.curveTo(t,e,i,s),a&&a.curveTo(t,e,i,s);let n=this._lastX||0,h=this._lastY||0,o=this.createBezierPoints([n,h,t,e,i,s],50);for(let t=0;t<o.length;t++){let e=o[t];this.extendBoundsByPoint(e.x,e.y),e.recycle()}this.extendBoundsByPoint(i,s),this.updatePosition(i,s),this.dirty()}cubicCurveTo(t,e,i,s,r,a){t=+t||0,e=+e||0,i=+i||0,s=+s||0,r=+r||0,a=+a||0;let n=this._fillPath,h=this._strokePath;n&&n.cubicCurveTo(t,e,i,s,r,a),h&&h.cubicCurveTo(t,e,i,s,r,a);let o=this._lastX||0,l=this._lastY||0,c=this.createBezierPoints([o,l,t,e,i,s,r,a],50);for(let t=0;t<c.length;t++){let e=c[t];this.extendBoundsByPoint(e.x,e.y),e.recycle()}this.extendBoundsByPoint(r,a),this.updatePosition(r,a),this.dirty()}drawArc(e,i,s,r,a,n){if(s<0||r===a)return;e=+e||0,i=+i||0,s=+s||0,r=+r||0,a=+a||0,n=!!n,r=t.MathUtil.clampAngle(r),a=t.MathUtil.clampAngle(a);let h=this._fillPath,o=this._strokePath;h&&(h.lastX=this._lastX,h.lastY=this._lastY,h.drawArc(e,i,s,r,a,n)),o&&(o.lastX=this._lastX,o.lastY=this._lastY,o.drawArc(e,i,s,r,a,n)),n?this.arcBounds(e,i,s,a,r):this.arcBounds(e,i,s,r,a);let l=e+Math.cos(a)*s,c=i+Math.sin(a)*s;this.updatePosition(l,c),this.dirty()}arcBounds(t,e,i,s,r){let a=Math.PI;if(Math.abs(s-r)<.01)return this.extendBoundsByPoint(t-i,e-i),void this.extendBoundsByPoint(t+i,e+i);s>r&&(r+=2*a);let n=Math.cos(s)*i,h=Math.cos(r)*i,o=Math.min(n,h),l=Math.max(n,h),c=Math.sin(s)*i,d=Math.sin(r)*i,u=Math.min(c,d),g=Math.max(c,d),p=s/(.5*a),f=r/(.5*a);for(let t=Math.ceil(p);t<=f;t++)switch(t%4){case 0:l=i;break;case 1:g=i;break;case 2:o=-i;break;case 3:u=-i}o=Math.floor(o),u=Math.floor(u),l=Math.ceil(l),g=Math.ceil(g),this.extendBoundsByPoint(o+t,u+e),this.extendBoundsByPoint(l+t,g+e)}dirty(){this._renderNode.dirtyRender=!0;const t=this._targetDisplay;t.$cacheDirty=!0;let e=t.parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=t.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}extendBoundsByPoint(t,e){this.extendBoundsByX(t),this.extendBoundsByY(e)}extendBoundsByX(t){this._minX=Math.min(this._minX,t-this._topLeftStrokeWidth),this._maxX=Math.max(this._maxX,t+this._bottomRightStrokeWidth),this.updateNodeBounds()}extendBoundsByY(t){this._minY=Math.min(this._minY,t-this._topLeftStrokeWidth),this._maxY=Math.max(this._maxY,t+this._bottomRightStrokeWidth),this.updateNodeBounds()}updateNodeBounds(){let t=this._renderNode;t.x=this._minX,t.y=this._minY,t.width=Math.ceil(this._maxX-this._minX),t.height=Math.ceil(this._maxY-this._minY)}updatePosition(t,e){this._includeLastPosition||(this.extendBoundsByPoint(this._lastX,this._lastY),this._includeLastPosition=!0),this._lastX=t,this._lastY=e,this.extendBoundsByPoint(t,e)}createBezierPoints(t,e){let i=[];for(let s=0;s<e;s++){let r=this.getBezierPointByFactor(t,s/e);r&&i.push(r)}return i}getBezierPointByFactor(e,i){let s=0,r=0,a=0,n=e.length;if(n/2==3){let t=e[s++],n=e[s++],h=e[s++],o=e[s++],l=e[s++],c=e[s++];r=this.getCurvePoint(t,h,l,i),a=this.getCurvePoint(n,o,c,i)}else if(n/2==4){let t=e[s++],n=e[s++],h=e[s++],o=e[s++],l=e[s++],c=e[s++],d=e[s++],u=e[s++];r=this.getCubicCurvePoint(t,h,l,d,i),a=this.getCubicCurvePoint(n,o,c,u,i)}let h=dou.recyclable(t.Point);return h.set(r,a),h}getCurvePoint(t,e,i,s){return Math.pow(1-s,2)*t+2*s*(1-s)*e+Math.pow(s,2)*i}getCubicCurvePoint(t,e,i,s,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*(1-r)*Math.pow(r,2)*i+Math.pow(r,3)*s}$onRemoveFromStage(){this._renderNode&&this._renderNode.clean()}$measureContentBounds(t){this._minX===1/0?t.clear():t.set(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY)}clear(){this._renderNode.clear(),this.updatePosition(0,0),this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0,this.dirty()}}}(dou2d||(dou2d={})),function(t){t.Texture=class{constructor(){this.disposeBitmapData=!0,this.bitmapX=0,this.bitmapY=0,this.bitmapWidth=0,this.bitmapHeight=0,this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this.rotated=!1,this._textureWidth=0,this._textureHeight=0}get textureWidth(){return this.$getTextureWidth()}$getTextureWidth(){return this._textureWidth}$getScaleBitmapWidth(){return this.bitmapWidth*t.sys.textureScaleFactor}get textureHeight(){return this.$getTextureHeight()}$getTextureHeight(){return this._textureHeight}$getScaleBitmapHeight(){return this.bitmapHeight*t.sys.textureScaleFactor}set bitmapData(t){this.$setBitmapData(t)}get bitmapData(){return this.$getBitmapData()}$setBitmapData(e){this._bitmapData=e;let i=t.sys.textureScaleFactor,s=e.width*i,r=e.height*i;this.$initData(0,0,s,r,0,0,s,r,e.width,e.height)}$getBitmapData(){return this._bitmapData}$initData(e,i,s,r,a,n,h,o,l,c,d=!1){let u=t.sys.textureScaleFactor;this.bitmapX=e/u,this.bitmapY=i/u,this.bitmapWidth=s/u,this.bitmapHeight=r/u,this.offsetX=a,this.offsetY=n,this._textureWidth=h,this._textureHeight=o,this.sourceWidth=l,this.sourceHeight=c,this.rotated=d,t.BitmapData.invalidate(this._bitmapData)}dispose(){this._bitmapData&&(this.disposeBitmapData&&this._bitmapData.dispose(),this._bitmapData=null)}}}(dou2d||(dou2d={})),function(t){t.SpriteSheet=class{constructor(t){this._bitmapX=0,this._bitmapY=0,this._textureMap={},this._texture=t,this._bitmapX=t.bitmapX-t.offsetX,this._bitmapY=t.bitmapY-t.offsetY}get texture(){return this._texture}getTexture(t){return this._textureMap[t]}createTexture(e,i,s,r,a,n=0,h=0,o,l){isNaN(o)&&(o=n+r),isNaN(l)&&(l=h+a);let c=new t.Texture;return c.disposeBitmapData=!1,c.bitmapData=this._texture.bitmapData,c.$initData(this._bitmapX+i,this._bitmapY+s,r,a,n,h,o,l,this._texture.sourceWidth,this._texture.sourceHeight),this._textureMap[e]=c,c}dispose(){this._texture&&this._texture.dispose()}}}(dou2d||(dou2d={})),function(t){class e extends t.Texture{constructor(){super(),this.$renderBuffer=new t.rendering.RenderBuffer;let e=new t.BitmapData(this.$renderBuffer.surface);e.deleteSource=!1,this.$setBitmapData(e)}drawToTexture(e,i,s=1){if(i&&(0==i.width||0==i.height))return!1;let r=i||e.$getOriginalBounds();if(0==r.width||0==r.height)return!1;s/=t.sys.textureScaleFactor;let a=(r.x+r.width)*s,n=(r.y+r.height)*s;i&&(a=r.width*s,n=r.height*s);let h=this.$renderBuffer;if(!h)return!1;h.resize(a,n),this.bitmapData.width=a,this.bitmapData.height=n;let o=dou.recyclable(t.Matrix);return o.scale(s,s),i&&o.translate(-i.x,-i.y),t.sys.renderer.render(e,h,o),o.recycle(),this.$initData(0,0,a,n,0,0,a,n,a,n),!0}getPixel32(e,i){let s;if(this.$renderBuffer){let r=t.sys.textureScaleFactor;e=Math.round(e/r),i=Math.round(i/r),s=this.$renderBuffer.getPixels(e,i,1,1)}return s}dispose(){super.dispose(),this.$renderBuffer=null}}t.RenderTexture=e}(dou2d||(dou2d={})),function(t){class e{constructor(){this._dragging=!1,t.sys.stage.on(t.TouchEvent.TOUCH_MOVE,this.stageMoveHandler,this)}static get instance(){return e._instance||(e._instance=new e)}get dragging(){return this._dragging}get originDrag(){return this._originDrag}$dropRegister(e,i){i?(e.on(t.TouchEvent.TOUCH_BEGIN,this.onMove,this),e.on(t.TouchEvent.TOUCH_MOVE,this.onMove,this),e.on(t.TouchEvent.TOUCH_END,this.onEnd,this)):(e.off(t.TouchEvent.TOUCH_BEGIN,this.onMove,this),e.off(t.TouchEvent.TOUCH_MOVE,this.onMove,this),e.off(t.TouchEvent.TOUCH_END,this.onEnd,this))}stageMoveHandler(e){if(this._dragging&&this._dropTarget){let i=!1;(i=this._dropTarget instanceof t.DisplayObjectContainer?!this._dropTarget.contains(e.target):this._dropTarget!==e.target)&&(this._dropTarget.dispatchDragEvent(t.DragEvent.DRAG_EXIT,this._dragData),this._dropTarget=void 0)}}onMove(e){this._dragging&&(this._dropTarget?this._dropTarget.dispatchDragEvent(t.DragEvent.DRAG_MOVE,this._dragData):(this._dropTarget=e.currentTarget,this._dropTarget.dispatchDragEvent(t.DragEvent.DRAG_ENTER,this._dragData)))}onEnd(e){this._dragging&&this._dropTarget&&(this._dropTarget.dispatchDragEvent(t.DragEvent.DRAG_DROP,this._dragData),this._dragging=!1,this._dropTarget=void 0,this._dragData=void 0,this.endDrag())}doDrag(e,i,s,r,a,n,h=1){if(this._dragging=!0,this._originDrag=e,r)this._dragTarget=r;else{let i=new t.RenderTexture;i.drawToTexture(e),this._dragTarget=new t.Bitmap(i)}return this._dragData=s,this._dragTarget.touchEnabled=!1,this._dragTarget instanceof t.DisplayObjectContainer&&(this._dragTarget.touchChildren=!1),this._dragTarget.alpha=h,t.sys.stage.addChild(this._dragTarget),this._offsetX=a,this._offsetY=n,t.sys.stage.on(t.TouchEvent.TOUCH_MOVE,this.onStageMove,this),t.sys.stage.on(t.TouchEvent.TOUCH_END,this.onStageEnd,this),this.onStageMove(i),this._originDrag.dispatchDragEvent(t.DragEvent.DRAG_START,this._dragData),this._dragTarget}onStageMove(t){this._dragTarget.x=t.stageX+this._offsetX,this._dragTarget.y=t.stageY+this._offsetY}onStageEnd(e){this._dragging&&(this._originDrag.dispatchDragEvent(t.DragEvent.DRAG_OVER,this._dragData),this._dragging=!1,this._dropTarget=void 0,this._dragData=void 0,this.endDrag())}endDrag(){t.sys.stage.off(t.TouchEvent.TOUCH_MOVE,this.onStageMove,this),t.sys.stage.off(t.TouchEvent.TOUCH_END,this.onStageEnd,this),t.sys.stage.removeChild(this._dragTarget),this._dragTarget=void 0,this._originDrag=void 0}}t.DragManager=e}(dou2d||(dou2d={})),Object.defineProperties(dou.EventDispatcher.prototype,{dispatchEvent2D:{value:function(t,e,i,s){let r=dou.recyclable(dou2d.Event2D);r.$initEvent2D(t,e,i,s);let a=this.dispatch(r);return r.recycle(),a},enumerable:!1}}),function(t){class e extends dou.Event{constructor(){super(...arguments),this._bubbles=!1,this._isPropagationStopped=!1}get bubbles(){return this._bubbles}get currentTarget(){return this._currentTarget}$initEvent2D(t,e,i,s){this.$initEvent(t,e,s),this._bubbles=i}$setCurrentTarget(t){this._currentTarget=t}stopPropagation(){this._bubbles&&(this._isPropagationStopped=!0)}$isPropagationStopped(){return this._isPropagationStopped}onRecycle(){super.onRecycle(),this._bubbles=!1,this._currentTarget=null,this._isPropagationStopped=!1}}e.ADDED_TO_STAGE="addedToStage",e.REMOVED_FROM_STAGE="removedFromStage",e.ADDED="added",e.REMOVED="removed",e.ENTER_FRAME="enterFrame",e.FIXED_ENTER_FRAME="fixedEnterFrame",e.SHOWED="showed",e.HIDDEN="hidden",e.RENDER="render",e.RESIZE="resize",e.FOCUS_IN="focusIn",e.FOCUS_OUT="focusOut",e.UPDATE_TEXT="updateText",e.LINK="link",t.Event2D=e}(dou2d||(dou2d={})),Object.defineProperties(dou.EventDispatcher.prototype,{dispatchTouchEvent:{value:function(t,e,i,s,r,a,n){let h=dou.recyclable(dou2d.TouchEvent);h.$initTouchEvent(t,e,i,s,r,a,n);let o=this.dispatch(h);return h.recycle(),o},enumerable:!1}}),function(t){class e extends t.Event2D{constructor(){super(...arguments),this._localChanged=!1}get touchPointID(){return this._touchPointID}get touchDown(){return this._touchDown}get stageX(){return this._stageX}get stageY(){return this._stageY}get localX(){return this._localChanged&&this.getLocalPosition(),this._localX}get localY(){return this._localChanged&&this.getLocalPosition(),this._localY}$initTouchEvent(t,e,i,s,r,a,n){this.$initEvent2D(t,null,a,n),this._touchPointID=s,this._touchDown=r,this._stageX=e,this._stageY=i}$setTarget(t){super.$setTarget(t),this._localChanged=!0}getLocalPosition(){this._localChanged=!1;let e=this.target.$getInvertedConcatenatedMatrix(),i=dou.recyclable(t.Point);e.transformPoint(this._stageX,this._stageY,i),this._localX=i.x,this._localY=i.y,i.recycle()}onRecycle(){super.onRecycle(),this._touchPointID=NaN,this._touchDown=!1,this._stageX=NaN,this._stageY=NaN,this._localChanged=!1,this._localX=NaN,this._localY=NaN}}e.TOUCH_BEGIN="touchBegin",e.TOUCH_MOVE="touchMove",e.TOUCH_END="touchEnd",e.TOUCH_CANCEL="touchCancel",e.TOUCH_TAP="touchTap",e.TOUCH_RELEASE_OUTSIDE="touchReleaseOutside",t.TouchEvent=e}(dou2d||(dou2d={})),Object.defineProperties(dou.EventDispatcher.prototype,{dispatchDragEvent:{value:function(t,e,i,s){let r=dou.recyclable(dou2d.DragEvent);r.$initDragEvent(t,e,i,s);let a=this.dispatch(r);return r.recycle(),a},enumerable:!1}}),function(t){class e extends t.Event2D{get dragData(){return this._dragData}$initDragEvent(t,e,i,s){this.$initEvent2D(t,null,i,s),this._dragData=e}onRecycle(){super.onRecycle(),this._dragData=null}}e.DRAG_ENTER="dragEnter",e.DRAG_MOVE="dragMove",e.DRAG_EXIT="dragExit",e.DRAG_DROP="dragDrop",e.DRAG_START="dragStart",e.DRAG_OVER="dragOver",t.DragEvent=e}(dou2d||(dou2d={})),function(t){t.Filter=class{constructor(t){this._paddingTop=0,this._paddingBottom=0,this._paddingLeft=0,this._paddingRight=0,this._type=t,this.$uniforms={}}get type(){return this._type}onPropertyChange(){this.updatePadding()}updatePadding(){}}}(dou2d||(dou2d={})),function(t){class e extends t.Filter{constructor(t=1,e=1,i=1,s=1){super("colorBrush"),this.$uniforms.r=t,this.$uniforms.g=e,this.$uniforms.b=i,this.$uniforms.a=s,this.onPropertyChange()}set r(t){this.$uniforms.r=t,this.onPropertyChange()}get r(){return this.$uniforms.r}set g(t){this.$uniforms.g=t,this.onPropertyChange()}get g(){return this.$uniforms.g}set b(t){this.$uniforms.b=t,this.onPropertyChange()}get b(){return this.$uniforms.b}set a(t){this.$uniforms.a=t,this.onPropertyChange()}get a(){return this.$uniforms.a}}t.ColorBrushFilter=e}(dou2d||(dou2d={})),function(t){class e extends t.Filter{constructor(t){super("colorTransform"),this.$uniforms.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.$uniforms.colorAdd={x:0,y:0,z:0,w:0},this._matrix=[],this.setMatrix(t),this.onPropertyChange()}set matrix(t){this.setMatrix(t)}get matrix(){return this._matrix}setMatrix(t){if(t)for(let e=0;e<20;e++)this._matrix[e]=t[e];else for(let t=0;t<20;t++)this._matrix[t]=0==t||6==t||12==t||18==t?1:0;let e=this._matrix,i=this.$uniforms.matrix,s=this.$uniforms.colorAdd;for(let t=0,r=0;t<e.length;t++)4===t?s.x=e[t]/255:9===t?s.y=e[t]/255:14===t?s.z=e[t]/255:19===t?s.w=e[t]/255:(i[r]=e[t],r++);this.onPropertyChange()}}t.ColorMatrixFilter=e}(dou2d||(dou2d={})),function(t){class e extends t.Filter{constructor(t=4,e=4){super("blur"),this._blurX=t,this._blurY=e,this.$blurXFilter=new i.BlurXFilter(t),this.$blurYFilter=new i.BlurYFilter(e),this.onPropertyChange()}set blurX(t){this._blurX!=t&&(this._blurX=t,this.$blurXFilter.blurX=t,this.onPropertyChange())}get blurX(){return this._blurX}set blurY(t){this._blurY!=t&&(this._blurY=t,this.$blurYFilter.blurY=t,this.onPropertyChange())}get blurY(){return this._blurY}updatePadding(){this._paddingLeft=this._blurX,this._paddingRight=this._blurX,this._paddingTop=this._blurY,this._paddingBottom=this._blurY}}let i;t.BlurFilter=e,function(e){class i extends t.Filter{constructor(t=4){super("blurX"),this.$uniforms.blur={x:t,y:0},this.onPropertyChange()}set blurX(t){this.$uniforms.blur.x=t}get blurX(){return this.$uniforms.blur.x}}e.BlurXFilter=i;class s extends t.Filter{constructor(t=4){super("blurY"),this.$uniforms.blur={x:0,y:t},this.onPropertyChange()}set blurY(t){this.$uniforms.blur.y=t}get blurY(){return this.$uniforms.blur.y}}e.BlurYFilter=s}(i=t.filter||(t.filter={}))}(dou2d||(dou2d={})),function(t){const e={};class i extends t.Filter{constructor(i,s,r={}){super("custom"),this._padding=0,this.$vertexSrc=i,this.$fragmentSrc=s;let a=i+s;e[a]||(e[a]=t.UUID.generate()),this.$shaderKey=e[a],this.$uniforms=r}set padding(t){this._padding!=t&&(this._padding=t,this.onPropertyChange())}get padding(){return this._padding}get uniforms(){return this.$uniforms}onPropertyChange(){}}t.CustomFilter=i}(dou2d||(dou2d={})),function(t){class e extends t.Filter{constructor(t=16711680,e=1,i=6,s=6,r=2,a=!1,n=!1){super("glow"),this._color=t,this._blue=255&t,this._green=(65280&t)>>8,this._red=t>>16,this._alpha=e,this._blurX=i,this._blurY=s,this._strength=r,this._inner=a,this._knockout=n,this.$uniforms.color={x:this._red/255,y:this._green/255,z:this._blue/255,w:1},this.$uniforms.alpha=e,this.$uniforms.blurX=i,this.$uniforms.blurY=s,this.$uniforms.strength=r,this.$uniforms.inner=a?1:0,this.$uniforms.knockout=n?0:1,this.$uniforms.dist=0,this.$uniforms.angle=0,this.$uniforms.hideObject=0,this.onPropertyChange()}set color(t){this._color!=t&&(this._color=t,this._blue=255&t,this._green=(65280&t)>>8,this._red=t>>16,this.$uniforms.color.x=this._red/255,this.$uniforms.color.y=this._green/255,this.$uniforms.color.z=this._blue/255)}get color(){return this._color}set alpha(t){this._alpha!=t&&(this._alpha=t,this.$uniforms.alpha=t)}get alpha(){return this._alpha}set blurX(t){this._blurX!=t&&(this._blurX=t,this.$uniforms.blurX=t,this.onPropertyChange())}get blurX(){return this._blurX}set blurY(t){this._blurY!=t&&(this._blurY=t,this.$uniforms.blurY=t,this.onPropertyChange())}get blurY(){return this._blurY}set strength(t){this._strength!=t&&(this._strength=t,this.$uniforms.strength=t)}get strength(){return this._strength}set inner(t){this._inner!=t&&(this._inner=t,this.$uniforms.inner=t?1:0)}get inner(){return this._inner}set knockout(t){this._knockout!=t&&(this._knockout=t,this.$uniforms.knockout=t?0:1)}get knockout(){return this._knockout}updatePadding(){this._paddingLeft=this._blurX,this._paddingRight=this._blurX,this._paddingTop=this._blurY,this._paddingBottom=this._blurY}}t.GlowFilter=e}(dou2d||(dou2d={})),function(t){class e extends t.GlowFilter{constructor(t=4,e=45,i=0,s=1,r=4,a=4,n=1,h=!1,o=!1,l=!1){super(i,s,r,a,n,h,o),this._distance=t,this._angle=e,this._hideObject=l,this.$uniforms.dist=t,this.$uniforms.angle=e/180*Math.PI,this.$uniforms.hideObject=l?1:0,this.onPropertyChange()}set distance(t){this._distance!=t&&(this._distance=t,this.$uniforms.dist=t,this.onPropertyChange())}get distance(){return this._distance}set angle(t){this._angle!=t&&(this._angle=t,this.$uniforms.angle=t/180*Math.PI,this.onPropertyChange())}get angle(){return this._angle}set hideObject(t){this._hideObject!=t&&(this._hideObject=t,this.$uniforms.hideObject=t?1:0)}get hideObject(){return this._hideObject}updatePadding(){this._paddingLeft=this._blurX,this._paddingRight=this._blurX,this._paddingTop=this._blurY,this._paddingBottom=this._blurY;let t=this._distance||0,e=this._angle||0,i=0,s=0;0!=t&&(i=(i=t*Math.cos(e))>0?Math.ceil(i):Math.floor(i),s=(s=t*Math.sin(e))>0?Math.ceil(s):Math.floor(s),this._paddingLeft+=i,this._paddingRight+=i,this._paddingTop+=s,this._paddingBottom+=s)}}t.DropShadowFilter=e}(dou2d||(dou2d={})),function(t){t.ImageAnalyzer=class{load(t,e,i){let s=new dou.ImageLoader;s.crossOrigin=!0,s.on(dou.Event.COMPLETE,()=>{e.call(i,t,this.createTexture(s.data))}),s.on(dou.IOErrorEvent.IO_ERROR,()=>{e.call(i,t)}),s.load(t)}createTexture(e){let i=new t.BitmapData(e),s=new t.Texture;return s.$setBitmapData(i),s}release(t){return!!t&&(t.dispose(),!0)}}}(dou2d||(dou2d={})),function(t){!function(t){t.RenderNode=class{constructor(){this._renderCount=0,this.drawData=[]}get renderCount(){return this._renderCount}cleanBeforeRender(){this.drawData.length=0,this._renderCount=0}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){class i extends e.RenderNode{constructor(){super(),this.smoothing=!0,this.rotated=!1,this.type=1}static updateTextureData(e,s,r,a,n,h,o,l,c,d,u,g,p,f,_,x){if(!s)return;let m=t.sys.textureScaleFactor;if(e.smoothing=x,e.image=s,e.imageWidth=p,e.imageHeight=f,"scale"==_){let t=u/c*m,i=g/d*m;e.drawImage(r,a,n,h,t*o,i*l,t*n,i*h)}else if("clip"==_){let t=Math.min(c,u),s=Math.min(d,g),p=n*m,f=h*m;i.drawClipImage(e,m,r,a,p,f,o,l,t,s)}else{let t=n*m,s=h*m;for(let n=0;n<u;n+=c)for(let h=0;h<g;h+=d){let p=Math.min(u-n,c),f=Math.min(g-h,d);i.drawClipImage(e,m,r,a,t,s,o,l,p,f,n,h)}}}static drawClipImage(t,e,i,s,r,a,n,h,o,l,c=0,d=0){let u=n+r-o;u>0&&(r-=u),(u=h+a-l)>0&&(a-=u),t.drawImage(i,s,r/e,a/e,c+n,d+h,r,a)}drawImage(t,e,i,s,r,a,n,h){this.sourceX=t,this.sourceY=e,this.sourceW=i,this.sourceH=s,this.drawX=r,this.drawY=a,this.drawW=n,this.drawH=h,this._renderCount=1}cleanBeforeRender(){super.cleanBeforeRender(),this.image=null}}e.NormalBitmapNode=i}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){class i extends e.RenderNode{constructor(){super(),this.smoothing=!0,this.rotated=!1,this.type=2}static updateTextureDataWithScale9Grid(e,i,s,r,a,n,h,o,l,c,d,u,g,p,f,_){e.smoothing=_,e.image=i,e.imageWidth=p,e.imageHeight=f;let x=n,m=h;u-=c-n*t.sys.textureScaleFactor,g-=d-h*t.sys.textureScaleFactor;let y=s.x-o,$=s.y-l,T=y/t.sys.textureScaleFactor,b=$/t.sys.textureScaleFactor,D=s.width/t.sys.textureScaleFactor,v=s.height/t.sys.textureScaleFactor;0==v&&(v=1,b>=m&&b--),0==D&&(D=1,T>=x&&T--);let E=r,w=E+T,C=w+D,S=x-T-D,M=a,R=M+b,B=R+v,A=m-b-v,k=S*t.sys.textureScaleFactor,L=A*t.sys.textureScaleFactor;if((T+S)*t.sys.textureScaleFactor>u||(b+A)*t.sys.textureScaleFactor>g)return void e.drawImage(r,a,n,h,o,l,u,g);let F=o,O=F+y,P=F+(u-k),N=u-y-k,U=l,I=U+$,X=U+g-L,Y=g-$-L;b>0&&(T>0&&e.drawImage(E,M,T,b,F,U,y,$),D>0&&e.drawImage(w,M,D,b,O,U,N,$),S>0&&e.drawImage(C,M,S,b,P,U,k,$)),v>0&&(T>0&&e.drawImage(E,R,T,v,F,I,y,Y),D>0&&e.drawImage(w,R,D,v,O,I,N,Y),S>0&&e.drawImage(C,R,S,v,P,I,k,Y)),A>0&&(T>0&&e.drawImage(E,B,T,A,F,X,y,L),D>0&&e.drawImage(w,B,D,A,O,X,N,L),S>0&&e.drawImage(C,B,S,A,P,X,k,L))}drawImage(t,e,i,s,r,a,n,h){this.drawData.push(t,e,i,s,r,a,n,h),this._renderCount++}cleanBeforeRender(){super.cleanBeforeRender(),this.image=null,this.matrix=null,this.blendMode=null,this.alpha=NaN,this.filter=null}}e.BitmapNode=i}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){class i extends e.RenderNode{constructor(){super(),this.dirtyRender=!0,this.textColor=16777215,this.strokeColor=0,this.size=30,this.stroke=0,this.bold=!1,this.italic=!1,this.fontFamily="Arial",this.type=3}drawText(t,e,i,s){this.drawData.push(t,e,i,s),this._renderCount++,this.dirtyRender=!0}cleanBeforeRender(){super.cleanBeforeRender(),this.dirtyRender=!0}clean(){this.texture&&(t.WebGLUtil.deleteTexture(this.texture),this.texture=null,this.dirtyRender=!0)}}e.TextNode=i}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){e.CAPS_STYLES=["none","round","square"],e.JOINT_STYLES=["bevel","miter","round"];class i extends e.RenderNode{constructor(){super(),this.dirtyRender=!0,this.type=4}beginFill(t,i=1,s){let r=new e.FillPath;if(r.fillColor=t,r.fillAlpha=i,s){let t=this.drawData.lastIndexOf(s);this.drawData.splice(t,0,r)}else this.drawData.push(r);return this._renderCount++,r}beginGradientFill(i,s,r,a,n,h){let o=new t.Matrix;n?(o.a=819.2*n.a,o.b=819.2*n.b,o.c=819.2*n.c,o.d=819.2*n.d,o.tx=n.tx,o.ty=n.ty):(o.a=100,o.d=100);let l=new e.GradientFillPath;if(l.gradientType=i,l.colors=s,l.alphas=r,l.ratios=a,l.matrix=o,h){let t=this.drawData.lastIndexOf(h);this.drawData.splice(t,0,l)}else this.drawData.push(l);return this._renderCount++,l}lineStyle(t,i,s=1,r,a,n=3,h=[]){-1==e.CAPS_STYLES.indexOf(r)&&(r="round"),-1==e.JOINT_STYLES.indexOf(a)&&(a="round");let o=new e.StrokePath;return o.lineWidth=t,o.lineColor=i,o.lineAlpha=s,o.caps=r||"round",o.joints=a,o.miterLimit=n,o.lineDash=h,this.drawData.push(o),this._renderCount++,o}cleanBeforeRender(){}clear(){this.drawData.length=0,this.dirtyRender=!0,this._renderCount=0}clean(){this.texture&&(t.WebGLUtil.deleteTexture(this.texture),this.texture=null,this.dirtyRender=!0)}}e.GraphicsNode=i}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(t){class e extends t.RenderNode{constructor(){super(),this.type=5}get renderCount(){let t=0,e=this.drawData;for(let i=e.length-1;i>=0;i--)t+=e[i].$getRenderCount();return t}addNode(t){this.drawData.push(t)}cleanBeforeRender(){let t=this.drawData;for(let e=t.length-1;e>=0;e--)t[e].cleanBeforeRender()}}t.GroupNode=e}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(t){t.Path2D=class{constructor(){this.lastX=0,this.lastY=0,this.commands=[],this.data=[],this._commandPosition=0,this._dataPosition=0}get type(){return this._type}moveTo(t,e){this.commands[this._commandPosition++]=1;let i=this._dataPosition;this.data[i++]=t,this.data[i++]=e,this._dataPosition=i}lineTo(t,e){this.commands[this._commandPosition++]=2;let i=this._dataPosition;this.data[i++]=t,this.data[i++]=e,this._dataPosition=i}curveTo(t,e,i,s){this.commands[this._commandPosition++]=3;let r=this._dataPosition;this.data[r++]=t,this.data[r++]=e,this.data[r++]=i,this.data[r++]=s,this._dataPosition=r}cubicCurveTo(t,e,i,s,r,a){this.commands[this._commandPosition++]=4;let n=this._dataPosition;this.data[n++]=t,this.data[n++]=e,this.data[n++]=i,this.data[n++]=s,this.data[n++]=r,this.data[n++]=a,this._dataPosition=n}drawRect(t,e,i,s){let r=t+i,a=e+s;this.moveTo(t,e),this.lineTo(r,e),this.lineTo(r,a),this.lineTo(t,a),this.lineTo(t,e)}drawRoundRect(t,e,i,s,r,a){let n=.5*r|0,h=a?.5*a|0:n;if(!n||!h)return void this.drawRect(t,e,i,s);let o=.5*i,l=.5*s;if(n>o&&(n=o),h>l&&(h=l),o===n&&l===h)return void(n===h?this.drawCircle(t+n,e+h,n):this.drawEllipse(t,e,2*n,2*h));let c=t+i,d=e+s,u=t+n,g=c-n,p=e+h,f=d-h;this.moveTo(c,f),this.curveTo(c,d,g,d),this.lineTo(u,d),this.curveTo(t,d,t,f),this.lineTo(t,p),this.curveTo(t,e,u,e),this.lineTo(g,e),this.curveTo(c,e,c,p),this.lineTo(c,f)}drawCircle(t,e,i){this.arcToBezier(t,e,i,i,0,2*Math.PI)}drawEllipse(t,e,i,s){let r=.5*i,a=.5*s;t+=r,e+=a,this.arcToBezier(t,e,r,a,0,2*Math.PI)}drawArc(t,e,i,s,r,a){a?r>=s&&(r-=2*Math.PI):r<=s&&(r+=2*Math.PI),this.arcToBezier(t,e,i,i,s,r,a)}arcToBezier(t,e,i,s,r,a,n){let h=.5*Math.PI,o=r,l=o;n?(l+=-h-o%h)<a&&(l=a):(l+=h-o%h)>a&&(l=a);let c=t+Math.cos(o)*i,d=e+Math.sin(o)*s;this.lastX==c&&this.lastY==d||this.moveTo(c,d);let u=Math.cos(o),g=Math.sin(o);for(let r=0;r<4;r++){let r=l-o,p=4*Math.tan(r/4)/3,f=c-g*p*i,_=d+u*p*s,x=(c=t+(u=Math.cos(l))*i)+(g=Math.sin(l))*p*i,m=(d=e+g*s)-u*p*s;if(this.cubicCurveTo(f,_,x,m,c,d),l===a)break;o=l,n?(l=o-h)<a&&(l=a):(l=o+h)>a&&(l=a)}}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(t){class e extends t.Path2D{constructor(){super(),this._type=1}}t.FillPath=e}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(t){class e extends t.Path2D{constructor(){super(),this._type=3}}t.StrokePath=e}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(t){class e extends t.Path2D{constructor(){super(),this._type=2}}t.GradientFillPath=e}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){class i{constructor(i,s,r){if(this.globalAlpha=1,this.globalTintColor=16777215,this._stencilState=!1,this.stencilList=[],this.stencilHandleCount=0,this.scissorState=!1,this._scissorRect=new t.Rectangle,this.hasScissor=!1,this.drawCalls=0,this.computeDrawCall=!1,this.globalMatrix=new t.Matrix,this.savedGlobalMatrix=new t.Matrix,this.offsetX=0,this.offsetY=0,this.context=e.RenderContext.getInstance(i,s),this.renderTarget=new e.RenderTarget(this.context.context,3,3),i&&s&&this.resize(i,s),this._root=r,this._root)this.context.pushBuffer(this),this.surface=this.context.surface,this.computeDrawCall=!0;else{let t=this.context.activatedBuffer;t&&t.renderTarget.activate(),this.renderTarget.initFrameBuffer(),this.surface=this.renderTarget}}static get(t,e){let s=i._renderBufferPool.pop();if(s){s.resize(t,e);let i=s.globalMatrix;i.a=1,i.b=0,i.c=0,i.d=1,i.tx=0,i.ty=0,s.globalAlpha=1,s.offsetX=0,s.offsetY=0}else(s=new i(t,e)).computeDrawCall=!1;return s}static put(t){i._renderBufferPool.push(t)}get width(){return this.renderTarget.width}get height(){return this.renderTarget.height}enableStencil(){this._stencilState||(this.context.enableStencilTest(),this._stencilState=!0)}disableStencil(){this._stencilState&&(this.context.disableStencilTest(),this._stencilState=!1)}restoreStencil(){this._stencilState?this.context.enableStencilTest():this.context.disableStencilTest()}enableScissor(t,e,i,s){this.scissorState||(this.scissorState=!0,this._scissorRect.set(t,e,i,s),this.context.enableScissorTest(this._scissorRect))}disableScissor(){this.scissorState&&(this.scissorState=!1,this._scissorRect.clear(),this.context.disableScissorTest())}restoreScissor(){this.scissorState?this.context.enableScissorTest(this._scissorRect):this.context.disableScissorTest()}resize(t,e,i){t=t||1,e=e||1,this.context.pushBuffer(this),t==this.renderTarget.width&&e==this.renderTarget.height||(this.context.drawCommand.pushResize(this,t,e),this.renderTarget.width=t,this.renderTarget.height=e),this._root&&this.context.resize(t,e,i),this.context.clear(),this.context.popBuffer()}setTransform(t,e,i,s,r,a){let n=this.globalMatrix;n.a=t,n.b=e,n.c=i,n.d=s,n.tx=r,n.ty=a}transform(t,e,i,s,r,a){let n=this.globalMatrix,h=n.a,o=n.b,l=n.c,c=n.d;1==t&&0==e&&0==i&&1==s||(n.a=t*h+e*l,n.b=t*o+e*c,n.c=i*h+s*l,n.d=i*o+s*c),n.tx=r*h+a*l+n.tx,n.ty=r*o+a*c+n.ty}useOffset(){0==this.offsetX&&0==this.offsetY||(this.globalMatrix.append(1,0,0,1,this.offsetX,this.offsetY),this.offsetX=this.offsetY=0)}saveTransform(){let t=this.globalMatrix,e=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty}restoreTransform(){let t=this.globalMatrix,e=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty}getPixels(t,e,i=1,s=1){let r=new Uint8Array(4*i*s),a=this.renderTarget.useFrameBuffer;this.renderTarget.useFrameBuffer=!0,this.renderTarget.activate(),this.context.getPixels(t,e,i,s,r),this.renderTarget.useFrameBuffer=a,this.renderTarget.activate();let n=new Uint8Array(4*i*s);for(let t=0;t<s;t++)for(let e=0;e<i;e++){let a=4*(i*(s-t-1)+e),h=4*(i*t+e),o=r[h+3];n[a]=Math.round(r[h]/o*255),n[a+1]=Math.round(r[h+1]/o*255),n[a+2]=Math.round(r[h+2]/o*255),n[a+3]=r[h+3]}return n}toDataURL(t,e){return this.context.surface.toDataURL(t,e)}onRenderFinish(){this.drawCalls=0}clear(){this.context.pushBuffer(this),this.context.clear(),this.context.popBuffer()}destroy(){this.context.destroy()}}i._renderBufferPool=[],e.RenderBuffer=i}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){e.RenderTarget=class{constructor(t,e,i){this.useFrameBuffer=!0,this.clearColor=[0,0,0,0],this._gl=t,this.setSize(e,i)}initFrameBuffer(){if(!this._frameBuffer){let t=this._gl;this.texture=this.createTexture(),this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}}createTexture(){const i=e.RenderContext.getInstance();return t.WebGLUtil.createTexture(i,this.width,this.height,null)}activate(){let t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer())}getFrameBuffer(){return this.useFrameBuffer?this._frameBuffer:null}enabledStencil(){if(!this._frameBuffer||this._stencilBuffer)return;let t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),this._stencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._stencilBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this._stencilBuffer)}resize(t,e){this.setSize(t,e);let i=this._gl;this._frameBuffer&&(i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null)),this._stencilBuffer&&(i.deleteRenderbuffer(this._stencilBuffer),this._stencilBuffer=null)}setSize(t,e){(t=t||1)<1&&(t=1),(e=e||1)<1&&(e=1),this.width=t,this.height=e}clear(t){let e=this._gl;t&&this.activate(),e.colorMask(!0,!0,!0,!0),e.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),e.clear(e.COLOR_BUFFER_BIT)}dispose(){t.WebGLUtil.deleteTexture(this.texture)}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){class i{constructor(i,s){this.contextLost=!1,this._projectionX=NaN,this._projectionY=NaN,this.surface=t.HtmlUtil.createCanvas(i,s),this.initWebGL(),this.bufferStack=[];let r=this.context;this._vertexBuffer=r.createBuffer(),this._indexBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this._vertexBuffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this._indexBuffer),this.drawCommand=new e.DrawCommand,this._vertexData=new e.VertexData,this.setGlobalCompositeOperation("source-over")}static getInstance(t,e){return i._instance||(i._instance=new i(t,e))}initWebGL(){this.onResize(),this.surface.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1),this.surface.addEventListener("webglcontextrestored",this.handleContextRestored.bind(this),!1),this.getWebGLContext();let t=this.context;this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}handleContextLost(){this.contextLost=!0}handleContextRestored(){this.initWebGL(),this.contextLost=!1}getWebGLContext(){const e=t.HtmlUtil.getWebGLContext(this.surface);this.setContext(e)}setContext(t){this.context=t,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.colorMask(!0,!0,!0,!0),t.activeTexture(t.TEXTURE0)}pushBuffer(t){this.bufferStack.push(t),t!=this._currentBuffer&&this.drawCommand.pushActivateBuffer(t),this._currentBuffer=t}popBuffer(){if(this.bufferStack.length<=1)return;let t=this.bufferStack.pop(),e=this.bufferStack[this.bufferStack.length-1];t!=e&&this.drawCommand.pushActivateBuffer(e),this._currentBuffer=e}activateBuffer(t,e,i){t.renderTarget.activate(),this._bindIndices||this.uploadIndicesArray(this._vertexData.getIndices()),t.restoreStencil(),t.restoreScissor(),this.onResize(e,i)}uploadVerticesArray(t){let e=this.context;e.bufferData(e.ARRAY_BUFFER,t,e.STREAM_DRAW)}uploadIndicesArray(t){let e=this.context;e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this._bindIndices=!0}onResize(t,e){t=t||this.surface.width,e=e||this.surface.height,this._projectionX=t/2,this._projectionY=-e/2,this.context&&this.context.viewport(0,0,t,e)}resize(e,i,s){t.HtmlUtil.resizeContext(this,e,i,s)}enableStencilTest(){let t=this.context;t.enable(t.STENCIL_TEST)}disableStencilTest(){let t=this.context;t.disable(t.STENCIL_TEST)}enableScissorTest(t){let e=this.context;e.enable(e.SCISSOR_TEST),e.scissor(t.x,t.y,t.width,t.height)}disableScissorTest(){let t=this.context;t.disable(t.SCISSOR_TEST)}getPixels(t,e,i,s,r){let a=this.context;a.readPixels(t,e,i,s,a.RGBA,a.UNSIGNED_BYTE,r)}createTexture(e){return t.WebGLUtil.createTexture(this,e)}updateTexture(t,e){let i=this.context;i.bindTexture(i.TEXTURE_2D,t),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}getTexture(e){return e.webGLTexture||(e.webGLTexture=this.createTexture(e.source),e.deleteSource&&e.webGLTexture&&e.source&&(e.source.src="",e.source=null),e.webGLTexture&&(e.webGLTexture[t.sys.smoothing]=!0)),e.webGLTexture}setGlobalCompositeOperation(t){this.drawCommand.pushSetBlend(t)}drawImage(t,e,i,s,r,a,n,h,o,l,c,d,u){let g,p,f,_=this._currentBuffer;if(!this.contextLost&&t&&_){if(t.texture||t.source&&t.source.texture)g=t.texture||t.source.texture,_.saveTransform(),p=_.offsetX,f=_.offsetY,_.useOffset(),_.transform(1,0,0,-1,0,o+2*n);else{if(!t.source&&!t.webGLTexture)return;g=this.getTexture(t)}g&&(this.drawTexture(g,e,i,s,r,a,n,h,o,l,c,d,u),t.source&&t.source.texture&&(_.offsetX=p,_.offsetY=f,_.restoreTransform()))}}drawTexture(e,i,s,r,a,n,h,o,l,c,d,u,g){let p=this._currentBuffer;!this.contextLost&&e&&p&&(this._vertexData.reachMaxSize()&&this.draw(),null!=g&&e[t.sys.smoothing]!=g&&this.drawCommand.pushChangeSmoothing(e,g),this.drawCommand.pushDrawTexture(e,2,this.colorMatrixFilter,c,d),p.currentTexture=e,this._vertexData.cacheArrays(p,i,s,r,a,n,h,o,l,c,d,u))}drawRect(t,e,i,s){let r=this._currentBuffer;!this.contextLost&&r&&(this._vertexData.reachMaxSize()&&this.draw(),this.drawCommand.pushDrawRect(),r.currentTexture=null,this._vertexData.cacheArrays(r,0,0,i,s,t,e,i,s,i,s))}pushMask(t,e,i,s){let r=this._currentBuffer;!this.contextLost&&r&&(r.stencilList.push({x:t,y:e,width:i,height:s}),this._vertexData.reachMaxSize()&&this.draw(),this.drawCommand.pushPushMask(),r.currentTexture=null,this._vertexData.cacheArrays(r,0,0,i,s,t,e,i,s,i,s))}popMask(){let t=this._currentBuffer;if(this.contextLost||!t)return;let e=t.stencilList.pop();this._vertexData.reachMaxSize()&&this.draw(),this.drawCommand.pushPopMask(),t.currentTexture=null,this._vertexData.cacheArrays(t,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}enableScissor(t,e,i,s){let r=this._currentBuffer;this.drawCommand.pushEnableScissor(t,e,i,s),r.hasScissor=!0}disableScissor(){let t=this._currentBuffer;this.drawCommand.pushDisableScissor(),t.hasScissor=!1}draw(){if(0==this.drawCommand.drawDataLen||this.contextLost)return;this.uploadVerticesArray(this._vertexData.getVertices());let t=this.drawCommand.drawDataLen,e=0;for(let i=0;i<t;i++){let t=this.drawCommand.drawData[i];e=this.drawData(t,e),7==t.type&&(this.activatedBuffer=t.buffer),0!=t.type&&1!=t.type&&2!=t.type&&3!=t.type||this.activatedBuffer&&this.activatedBuffer.computeDrawCall&&this.activatedBuffer.drawCalls++}this.drawCommand.clear(),this._vertexData.clear()}drawData(t,i){if(!t)return;let s,r=this.context,a=t.filter;switch(t.type){case 0:a?"custom"===a.type?s=e.Program.getProgram(a.$shaderKey,r,a.$vertexSrc,a.$fragmentSrc):"colorBrush"===a.type?s=e.Program.getProgram("colorBrush",r,e.ShaderLib.default_vs,e.ShaderLib.colorBrush_fs):"colorTransform"===a.type?s=e.Program.getProgram("colorTransform",r,e.ShaderLib.default_vs,e.ShaderLib.colorTransform_fs):"blurX"===a.type?s=e.Program.getProgram("blur",r,e.ShaderLib.default_vs,e.ShaderLib.blur_fs):"blurY"===a.type?s=e.Program.getProgram("blur",r,e.ShaderLib.default_vs,e.ShaderLib.blur_fs):"glow"===a.type&&(s=e.Program.getProgram("glow",r,e.ShaderLib.default_vs,e.ShaderLib.glow_fs)):s=e.Program.getProgram("texture",r,e.ShaderLib.default_vs,e.ShaderLib.texture_fs),this.activeProgram(r,s),this.syncUniforms(s,a,t.textureWidth,t.textureHeight),i+=this.drawTextureElements(t,i);break;case 1:s=e.Program.getProgram("primitive",r,e.ShaderLib.default_vs,e.ShaderLib.primitive_fs),this.activeProgram(r,s),this.syncUniforms(s,a,t.textureWidth,t.textureHeight),i+=this.drawRectElements(t,i);break;case 2:s=e.Program.getProgram("primitive",r,e.ShaderLib.default_vs,e.ShaderLib.primitive_fs),this.activeProgram(r,s),this.syncUniforms(s,a,t.textureWidth,t.textureHeight),i+=this.drawPushMaskElements(t,i);break;case 3:s=e.Program.getProgram("primitive",r,e.ShaderLib.default_vs,e.ShaderLib.primitive_fs),this.activeProgram(r,s),this.syncUniforms(s,a,t.textureWidth,t.textureHeight),i+=this.drawPopMaskElements(t,i);break;case 4:this.setBlendMode(t.value);break;case 5:t.buffer.renderTarget.resize(t.width,t.height),this.onResize(t.width,t.height);break;case 6:if(this.activatedBuffer){let t=this.activatedBuffer.renderTarget;0==t.width&&0==t.height||t.clear(!0)}break;case 7:this.activateBuffer(t.buffer,t.width,t.height);break;case 8:let n=this.activatedBuffer;n&&(n.renderTarget&&n.renderTarget.enabledStencil(),n.enableScissor(t.x,t.y,t.width,t.height));break;case 9:(n=this.activatedBuffer)&&n.disableScissor();break;case 10:r.bindTexture(r.TEXTURE_2D,t.texture),t.smoothing?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST))}return i}activeProgram(t,e){if(e!=this.currentProgram){t.useProgram(e.program);let i=e.attributes;for(let e in i)"aVertexPosition"===e?(t.vertexAttribPointer(i.aVertexPosition.location,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(i.aVertexPosition.location)):"aTextureCoord"===e?(t.vertexAttribPointer(i.aTextureCoord.location,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(i.aTextureCoord.location)):"aColor"===e&&(t.vertexAttribPointer(i.aColor.location,4,t.UNSIGNED_BYTE,!0,20,16),t.enableVertexAttribArray(i.aColor.location));this.currentProgram=e}}syncUniforms(t,e,i,s){let r=t.uniforms;e&&e.type;for(let t in r)if("projectionVector"===t)r[t].setValue({x:this._projectionX,y:this._projectionY});else if("uTextureSize"===t)r[t].setValue({x:i,y:s});else if("uSampler"===t)r[t].setValue(0);else if("uSamplerAlphaMask"===t)r[t].setValue(1);else{let i=e.$uniforms[t];void 0!==i&&r[t].setValue(i)}}drawTextureElements(t,e){let i=this.context;i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.texture);let s=3*t.count;return i.drawElements(i.TRIANGLES,s,i.UNSIGNED_SHORT,2*e),s}drawRectElements(t,e){let i=this.context,s=3*t.count;return i.drawElements(i.TRIANGLES,s,i.UNSIGNED_SHORT,2*e),s}drawPushMaskElements(t,e){let i=this.context,s=3*t.count,r=this.activatedBuffer;if(r){r.renderTarget&&r.renderTarget.enabledStencil(),0==r.stencilHandleCount&&(r.enableStencil(),i.clear(i.STENCIL_BUFFER_BIT));let t=r.stencilHandleCount;r.stencilHandleCount++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,t,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR),i.drawElements(i.TRIANGLES,s,i.UNSIGNED_SHORT,2*e),i.stencilFunc(i.EQUAL,t+1,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return s}drawPopMaskElements(t,e){let i=this.context,s=3*t.count,r=this.activatedBuffer;if(r)if(r.stencilHandleCount--,0==r.stencilHandleCount)r.disableStencil();else{let t=r.stencilHandleCount;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,t+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR),i.drawElements(i.TRIANGLES,s,i.UNSIGNED_SHORT,2*e),i.stencilFunc(i.EQUAL,t,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return s}setBlendMode(t){let e=this.context;switch(t){case"source-over":e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case"lighter":e.blendFunc(e.ONE,e.ONE);break;case"lighter-in":e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);break;case"destination-out":e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_ALPHA);break;case"destination-in":e.blendFunc(e.ZERO,e.SRC_ALPHA)}}drawTargetWidthFilters(t,i){let s,r=i,a=t.length;if(a>1)for(let n=0;n<a-1;n++){let a=t[n],h=i.renderTarget.width,o=i.renderTarget.height;(s=e.RenderBuffer.get(h,o)).setTransform(1,0,0,1,0,0),s.globalAlpha=1,this.drawToRenderTarget(a,i,s),i!=r&&e.RenderBuffer.put(i),i=s}let n=t[a-1];this.drawToRenderTarget(n,i,this._currentBuffer),i!=r&&e.RenderBuffer.put(i)}drawToRenderTarget(t,i,s){if(this.contextLost)return;this._vertexData.reachMaxSize()&&this.draw(),this.pushBuffer(s);let r,a=i,n=i.renderTarget.width,h=i.renderTarget.height;if("blur"==t.type){let s=t.$blurXFilter,o=t.$blurYFilter;0!=s.blurX&&0!=o.blurY?((r=e.RenderBuffer.get(n,h)).setTransform(1,0,0,1,0,0),r.globalAlpha=1,this.drawToRenderTarget(t.$blurXFilter,i,r),i!=a&&e.RenderBuffer.put(i),i=r,t=o):t=0===s.blurX?o:s}s.saveTransform(),s.transform(1,0,0,-1,0,h),s.currentTexture=i.renderTarget.texture,this._vertexData.cacheArrays(s,0,0,n,h,0,0,n,h,n,h),s.restoreTransform(),this.drawCommand.pushDrawTexture(i.renderTarget.texture,2,t,n,h),i!=a&&e.RenderBuffer.put(i),this.popBuffer()}clearRect(t,e,i,s){if(0!=t||0!=e||i!=this.surface.width||s!=this.surface.height){let r=this._currentBuffer;if(r.hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(t,e,i,s),this.setGlobalCompositeOperation("source-over");else{let a=r.globalMatrix;0==a.b&&0==a.c?(t=t*a.a+a.tx,e=e*a.d+a.ty,i*=a.a,s*=a.d,this.enableScissor(t,-e-s+r.height,i,s),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(t,e,i,s),this.setGlobalCompositeOperation("source-over"))}}else this.clear()}clear(){this.drawCommand.pushClearColor()}destroy(){this.surface.width=this.surface.height=0}}e.RenderContext=i}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){e.DrawCommand=class{constructor(){this.drawData=[],this.drawDataLen=0}pushDrawRect(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){let t=this.drawData[this.drawDataLen]||{};t.type=1,t.count=0,this.drawData[this.drawDataLen]=t,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2}pushDrawTexture(t,e=2,i,s,r){if(i){let a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=t,a.filter=i,a.count=e,a.textureWidth=s,a.textureHeight=r,this.drawData[this.drawDataLen]=a,this.drawDataLen++}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||t!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){let e=this.drawData[this.drawDataLen]||{};e.type=0,e.texture=t,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=e}}pushChangeSmoothing(e,i){e[t.sys.smoothing]=i;let s=this.drawData[this.drawDataLen]||{};s.type=10,s.texture=e,s.smoothing=i,this.drawData[this.drawDataLen]=s,this.drawDataLen++}pushPushMask(t=1){let e=this.drawData[this.drawDataLen]||{};e.type=2,e.count=2*t,this.drawData[this.drawDataLen]=e,this.drawDataLen++}pushPopMask(t=1){let e=this.drawData[this.drawDataLen]||{};e.type=3,e.count=2*t,this.drawData[this.drawDataLen]=e,this.drawDataLen++}pushSetBlend(t){let e=!1;for(let i=this.drawDataLen-1;i>=0;i--){let s=this.drawData[i];if(s){if(0!=s.type&&1!=s.type||(e=!0),!e&&4==s.type){this.drawData.splice(i,1),this.drawDataLen--;continue}if(4==s.type){if(s.value==t)return;break}}}let i=this.drawData[this.drawDataLen]||{};i.type=4,i.value=t,this.drawData[this.drawDataLen]=i,this.drawDataLen++}pushResize(t,e,i){let s=this.drawData[this.drawDataLen]||{};s.type=5,s.buffer=t,s.width=e,s.height=i,this.drawData[this.drawDataLen]=s,this.drawDataLen++}pushClearColor(){let t=this.drawData[this.drawDataLen]||{};t.type=6,this.drawData[this.drawDataLen]=t,this.drawDataLen++}pushActivateBuffer(t){let e=!1;for(let t=this.drawDataLen-1;t>=0;t--){let i=this.drawData[t];!i||(4!=i.type&&7!=i.type&&(e=!0),e||7!=i.type)||(this.drawData.splice(t,1),this.drawDataLen--)}let i=this.drawData[this.drawDataLen]||{};i.type=7,i.buffer=t,i.width=t.renderTarget.width,i.height=t.renderTarget.height,this.drawData[this.drawDataLen]=i,this.drawDataLen++}pushEnableScissor(t,e,i,s){let r=this.drawData[this.drawDataLen]||{};r.type=8,r.x=t,r.y=e,r.width=i,r.height=s,this.drawData[this.drawDataLen]=r,this.drawDataLen++}pushDisableScissor(){let t=this.drawData[this.drawDataLen]||{};t.type=9,this.drawData[this.drawDataLen]=t,this.drawDataLen++}clear(){for(let t=0;t<this.drawDataLen;t++){let e=this.drawData[t];e.type=0,e.count=0,e.texture=null,e.filter=null,e.value="",e.buffer=null,e.width=0,e.height=0,e.textureWidth=0,e.textureHeight=0,e.smoothing=!1,e.x=0,e.y=0}this.drawDataLen=0}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){class i{constructor(){this._vertexIndex=0,this._indexIndex=0;let t=new ArrayBuffer(i.maxVertexCount*i.vertByteSize);this._verticesFloat32View=new Float32Array(t),this._verticesUint32View=new Uint32Array(t),this._vertices=this._verticesFloat32View,this._indices=new Uint16Array(i.maxIndicesCount);for(let t=0,e=0;t<i.maxIndicesCount;t+=6,e+=4)this._indices[t+0]=e+0,this._indices[t+1]=e+1,this._indices[t+2]=e+2,this._indices[t+3]=e+0,this._indices[t+4]=e+2,this._indices[t+5]=e+3}reachMaxSize(t=4,e=6){return this._vertexIndex>i.maxVertexCount-t||this._indexIndex>i.maxIndicesCount-e}getVertices(){return this._vertices.subarray(0,this._vertexIndex*i.vertSize)}getIndices(){return this._indices}cacheArrays(e,s,r,a,n,h,o,l,c,d,u,g){let p=e.globalAlpha;p=Math.min(p,1);let f=e.globalTintColor||16777215,_=e.currentTexture;p=p<1&&_&&_[t.sys.unpackPremultiplyAlphaWebgl]?t.WebGLUtil.premultiplyTint(f,p):f+(255*p<<24);let x=e.globalMatrix,m=x.a,y=x.b,$=x.c,T=x.d,b=x.tx,D=x.ty,v=e.offsetX,E=e.offsetY;0==v&&0==E||(b=v*m+E*$+b,D=v*y+E*T+D),0==h&&0==o||(b=h*m+o*$+b,D=h*y+o*T+D);let w=l/a;1!=w&&(m*=w,y*=w);let C=c/n;1!=C&&($*=C,T*=C);let S=d,M=u,R=a,B=n;s/=S,r/=M;let A=this._vertices,k=this._verticesUint32View,L=this._vertexIndex*i.vertSize;if(g){let t=a;a=n/S,n=t/M,A[L++]=b,A[L++]=D,A[L++]=a+s,A[L++]=r,k[L++]=p,A[L++]=m*R+b,A[L++]=y*R+D,A[L++]=a+s,A[L++]=n+r,k[L++]=p,A[L++]=m*R+$*B+b,A[L++]=T*B+y*R+D,A[L++]=s,A[L++]=n+r,k[L++]=p,A[L++]=$*B+b,A[L++]=T*B+D,A[L++]=s,A[L++]=r,k[L++]=p}else a/=S,n/=M,A[L++]=b,A[L++]=D,A[L++]=s,A[L++]=r,k[L++]=p,A[L++]=m*R+b,A[L++]=y*R+D,A[L++]=a+s,A[L++]=r,k[L++]=p,A[L++]=m*R+$*B+b,A[L++]=T*B+y*R+D,A[L++]=a+s,A[L++]=n+r,k[L++]=p,A[L++]=$*B+b,A[L++]=T*B+D,A[L++]=s,A[L++]=n+r,k[L++]=p;this._vertexIndex+=4,this._indexIndex+=6}clear(){this._vertexIndex=0,this._indexIndex=0}}i.vertSize=5,i.vertByteSize=4*i.vertSize,i.maxQuadsCount=2048,i.maxVertexCount=4*i.maxQuadsCount,i.maxIndicesCount=6*i.maxQuadsCount,e.VertexData=i}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){class i{constructor(i){this.offsetX=0,this.offsetY=0,this.canvasScaleX=1,this.canvasScaleY=1,this._isStage=!1,this.root=i,this._isStage=i instanceof t.Stage,this.renderNode=new e.BitmapNode,this._offsetMatrix=new t.Matrix}static create(t){let s=new i(t);try{let t=new e.RenderBuffer;s.renderBuffer=t}catch(t){return null}return s.root=t,s}static setCanvasScale(t,e){i.canvasScaleX=t,i.canvasScaleY=e}setClipRect(t,e){t*=i.canvasScaleX,e*=i.canvasScaleY,this.renderBuffer.resize(t,e)}drawToSurface(){let e=0;this.canvasScaleX=this._offsetMatrix.a=i.canvasScaleX,this.canvasScaleY=this._offsetMatrix.d=i.canvasScaleY,this._isStage||this.changeSurfaceSize();let s=this.renderBuffer;if(s.clear(),e=t.sys.renderer.render(this.root,s,this._offsetMatrix),!this._isStage){let e=s.surface,i=this.renderNode;i.drawData.length=0;let r=e.width,a=e.height;this._bitmapData?(this._bitmapData.source=e,this._bitmapData.width=r,this._bitmapData.height=a):this._bitmapData=new t.BitmapData(e),i.image=this._bitmapData,i.imageWidth=r,i.imageHeight=a,i.drawImage(0,0,r,a,-this.offsetX,-this.offsetY,r/this.canvasScaleX,a/this.canvasScaleY)}return e}changeSurfaceSize(){let t=this.offsetX,e=this.offsetY,i=this.root.$getOriginalBounds(),s=this.canvasScaleX,r=this.canvasScaleY;this.offsetX=-i.x,this.offsetY=-i.y,this._offsetMatrix.set(this._offsetMatrix.a,0,0,this._offsetMatrix.d,this.offsetX,this.offsetY);let a=this.renderBuffer,n=Math.max(257,i.width*s),h=Math.max(257,i.height*r);this.offsetX==t&&this.offsetY==e&&a.surface.width==n&&a.surface.height==h||a.resize(n,h)}}i.canvasScaleFactor=1,i.canvasScaleX=1,i.canvasScaleY=1,e.DisplayList=i}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){e.CanvasRenderBuffer=class{constructor(e,i){this.surface=t.HtmlUtil.createCanvas(e,i),this.context=this.surface.getContext("2d"),this.context&&(this.context.$offsetX=0,this.context.$offsetY=0),this.resize(e,i)}get width(){return this.surface.width}get height(){return this.surface.height}resize(t,e,i){let s=this,r=s.surface;if(i){let i=!1;r.width<t&&(r.width=t,i=!0),r.height<e&&(r.height=e,i=!0),i||(s.context.globalCompositeOperation="source-over",s.context.setTransform(1,0,0,1,0,0),s.context.globalAlpha=1)}else r.width!=t&&(r.width=t),r.height!=e&&(r.height=e);s.clear()}getPixels(t,e,i=1,s=1){return this.context.getImageData(t,e,i,s).data}toDataURL(t,e){return this.surface.toDataURL(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)}destroy(){this.surface.width=this.surface.height=0}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){e.CanvasRenderer=class{renderText(e,i){i.textAlign="left",i.textBaseline="middle",i.lineJoin="round";let s=e.drawData,r=s.length,a=0;for(;a<r;){let r=s[a++],n=s[a++],h=s[a++],o=s[a++];i.font=t.HtmlUtil.getFontString(e,o);let l=null==o.textColor?e.textColor:o.textColor,c=null==o.strokeColor?e.strokeColor:o.strokeColor,d=null==o.stroke?e.stroke:o.stroke;i.fillStyle=t.HtmlUtil.toColorString(l),i.strokeStyle=t.HtmlUtil.toColorString(c),d&&(i.lineWidth=2*d,i.strokeText(h,r+i.$offsetX,n+i.$offsetY)),i.fillText(h,r+i.$offsetX,n+i.$offsetY)}}renderGraphics(t,i){let s=t.drawData,r=s.length;for(let t=0;t<r;t++){let r=s[t];switch(r.type){case 1:let t=r;i.fillStyle=this.getRGBAString(t.fillColor,t.fillAlpha),this.renderPath(r,i),i.fill();break;case 2:let s=r;i.fillStyle=this.getGradient(i,s.gradientType,s.colors,s.alphas,s.ratios,s.matrix),i.save();let a=s.matrix;this.renderPath(r,i),i.transform(a.a,a.b,a.c,a.d,a.tx,a.ty),i.fill(),i.restore();break;case 3:let n=r,h=n.lineWidth;i.lineWidth=h,i.strokeStyle=this.getRGBAString(n.lineColor,n.lineAlpha),i.lineCap=e.CAPS_STYLES[n.caps],i.lineJoin=n.joints,i.miterLimit=n.miterLimit,i.setLineDash&&i.setLineDash(n.lineDash);let o=1===h||3===h;o&&i.translate(.5,.5),this.renderPath(r,i),i.stroke(),o&&i.translate(-.5,-.5)}}return 0==r?0:1}getRGBAString(t,e){return"rgba("+(t>>16)+","+(t>>8&255)+","+(255&t)+","+e+")"}getGradient(t,e,i,s,r,a){let n;n="linear"==e?t.createLinearGradient(-1,0,1,0):t.createRadialGradient(0,0,0,0,0,1);let h=i.length;for(let t=0;t<h;t++)n.addColorStop(r[t]/255,this.getRGBAString(i[t],s[t]));return n}renderPath(t,e){e.beginPath();let i=t.data,s=t.commands,r=s.length,a=0;for(let t=0;t<r;t++){switch(s[t]){case 4:e.bezierCurveTo(i[a++]+e.$offsetX,i[a++]+e.$offsetY,i[a++]+e.$offsetX,i[a++]+e.$offsetY,i[a++]+e.$offsetX,i[a++]+e.$offsetY);break;case 3:e.quadraticCurveTo(i[a++]+e.$offsetX,i[a++]+e.$offsetY,i[a++]+e.$offsetX,i[a++]+e.$offsetY);break;case 2:e.lineTo(i[a++]+e.$offsetX,i[a++]+e.$offsetY);break;case 1:e.moveTo(i[a++]+e.$offsetX,i[a++]+e.$offsetY)}}}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){const i=["source-over","lighter","destination-out"],s="source-over";e.Renderer=class{constructor(){this._renderBufferPool=[],this._nestLevel=0}render(e,i,s){this._nestLevel++;let r=i,a=r.context;a.pushBuffer(r),r.transform(s.a,s.b,s.c,s.d,0,0),this.drawDisplayObject(e,r,s.tx,s.ty,!0),a.draw();let n=r.drawCalls;r.onRenderFinish(),a.popBuffer();let h=dou.recyclable(t.Matrix);if(h.inverse(s),r.transform(h.a,h.b,h.c,h.d,0,0),h.recycle(),this._nestLevel--,0===this._nestLevel){this._renderBufferPool.length>6&&(this._renderBufferPool.length=6);let t=this._renderBufferPool.length;for(let e=0;e<t;e++)this._renderBufferPool[e].resize(0,0)}return n}drawDisplayObject(i,s,r,a,n){let h,o=0,l=i.$displayList;if(l&&!n?((i.$cacheDirty||i.$renderDirty||l.canvasScaleX!=e.DisplayList.canvasScaleX||l.canvasScaleY!=e.DisplayList.canvasScaleY)&&(o+=l.drawToSurface()),h=l.renderNode):h=i.$renderDirty?i.$getRenderNode():i.$renderNode,i.$cacheDirty=!1,h){switch(o++,s.offsetX=r,s.offsetY=a,h.type){case 2:this.renderBitmap(h,s);break;case 3:this.renderText(h,s);break;case 4:this.renderGraphics(h,s);break;case 5:this.renderGroup(h,s);break;case 1:this.renderNormalBitmap(h,s)}s.offsetX=0,s.offsetY=0}if(l&&!n)return o;let c=i.$children;if(c){i.sortableChildren&&i.$sortDirty&&i.sortChildren();let e=c.length;for(let i=0;i<e;i++){let e,n,h,l,d,u=c[i];if(1!=u.alpha&&(h=s.globalAlpha,s.globalAlpha*=u.alpha),16777215!==u.tint&&(l=s.globalTintColor,s.globalTintColor=u.$tintRGB),u.$useTranslate){let i=u.$getMatrix();e=r+u.x,n=a+u.y;let h=s.globalMatrix;(d=dou.recyclable(t.Matrix)).a=h.a,d.b=h.b,d.c=h.c,d.d=h.d,d.tx=h.tx,d.ty=h.ty,s.transform(i.a,i.b,i.c,i.d,e,n),e=-u.anchorOffsetX,n=-u.anchorOffsetY}else e=r+u.x-u.anchorOffsetX,n=a+u.y-u.anchorOffsetY;switch(u.$renderMode){case 1:break;case 2:o+=this.drawWithFilter(u,s,e,n);break;case 3:o+=this.drawWithClip(u,s,e,n);break;case 4:o+=this.drawWithScrollRect(u,s,e,n);break;default:o+=this.drawDisplayObject(u,s,e,n)}if(h&&(s.globalAlpha=h),l&&(s.globalTintColor=l),d){let t=s.globalMatrix;t.a=d.a,t.b=d.b,t.c=d.c,t.d=d.d,t.tx=d.tx,t.ty=d.ty,d.recycle()}}}return o}drawWithFilter(e,r,a,n){let h=0;if(e.$children&&0==e.$children.length&&(!e.$renderNode||0==e.$renderNode.renderCount))return h;let o,l=e.filters,c="normal"!==e.blendMode;c&&((o=i[e.blendMode])||(o=s));let d=e.$getOriginalBounds(),u=d.x,g=d.y,p=d.width,f=d.height;if(p<=0||f<=0)return h;if(!e.mask&&1==l.length&&("colorBrush"==l[0].type||"colorTransform"==l[0].type||"custom"===l[0].type&&0===l[0].padding)){let t=this.getRenderCount(e);if(!e.$children||1==t)return c&&r.context.setGlobalCompositeOperation(o),r.context.colorMatrixFilter=l[0],e.$mask?h+=this.drawWithClip(e,r,a,n):e.scrollRect||e.$maskRect?h+=this.drawWithScrollRect(e,r,a,n):h+=this.drawDisplayObject(e,r,a,n),r.context.colorMatrixFilter=null,c&&r.context.setGlobalCompositeOperation(s),h}let _=this.createRenderBuffer(p,f);if(_.context.pushBuffer(_),e.$mask?h+=this.drawWithClip(e,_,-u,-g):e.scrollRect||e.$maskRect?h+=this.drawWithScrollRect(e,_,-u,-g):h+=this.drawDisplayObject(e,_,-u,-g),_.context.popBuffer(),h>0){c&&r.context.setGlobalCompositeOperation(o),h++,r.offsetX=a+u,r.offsetY=n+g;let e=dou.recyclable(t.Matrix),i=r.globalMatrix;e.a=i.a,e.b=i.b,e.c=i.c,e.d=i.d,e.tx=i.tx,e.ty=i.ty,r.useOffset(),r.context.drawTargetWidthFilters(l,_),i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,i.tx=e.tx,i.ty=e.ty,e.recycle(),c&&r.context.setGlobalCompositeOperation(s)}return this._renderBufferPool.push(_),h}getRenderCount(t){let e=0,i=t.$getRenderNode();if(i&&(e+=i.renderCount),t.$children)for(let i of t.$children){let t=i.filters;if(t&&t.length>0)return 2;if(i.$children)e+=this.getRenderCount(i);else{let t=i.$getRenderNode();t&&(e+=t.renderCount)}}return e}drawWithClip(e,r,a,n){let h,o=0,l="normal"!==e.blendMode;l&&((h=i[e.blendMode])||(h=s));let c=e.scrollRect?e.scrollRect:e.$maskRect,d=e.$mask;if(d){let t=d.$getMatrix();if(0==t.a&&0==t.b||0==t.c&&0==t.d)return o}if(d||e.$children&&0!=e.$children.length){let i=e.$getOriginalBounds(),u=i.x,g=i.y,p=i.width,f=i.height;if(p<=0||f<=0)return o;let _=this.createRenderBuffer(p,f);if(_.context.pushBuffer(_),o+=this.drawDisplayObject(e,_,-u,-g),d){let i=this.createRenderBuffer(p,f);i.context.pushBuffer(i);let s=dou.recyclable(t.Matrix);s.copy(d.$getConcatenatedMatrix()),d.$getConcatenatedMatrixAt(e,s),s.translate(-u,-g),i.setTransform(s.a,s.b,s.c,s.d,s.tx,s.ty),s.recycle(),o+=this.drawDisplayObject(d,i,0,0),i.context.popBuffer(),_.context.setGlobalCompositeOperation("destination-in"),_.setTransform(1,0,0,-1,0,i.height);let r=i.renderTarget.width,a=i.renderTarget.height;_.context.drawTexture(i.renderTarget.texture,0,0,r,a,0,0,r,a,r,a),_.setTransform(1,0,0,1,0,0),_.context.setGlobalCompositeOperation("source-over"),i.setTransform(1,0,0,1,0,0),this._renderBufferPool.push(i)}if(_.context.setGlobalCompositeOperation(s),_.context.popBuffer(),o>0){o++,l&&r.context.setGlobalCompositeOperation(h),c&&r.context.pushMask(c.x+a,c.y+n,c.width,c.height);let e=dou.recyclable(t.Matrix),i=r.globalMatrix;e.a=i.a,e.b=i.b,e.c=i.c,e.d=i.d,e.tx=i.tx,e.ty=i.ty,i.append(1,0,0,-1,a+u,n+g+_.height);let d=_.renderTarget.width,p=_.renderTarget.height;r.context.drawTexture(_.renderTarget.texture,0,0,d,p,0,0,d,p,d,p),c&&_.context.popMask(),l&&r.context.setGlobalCompositeOperation(s);let f=r.globalMatrix;f.a=e.a,f.b=e.b,f.c=e.c,f.d=e.d,f.tx=e.tx,f.ty=e.ty,e.recycle()}return this._renderBufferPool.push(_),o}return c&&r.context.pushMask(c.x+a,c.y+n,c.width,c.height),l&&r.context.setGlobalCompositeOperation(h),o+=this.drawDisplayObject(e,r,a,n),l&&r.context.setGlobalCompositeOperation(s),c&&r.context.popMask(),o}drawWithScrollRect(t,e,i,s){let r=0,a=t.scrollRect?t.scrollRect:t.$maskRect;if(a.isEmpty())return r;t.scrollRect&&(i-=a.x,s-=a.y);let n=e.globalMatrix,h=e.context,o=!1;if(e.hasScissor||0!=n.b||0!=n.c)e.context.pushMask(a.x+i,a.y+s,a.width,a.height);else{let t,r,l,c,d=n.a,u=n.d,g=n.tx,p=n.ty,f=a.x+i,_=a.y+s,x=f+a.width,m=_+a.height;if(1==d&&1==u)t=f+g,r=_+p,l=x+g,c=m+p;else{let e=d*f+g,i=u*_+p,s=d*x+g,a=u*_+p,n=d*x+g,h=u*m+p,o=d*f+g,y=u*m+p,$=0;e>s&&($=e,e=s,s=$),n>o&&($=n,n=o,o=$),t=e<n?e:n,l=s>o?s:o,i>a&&($=i,i=a,a=$),h>y&&($=h,h=y,y=$),r=i<h?i:h,c=a>y?a:y}h.enableScissor(t,-c+e.height,l-t,c-r),o=!0}return r+=this.drawDisplayObject(t,e,i,s),o?h.disableScissor():h.popMask(),r}renderNormalBitmap(t,e){let i=t.image;i&&e.context.drawImage(i,t.sourceX,t.sourceY,t.sourceW,t.sourceH,t.drawX,t.drawY,t.drawW,t.drawH,t.imageWidth,t.imageHeight,t.rotated,t.smoothing)}renderBitmap(e,r){let a=e.image;if(!a)return;let n,h,o,l,c=e.drawData,d=c.length,u=0,g=e.matrix,p=e.blendMode,f=e.alpha;if(g){n=dou.recyclable(t.Matrix);let e=r.globalMatrix;n.a=e.a,n.b=e.b,n.c=e.c,n.d=e.d,n.tx=e.tx,n.ty=e.ty,h=r.offsetX,o=r.offsetY,r.useOffset(),r.transform(g.a,g.b,g.c,g.d,g.tx,g.ty)}if(p&&r.context.setGlobalCompositeOperation(i[p]),f==f&&(l=r.globalAlpha,r.globalAlpha*=f),e.filter){for(r.context.colorMatrixFilter=e.filter;u<d;)r.context.drawImage(a,c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],e.imageWidth,e.imageHeight,e.rotated,e.smoothing);r.context.colorMatrixFilter=null}else for(;u<d;)r.context.drawImage(a,c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],e.imageWidth,e.imageHeight,e.rotated,e.smoothing);if(p&&r.context.setGlobalCompositeOperation(s),f==f&&(r.globalAlpha=l),g){let t=r.globalMatrix;t.a=n.a,t.b=n.b,t.c=n.c,t.d=n.d,t.tx=n.tx,t.ty=n.ty,r.offsetX=h,r.offsetY=o,n.recycle()}}renderText(t,i){let s=t.width-t.x,r=t.height-t.y;if(s<=0||r<=0||!s||!r||0==t.drawData.length)return;let a=e.DisplayList.canvasScaleX,n=e.DisplayList.canvasScaleY,h=i.context.maxTextureSize;s*a>h&&(a*=h/(s*a)),r*n>h&&(n*=h/(r*n)),s*=a,r*=n;let o=t.x*a,l=t.y*n;if(t.canvasScaleX==a&&t.canvasScaleY==n||(t.canvasScaleX=a,t.canvasScaleY=n,t.dirtyRender=!0),this._canvasRenderBuffer&&this._canvasRenderBuffer.context?t.dirtyRender&&this._canvasRenderBuffer.resize(s,r):(this._canvasRenderer=new e.CanvasRenderer,this._canvasRenderBuffer=new e.CanvasRenderBuffer(s,r)),!this._canvasRenderBuffer.context)return;if(1==a&&1==n||this._canvasRenderBuffer.context.setTransform(a,0,0,n,0,0),o||l?(t.dirtyRender&&this._canvasRenderBuffer.context.setTransform(a,0,0,n,-o,-l),i.transform(1,0,0,1,o/a,l/n)):1==a&&1==n||this._canvasRenderBuffer.context.setTransform(a,0,0,n,0,0),t.dirtyRender){let e=this._canvasRenderBuffer.surface;this._canvasRenderer.renderText(t,this._canvasRenderBuffer.context);let s=t.texture;s?i.context.updateTexture(s,e):(s=i.context.createTexture(e),t.texture=s),t.textureWidth=e.width,t.textureHeight=e.height}let c=t.textureWidth,d=t.textureHeight;i.context.drawTexture(t.texture,0,0,c,d,0,0,c/a,d/n,c,d),(o||l)&&(t.dirtyRender&&this._canvasRenderBuffer.context.setTransform(a,0,0,n,0,0),i.transform(1,0,0,1,-o/a,-l/n)),t.dirtyRender=!1}renderGraphics(i,s,r){let a=i.width,n=i.height;if(a<=0||n<=0||!a||!n||0==i.drawData.length)return;let h=e.DisplayList.canvasScaleX,o=e.DisplayList.canvasScaleY;(a*h<1||n*o<1)&&(h=o=1),i.canvasScaleX==h&&i.canvasScaleY==o||(i.canvasScaleX=h,i.canvasScaleY=o,i.dirtyRender=!0),a*=h,n*=o;let l=Math.ceil(a),c=Math.ceil(n);if(h*=l/a,o*=c/n,a=l,n=c,this._canvasRenderBuffer&&this._canvasRenderBuffer.context?i.dirtyRender&&this._canvasRenderBuffer.resize(a,n):(this._canvasRenderer=new e.CanvasRenderer,this._canvasRenderBuffer=new e.CanvasRenderBuffer(a,n)),!this._canvasRenderBuffer.context)return;1==h&&1==o||this._canvasRenderBuffer.context.setTransform(h,0,0,o,0,0),(i.x||i.y)&&((i.dirtyRender||r)&&this._canvasRenderBuffer.context.translate(-i.x,-i.y),s.transform(1,0,0,1,i.x,i.y));let d=this._canvasRenderBuffer.surface;if(r){let e;this._canvasRenderer.renderGraphics(i,this._canvasRenderBuffer.context),t.WebGLUtil.deleteTexture(d),e=s.context.getTexture(d),s.context.drawTexture(e,0,0,a,n,0,0,a,n,d.width,d.height)}else{if(i.dirtyRender){this._canvasRenderer.renderGraphics(i,this._canvasRenderBuffer.context);let t=i.texture;t?s.context.updateTexture(t,d):(t=s.context.createTexture(d),i.texture=t),i.textureWidth=d.width,i.textureHeight=d.height}let t=i.textureWidth,e=i.textureHeight;s.context.drawTexture(i.texture,0,0,t,e,0,0,t/h,e/o,t,e)}(i.x||i.y)&&((i.dirtyRender||r)&&this._canvasRenderBuffer.context.translate(i.x,i.y),s.transform(1,0,0,1,-i.x,-i.y)),r||(i.dirtyRender=!1)}renderGroup(e,i){let s,r,a,n=e.matrix;if(n){s=dou.recyclable(t.Matrix);let e=i.globalMatrix;s.a=e.a,s.b=e.b,s.c=e.c,s.d=e.d,s.tx=e.tx,s.ty=e.ty,r=i.offsetX,a=i.offsetY,i.useOffset(),i.transform(n.a,n.b,n.c,n.d,n.tx,n.ty)}let h=e.drawData,o=h.length;for(let t=0;t<o;t++){let e=h[t];this.renderNode(e,i,i.offsetX,i.offsetY)}if(n){let t=i.globalMatrix;t.a=s.a,t.b=s.b,t.c=s.c,t.d=s.d,t.tx=s.tx,t.ty=s.ty,i.offsetX=r,i.offsetY=a,s.recycle()}}renderNode(t,e,i,s,r){switch(e.offsetX=i,e.offsetY=s,t.type){case 2:this.renderBitmap(t,e);break;case 3:this.renderText(t,e);break;case 4:this.renderGraphics(t,e,r);break;case 5:this.renderGroup(t,e);break;case 1:this.renderNormalBitmap(t,e)}}createRenderBuffer(t,i){let s=this._renderBufferPool.pop();return s?s.resize(t,i):(s=new e.RenderBuffer(t,i)).computeDrawCall=!1,s}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){t.DefaultScreenAdapter=class{calculateStageSize(t,e,i,s,r){let a=e,n=i,h=s,o=r,l=e/h||0,c=i/o||0;switch(t){case"exactFit":break;case"fixedHeight":h=Math.round(e/c);break;case"fixedWidth":o=Math.round(i/l);break;case"noBorder":l>c?n=Math.round(o*l):a=Math.round(h*c);break;case"showAll":l>c?a=Math.round(h*c):n=Math.round(o*l);break;case"fixedNarrow":l>c?h=Math.round(e/c):o=Math.round(i/l);break;case"fixedWide":l>c?o=Math.round(i/l):h=Math.round(e/c);break;default:h=e,o=i}return h%2!=0&&(h+=1),o%2!=0&&(o+=1),a%2!=0&&(a+=1),n%2!=0&&(n+=1),{stageWidth:h,stageHeight:o,displayWidth:a,displayHeight:n}}}}(dou2d||(dou2d={})),function(t){!function(t){let e;!function(t){t.default_vs="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center=vec2(-1.0,1.0);\nvoid main(){\ngl_Position=vec4((aVertexPosition/projectionVector)+center,0.0,1.0);\nvTextureCoord=aTextureCoord;\nvColor=vec4(aColor.x,aColor.x,aColor.x,aColor.x);\n}",t.blur_fs="precision mediump float;\nuniform vec2 blur;\nuniform sampler2D uSampler;\nuniform vec2 uTextureSize;\nvarying vec2 vTextureCoord;\nvoid main(){\nconst int sampleRadius=5;\nconst int samples=sampleRadius*2+1;\nvec2 blurUv=blur/uTextureSize;\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nvec2 uv=vec2(0.0,0.0);\nblurUv/=float(sampleRadius);\nfor(int i=-sampleRadius;i<=sampleRadius;i++){\nuv.x=vTextureCoord.x+float(i)*blurUv.x;\nuv.y=vTextureCoord.y+float(i)*blurUv.y;\ncolor+=texture2D(uSampler,uv);\n}\ncolor/=float(samples);\ngl_FragColor=color;\n}",t.colorBrush_fs="precision lowp float;\nuniform float r;\nuniform float g;\nuniform float b;\nuniform float a;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nvoid main(){\nvec4 color=texture2D(uSampler,vTextureCoord);\nif(color.a>0.0){\ncolor=vec4(color.rgb/color.a,color.a);\n}\ncolor.r=r;\ncolor.g=g;\ncolor.b=b;\ncolor.a*=a;\ngl_FragColor=vec4(color.rgb*color.a,color.a);\n}",t.colorTransform_fs="precision mediump float;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(){\nvec4 texColor=texture2D(uSampler,vTextureCoord);\nif(texColor.a>0.0){\ntexColor=vec4(texColor.rgb/texColor.a,texColor.a);\n}\nvec4 locColor=clamp(texColor*matrix+colorAdd,0.0,1.0);\ngl_FragColor=vColor*vec4(locColor.rgb*locColor.a,locColor.a);\n}",t.glow_fs="precision highp float;\nuniform float dist;\nuniform float angle;\nuniform vec4 color;\nuniform float alpha;\nuniform float blurX;\nuniform float blurY;\nuniform float strength;\nuniform float inner;\nuniform float knockout;\nuniform float hideObject;\nuniform sampler2D uSampler;\nuniform vec2 uTextureSize;\nvarying vec2 vTextureCoord;\nfloat random(vec2 scale){\nreturn fract(sin(dot(gl_FragCoord.xy,scale))*43758.5453);\n}\nvoid main(){\nvec2 px=vec2(1.0/uTextureSize.x,1.0/uTextureSize.y);\nconst float linearSamplingTimes=7.0;\nconst float circleSamplingTimes=12.0;\nvec4 ownColor=texture2D(uSampler,vTextureCoord);\nvec4 curColor;\nfloat totalAlpha=0.0;\nfloat maxTotalAlpha=0.0;\nfloat curDistanceX=0.0;\nfloat curDistanceY=0.0;\nfloat offsetX=dist*cos(angle)*px.x;\nfloat offsetY=dist*sin(angle)*px.y;\nconst float PI=3.14159265358979323846264;\nfloat cosAngle;\nfloat sinAngle;\nfloat offset=PI*2.0/circleSamplingTimes*random(vec2(12.9898,78.233));\nfloat stepX=blurX*px.x/linearSamplingTimes;\nfloat stepY=blurY*px.y/linearSamplingTimes;\nfor(float a=0.0;a<=PI*2.0;a+=PI*2.0/circleSamplingTimes){\ncosAngle=cos(a+offset);\nsinAngle=sin(a+offset);\nfor(float i=1.0;i<=linearSamplingTimes;i++){\ncurDistanceX=i*stepX*cosAngle;\ncurDistanceY=i*stepY*sinAngle;\nif(vTextureCoord.x+curDistanceX-offsetX>=0.0 && vTextureCoord.y+curDistanceY+offsetY<=1.0){\ncurColor=texture2D(uSampler,vec2(vTextureCoord.x+curDistanceX-offsetX,vTextureCoord.y+curDistanceY+offsetY));\ntotalAlpha+=(linearSamplingTimes-i)*curColor.a;\n}\nmaxTotalAlpha+=(linearSamplingTimes-i);\n}\n}\nownColor.a=max(ownColor.a,0.0001);\nownColor.rgb=ownColor.rgb/ownColor.a;\nfloat outerGlowAlpha=(totalAlpha/maxTotalAlpha)*strength*alpha*(1.0-inner)*max(min(hideObject,knockout),1.0-ownColor.a);\nfloat innerGlowAlpha=((maxTotalAlpha-totalAlpha)/maxTotalAlpha)*strength*alpha*inner*ownColor.a;\nownColor.a=max(ownColor.a*knockout*(1.0-hideObject),0.0001);\nvec3 mix1=mix(ownColor.rgb,color.rgb,innerGlowAlpha/(innerGlowAlpha+ownColor.a));\nvec3 mix2=mix(mix1,color.rgb,outerGlowAlpha/(innerGlowAlpha+ownColor.a+outerGlowAlpha));\nfloat resultAlpha=min(ownColor.a+outerGlowAlpha+innerGlowAlpha,1.0);\ngl_FragColor=vec4(mix2*resultAlpha,resultAlpha);\n}",t.primitive_fs="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(){\ngl_FragColor=vColor;\n}",t.texture_fs="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(){\ngl_FragColor=texture2D(uSampler,vTextureCoord)*vColor;\n}"}(e=t.ShaderLib||(t.ShaderLib={}))}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(t){class e{constructor(t,e,i){let s=this.createShader(t,t.VERTEX_SHADER,e),r=this.createShader(t,t.FRAGMENT_SHADER,i);this.program=this.createProgram(t,s,r),this.attributes=this.extractAttributes(t,this.program),this.uniforms=this.extractUniforms(t,this.program)}static getProgram(t,i,s,r){return this.programCache[t]||(this.programCache[t]=new e(i,s,r)),this.programCache[t]}static deleteProgram(t){delete this.programCache[t]}createShader(t,e,i){let s=t.createShader(e);t.shaderSource(s,i),t.compileShader(s);t.getShaderParameter(s,t.COMPILE_STATUS);return s}createProgram(t,e,i){let s=t.createProgram();return t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),s}extractAttributes(e,i){let s={},r=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES);for(let a=0;a<r;a++){let r=e.getActiveAttrib(i,a),n=r.name,h=new t.Attribute(e,i,r);s[n]=h}return s}extractUniforms(e,i){let s={},r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let a=0;a<r;a++){let r=e.getActiveUniform(i,a),n=r.name,h=new t.Uniform(e,i,r);s[n]=h}return s}}e.programCache={},t.Program=e}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(t){t.Attribute=class{constructor(t,e,i){this.name=i.name,this.type=i.type,this.size=i.size,this.location=t.getAttribLocation(e,this.name),this.count=0,this.format=t.FLOAT,this.initCount(t),this.initFormat(t)}initCount(t){switch(this.type){case t.FLOAT:case t.BYTE:case t.UNSIGNED_BYTE:case t.UNSIGNED_SHORT:this.count=1;break;case t.FLOAT_VEC2:this.count=2;break;case t.FLOAT_VEC3:this.count=3;break;case t.FLOAT_VEC4:this.count=4}}initFormat(t){switch(this.type){case t.FLOAT:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:this.format=t.FLOAT;break;case t.UNSIGNED_BYTE:this.format=t.UNSIGNED_BYTE;break;case t.UNSIGNED_SHORT:this.format=t.UNSIGNED_SHORT;break;case t.BYTE:this.format=t.BYTE}}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(t){t.Uniform=class{constructor(t,e,i){this.name=i.name,this.type=i.type,this.size=i.size,this.location=t.getUniformLocation(e,this.name),this.setDefaultValue(t),this.generateSetValue(t),this.generateUpload(t)}setDefaultValue(t){switch(this.type){case t.FLOAT:case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.value=0;break;case t.FLOAT_VEC2:case t.BOOL_VEC2:case t.INT_VEC2:this.value=[0,0];break;case t.FLOAT_VEC3:case t.BOOL_VEC3:case t.INT_VEC3:this.value=[0,0,0];break;case t.FLOAT_VEC4:case t.BOOL_VEC4:case t.INT_VEC4:this.value=[0,0,0,0];break;case t.FLOAT_MAT2:this.value=new Float32Array([1,0,0,1]);break;case t.FLOAT_MAT3:this.value=new Float32Array([1,0,0,0,1,0,0,0,1]);break;case t.FLOAT_MAT4:this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}generateSetValue(t){switch(this.type){case t.FLOAT:case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.setValue=t=>{let e=this.value!==t;this.value=t,e&&this.upload()};break;case t.FLOAT_VEC2:case t.BOOL_VEC2:case t.INT_VEC2:this.setValue=t=>{let e=this.value[0]!==t.x||this.value[1]!==t.y;this.value[0]=t.x,this.value[1]=t.y,e&&this.upload()};break;case t.FLOAT_VEC3:case t.BOOL_VEC3:case t.INT_VEC3:this.setValue=t=>{this.value[0]=t.x,this.value[1]=t.y,this.value[2]=t.z,this.upload()};break;case t.FLOAT_VEC4:case t.BOOL_VEC4:case t.INT_VEC4:this.setValue=t=>{this.value[0]=t.x,this.value[1]=t.y,this.value[2]=t.z,this.value[3]=t.w,this.upload()};break;case t.FLOAT_MAT2:case t.FLOAT_MAT3:case t.FLOAT_MAT4:this.setValue=t=>{this.value.set(t),this.upload()}}}generateUpload(t){switch(this.type){case t.FLOAT:this.upload=()=>{let e=this.value;t.uniform1f(this.location,e)};break;case t.FLOAT_VEC2:this.upload=()=>{let e=this.value;t.uniform2f(this.location,e[0],e[1])};break;case t.FLOAT_VEC3:this.upload=()=>{let e=this.value;t.uniform3f(this.location,e[0],e[1],e[2])};break;case t.FLOAT_VEC4:this.upload=()=>{let e=this.value;t.uniform4f(this.location,e[0],e[1],e[2],e[3])};break;case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.upload=()=>{let e=this.value;t.uniform1i(this.location,e)};break;case t.BOOL_VEC2:case t.INT_VEC2:this.upload=()=>{let e=this.value;t.uniform2i(this.location,e[0],e[1])};break;case t.BOOL_VEC3:case t.INT_VEC3:this.upload=()=>{let e=this.value;t.uniform3i(this.location,e[0],e[1],e[2])};break;case t.BOOL_VEC4:case t.INT_VEC4:this.upload=()=>{let e=this.value;t.uniform4i(this.location,e[0],e[1],e[2],e[3])};break;case t.FLOAT_MAT2:this.upload=()=>{let e=this.value;t.uniformMatrix2fv(this.location,!1,e)};break;case t.FLOAT_MAT3:this.upload=()=>{let e=this.value;t.uniformMatrix3fv(this.location,!1,e)};break;case t.FLOAT_MAT4:this.upload=()=>{let e=this.value;t.uniformMatrix4fv(this.location,!1,e)}}}}}(t.rendering||(t.rendering={}))}(dou2d||(dou2d={})),function(t){!function(e){class i extends dou.EventDispatcher{constructor(){super(...arguments),this._gscaleX=0,this._gscaleY=0,this._textValue="",this._colorValue=16777215,this._styleInfoes={}}setTextField(t){return this.textfield=t,!0}addToStage(){this._htmlInput=t.sys.inputManager}show(){this._htmlInput.isCurrentStageText(this)?this._inputElement.onblur=null:(this._inputElement=this._htmlInput.getInputElement(this),this.textfield.multiline?this._inputElement instanceof HTMLInputElement&&(this._inputElement.type="text"):this._inputElement.type=this.textfield.inputType,this._inputDiv=this._htmlInput.inputDIV),this._htmlInput.needShow=!0,this._isNeedShow=!0,this.initElement()}initElement(){let e=this.textfield.localToGlobal(0,0),i=e.x,s=e.y,r=this._htmlInput.scaleX,a=this._htmlInput.scaleY;this._inputDiv.style.left=i*r+"px",this._inputDiv.style.top=s*a+"px",this.textfield.multiline&&this.textfield.height>this.textfield.size?(this._inputDiv.style.top=s*a+"px",this._inputElement.style.top=-this.textfield.lineSpacing/2*a+"px"):(this._inputDiv.style.top=s*a+"px",this._inputElement.style.top="0px");let n=this.textfield,h=1,o=1,l=0;for(;n.parent;)h*=n.scaleX,o*=n.scaleY,l+=n.rotation,n=n.parent;let c=t.HtmlUtil.getStyleName("transform");this._inputDiv.style[c]="rotate("+l+"deg)",this._gscaleX=r*h,this._gscaleY=a*o}setText(t){return this._textValue=t,this.resetText(),!0}getText(){return this._textValue||(this._textValue=""),this._textValue}resetText(){this._inputElement&&(this._inputElement.value=this._textValue)}setColor(t){return this._colorValue=t,this.resetColor(),!0}resetColor(){this._inputElement&&this.setElementStyle("color",t.HtmlUtil.toColorString(this._colorValue))}onBlur(){}onInput(){let e=this;window.setTimeout((function(){e._inputElement&&e._inputElement.selectionStart==e._inputElement.selectionEnd&&(e._textValue=e._inputElement.value,e.dispatchEvent2D(t.Event2D.UPDATE_TEXT))}),0)}onClickHandler(e){this._isNeedShow&&(e.stopImmediatePropagation(),this._isNeedShow=!1,this.executeShow(),this.dispatchEvent2D(t.Event2D.FOCUS_IN))}executeShow(){this._inputElement.value=this.getText(),null==this._inputElement.onblur&&(this._inputElement.onblur=this.onBlurHandler.bind(this)),null==this._inputElement.onfocus&&(this._inputElement.onfocus=this.onFocusHandler.bind(this)),this.resetStageText(),this.textfield.maxChars>0?this._inputElement.setAttribute("maxlength",this.textfield.maxChars):this._inputElement.removeAttribute("maxlength"),this._inputElement.selectionStart=this._inputElement.value.length,this._inputElement.selectionEnd=this._inputElement.value.length,this._inputElement.focus()}onBlurHandler(){this._htmlInput.clearInputElement(),window.scrollTo(0,0)}onFocusHandler(){let t=this;window.setTimeout((function(){t._inputElement&&t._inputElement.scrollIntoView()}),200)}resetStageText(){if(this._inputElement){let e,i=this.textfield;if(this.setElementStyle("fontFamily",i.fontFamily),this.setElementStyle("fontStyle",i.italic?"italic":"normal"),this.setElementStyle("fontWeight",i.bold?"bold":"normal"),this.setElementStyle("textAlign",i.textAlign),this.setElementStyle("fontSize",i.size*this._gscaleY+"px"),this.setElementStyle("color",t.HtmlUtil.toColorString(i.textColor)),i.stage?(e=i.localToGlobal(0,0).x,e=Math.min(i.width,i.stage.stageWidth-e)):e=i.width,this.setElementStyle("width",e*this._gscaleX+"px"),this.setElementStyle("verticalAlign",i.verticalAlign),i.multiline)this.setAreaHeight();else if(this.setElementStyle("lineHeight",i.size*this._gscaleY+"px"),i.height<i.size){this.setElementStyle("height",i.size*this._gscaleY+"px");let t=i.size/2*this._gscaleY;this.setElementStyle("padding","0px 0px "+t+"px 0px")}else{this.setElementStyle("height",i.size*this._gscaleY+"px");let e=(i.height-i.size)*this._gscaleY,s=e*t.TextFieldUtil.getValign(i),r=e-s;r<i.size/2*this._gscaleY&&(r=i.size/2*this._gscaleY),this.setElementStyle("padding",s+"px 0px "+r+"px 0px")}this._inputDiv.style.clip="rect(0px "+i.width*this._gscaleX+"px "+i.height*this._gscaleY+"px 0px)",this._inputDiv.style.height=i.height*this._gscaleY+"px",this._inputDiv.style.width=e*this._gscaleX+"px"}}setAreaHeight(){let e=this.textfield;if(e.multiline){let i=t.TextFieldUtil.getTextHeight(e);if(e.height<=e.size)this.setElementStyle("height",e.size*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",e.size*this._gscaleY+"px");else if(e.height<i)this.setElementStyle("height",e.height*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",(e.size+e.lineSpacing)*this._gscaleY+"px");else{this.setElementStyle("height",(i+e.lineSpacing)*this._gscaleY+"px");let s=(e.height-i)*this._gscaleY,r=s*t.TextFieldUtil.getValign(e),a=s-r;this.setElementStyle("padding",r+"px 0px "+a+"px 0px"),this.setElementStyle("lineHeight",(e.size+e.lineSpacing)*this._gscaleY+"px")}}}setElementStyle(t,e){this._inputElement&&this._styleInfoes[t]!=e&&(this._inputElement.style[t]=e)}hide(){this._htmlInput&&this._htmlInput.disconnectStageText(this)}removeFromStage(){this._inputElement&&this._htmlInput.disconnectStageText(this)}onDisconnect(){this._inputElement=null,this.dispatchEvent2D(t.Event2D.FOCUS_OUT)}}e.HtmlText=i}(t.input||(t.input={}))}(dou2d||(dou2d={})),function(t){!function(e){e.InputController=class{init(t){this._text=t,this._stageText=new e.HtmlText,this._stageText.setTextField(this._text)}setText(t){this._stageText.setText(t)}getText(){return this._stageText.getText()}setColor(t){this._stageText.setColor(t)}addStageText(){this._stageTextAdded||(this._text.$inputEnabled||(this._text.touchEnabled=!0),this._tempStage=this._text.stage,this._stageText.addToStage(),this._stageText.on(t.Event2D.UPDATE_TEXT,this.updateTextHandler,this),this._text.on(t.TouchEvent.TOUCH_BEGIN,this.onMouseDownHandler,this),this._stageText.on(t.Event2D.FOCUS_OUT,this.blurHandler,this),this._stageText.on(t.Event2D.FOCUS_IN,this.focusHandler,this),this._stageTextAdded=!0)}focusHandler(e){this._isFocus||(this._isFocus=!0,e.showing||this._text.$setIsTyping(!0),this._text.dispatchEvent2D(t.Event2D.FOCUS_IN,null,!0))}blurHandler(e){this._isFocus&&(this._isFocus=!1,this._tempStage.off(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this._text.$setIsTyping(!1),this._stageText.onBlur(),this._text.dispatchEvent2D(t.Event2D.FOCUS_OUT,null,!0))}onMouseDownHandler(t){this.onFocus()}onFocus(){this._text.$getVisible()&&(this._isFocus||(this._tempStage.off(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),t.callLater(()=>{this._tempStage.on(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this)},this),this._stageText.show()))}onStageDownHandler(t){t.target!=this._text&&this._stageText.hide()}updateTextHandler(e){let i,s,r=this._text.$propertyMap,a=this._stageText.getText(),n=!1;null!=r[35]&&(i=new RegExp("["+r[35]+"]","g"),s=a.match(i),a=s?s.join(""):"",n=!0),null!=r[36]&&(i=new RegExp("[^"+r[36]+"]","g"),s=a.match(i),a=s?s.join(""):"",n=!0),n&&this._stageText.getText()!=a&&this._stageText.setText(a),this.resetText(),this._text.dispatchEvent2D(t.Event2D.CHANGE,null,!0)}resetText(){this._text.$setBaseText(this._stageText.getText())}updateProperties(){if(this._isFocus)return this._stageText.resetStageText(),void this.updateInput();this._stageText.setText(this._text.$propertyMap[13]),this._stageText.resetStageText(),this.updateInput()}updateInput(){!this._text.$getVisible()&&this._stageText&&this.hideInput()}hideInput(){this._stageText.removeFromStage()}removeStageText(){this._stageTextAdded&&(this._text.$inputEnabled||(this._text.touchEnabled=!1),this._stageText.removeFromStage(),this._stageText.off(t.Event2D.UPDATE_TEXT,this.updateTextHandler,this),this._text.off(t.TouchEvent.TOUCH_BEGIN,this.onMouseDownHandler,this),this._tempStage.off(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this._stageText.off(t.Event2D.FOCUS_OUT,this.blurHandler,this),this._stageText.off(t.Event2D.FOCUS_IN,this.focusHandler,this),this._stageTextAdded=!1)}}}(t.input||(t.input={}))}(dou2d||(dou2d={})),function(t){!function(e){e.InputManager=class{constructor(){this.needShow=!1,this.scaleX=1,this.scaleY=1}isInputOn(){return null!=this._stageText}isCurrentStageText(t){return this._stageText==t}initValue(t){t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.border="none",t.style.padding="0"}initStageDelegateDiv(e,i){this._canvas=i;let s,r=this;s||(s=document.createElement("div"),this._stageDelegateDiv=s,s.id="StageDelegateDiv",e.appendChild(s),r.initValue(s),r.inputDIV=document.createElement("div"),r.initValue(r.inputDIV),r.inputDIV.style.width="0px",r.inputDIV.style.height="0px",r.inputDIV.style.left="0px",r.inputDIV.style.top="-100px",r.inputDIV.style[t.HtmlUtil.getStyleName("transformOrigin")]="0% 0% 0px",s.appendChild(r.inputDIV),this._canvas.addEventListener("click",(function(t){r.needShow?(r.needShow=!1,r._stageText.onClickHandler(t),r.show()):r._inputElement&&(r.clearInputElement(),r._inputElement.blur(),r._inputElement=null)})),r.initInputElement(!0),r.initInputElement(!1))}initInputElement(t){let e,i=this;t?((e=document.createElement("textarea")).style.resize="none",i._multiElement=e,e.id="douTextarea"):(e=document.createElement("input"),i._simpleElement=e,e.id="douInput"),e instanceof HTMLInputElement&&(e.type="text"),i.inputDIV.appendChild(e),e.setAttribute("tabindex","-1"),e.style.width="1px",e.style.height="12px",i.initValue(e),e.style.outline="thin",e.style.background="none",e.style.overflow="hidden",e.style.wordBreak="break-all",e.style.opacity=0,e.oninput=function(){i._stageText&&i._stageText.onInput()}}updateSize(){if(!this._canvas)return;this.scaleX=t.rendering.DisplayList.canvasScaleX,this.scaleY=t.rendering.DisplayList.canvasScaleY,this._stageDelegateDiv.style.left=this._canvas.style.left,this._stageDelegateDiv.style.top=this._canvas.style.top;let e=t.HtmlUtil.getStyleName("transform");this._stageDelegateDiv.style[e]=this._canvas.style[e],this._stageDelegateDiv.style[t.HtmlUtil.getStyleName("transformOrigin")]="0% 0% 0px"}show(){let e=this._inputElement;t.callLater((function(){e.style.opacity=1}),this)}getInputElement(t){let e,i=this;return i.clearInputElement(),i._stageText=t,this._canvas.userTyping=!0,i._stageText.textfield.multiline?i._inputElement=i._multiElement:i._inputElement=i._simpleElement,(e=i._simpleElement==i._inputElement?i._multiElement:i._simpleElement).style.display="none",i._inputElement}disconnectStageText(t){null!=this._stageText&&this._stageText!=t||(this._inputElement&&this._inputElement.blur(),this.clearInputElement()),this.needShow=!1}clearInputElement(){let t=this;if(t._inputElement){let e;t._inputElement.value="",t._inputElement.onblur=null,t._inputElement.onfocus=null,t._inputElement.style.width="1px",t._inputElement.style.height="12px",t._inputElement.style.left="0px",t._inputElement.style.top="0px",t._inputElement.style.opacity=0,(e=t._simpleElement==t._inputElement?t._multiElement:t._simpleElement).style.display="block",t.inputDIV.style.left="0px",t.inputDIV.style.top="-100px",t.inputDIV.style.height="0px",t.inputDIV.style.width="0px"}t._stageText&&(t._stageText.onDisconnect(),t._stageText=null,this._canvas.userTyping=!1)}}}(t.input||(t.input={}))}(dou2d||(dou2d={})),function(t){const e=new RegExp("(?=[\\u00BF-\\u1FFF\\u2C00-\\uD7FF]|\\b|\\s)(?![。，！、》…）)}”】\\.\\,\\!\\?\\]\\:])");class i extends t.DisplayObject{constructor(){super(),this.$inputEnabled=!1,this._linkPreventTap=!1,this._isFlow=!1,this._isTyping=!1;let e=new t.rendering.TextNode;e.fontFamily=i.default_fontFamily,this._textNode=e,this.$renderNode=e,this.$propertyMap={0:i.default_size,1:0,2:i.default_textColor,3:NaN,4:NaN,5:0,6:0,7:0,8:i.default_fontFamily,9:"left",10:"top",11:"#ffffff",12:"",13:"",14:[],15:!1,16:!1,17:!0,18:!1,19:!1,20:!1,21:0,22:0,23:0,24:0,25:0,26:"#000000",27:0,28:-1,29:0,30:!1,31:!1,32:0,33:!1,34:16777215,35:null,36:null,37:0},this._textArr=[],this._linesArr=[]}set fontFamily(t){this.$setFontFamily(t)}get fontFamily(){return this.$getFontFamily()}$setFontFamily(t){let e=this.$propertyMap;return e[8]!=t&&(e[8]=t,this.invalidateFontString(),!0)}$getFontFamily(){return this.$propertyMap[8]}set size(t){this.$setSize(t)}get size(){return this.$getSize()}$setSize(t){let e=this.$propertyMap;return e[0]!=t&&(e[0]=t,this.invalidateFontString(),!0)}$getSize(){return this.$propertyMap[0]}set bold(t){this.$setBold(t)}get bold(){return this.$getBold()}$setBold(t){let e=this.$propertyMap;return t!=e[15]&&(e[15]=t,this.invalidateFontString(),!0)}$getBold(){return this.$propertyMap[15]}set italic(t){this.$setItalic(t)}get italic(){return this.$getItalic()}$setItalic(t){let e=this.$propertyMap;return t!=e[16]&&(e[16]=t,this.invalidateFontString(),!0)}$getItalic(){return this.$propertyMap[16]}set textAlign(t){this.$setTextAlign(t)}get textAlign(){return this.$getTextAlign()}$setTextAlign(t){let e=this.$propertyMap;return e[9]!=t&&(e[9]=t,this.$invalidateTextField(),!0)}$getTextAlign(){return this.$propertyMap[9]}set verticalAlign(t){this.$setVerticalAlign(t)}get verticalAlign(){return this.$getVerticalAlign()}$setVerticalAlign(t){let e=this.$propertyMap;return e[10]!=t&&(e[10]=t,this.$invalidateTextField(),!0)}$getVerticalAlign(){return this.$propertyMap[10]}set lineSpacing(t){this.$setLineSpacing(t)}get lineSpacing(){return this.$getLineSpacing()}$setLineSpacing(t){let e=this.$propertyMap;return e[1]!=t&&(e[1]=t,this.$invalidateTextField(),!0)}$getLineSpacing(){return this.$propertyMap[1]}set textColor(t){this.$setTextColor(t)}get textColor(){return this.$getTextColor()}$setTextColor(t){let e=this.$propertyMap;return e[2]!=t&&(e[2]=t,this._inputController&&this._inputController.setColor(this.$propertyMap[2]),this.$invalidateTextField(),!0)}$getTextColor(){return this.$propertyMap[2]}set wordWrap(t){this.$setWordWrap(t)}get wordWrap(){return this.$getWordWrap()}$setWordWrap(t){let e=this.$propertyMap;t!=e[19]&&(e[20]||(e[19]=t,this.$invalidateTextField()))}$getWordWrap(){return this.$propertyMap[19]}set type(t){this.$setType(t)}get type(){return this.$getType()}$setType(e){let i=this.$propertyMap;return i[24]!=e&&(i[24]=e,1==e?(isNaN(i[3])&&this.$setWidth(100),isNaN(i[4])&&this.$setHeight(30),this.$setTouchEnabled(!0),null==this._inputController&&(this._inputController=new t.input.InputController),this._inputController.init(this),this.$invalidateTextField(),this._stage&&this._inputController.addStageText()):(this._inputController&&(this._inputController.removeStageText(),this._inputController=null),this.$setTouchEnabled(!1)),!0)}$getType(){return this.$propertyMap[24]}set inputType(t){this.$setInputType(t)}get inputType(){return this.$getInputType()}$setInputType(t){return this.$propertyMap[37]!=t&&(this.$propertyMap[37]=t,!0)}$getInputType(){return this.$propertyMap[37]}set text(t){this.$setText(t)}get text(){return this.$getText()}$setText(t){let e=this.$setBaseText(t);return this._inputController&&this._inputController.setText(this.$propertyMap[13]),e}$setBaseText(t){this._isFlow=!1;let e=this.$propertyMap;if(e[13]!=t){this.$invalidateTextField(),e[13]=t;let i="";return i=e[20]?this.changeToPassText(t):t,this.setMiddleStyle([{text:i}]),!0}return!1}$getText(){return 1==this.$propertyMap[24]?this._inputController.getText():this.$propertyMap[13]}set displayAsPassword(t){this.$setDisplayAsPassword(t)}get displayAsPassword(){return this.$getDisplayAsPassword()}$setDisplayAsPassword(t){let e=this.$propertyMap;if(e[20]!=t){e[20]=t,this.$invalidateTextField();let i="";return i=t?this.changeToPassText(e[13]):e[13],this.setMiddleStyle([{text:i}]),!0}return!1}$getDisplayAsPassword(){return this.$propertyMap[20]}set strokeColor(t){this.$setStrokeColor(t)}get strokeColor(){return this.$getStrokeColor()}$setStrokeColor(e){let i=this.$propertyMap;return i[25]!=e&&(this.$invalidateTextField(),i[25]=e,i[26]=t.HtmlUtil.toColorString(e),!0)}$getStrokeColor(){return this.$propertyMap[25]}set stroke(t){this.$setStroke(t)}get stroke(){return this.$getStroke()}$setStroke(t){return this.$propertyMap[27]!=t&&(this.$invalidateTextField(),this.$propertyMap[27]=t,!0)}$getStroke(){return this.$propertyMap[27]}set maxChars(t){this.$setMaxChars(t)}get maxChars(){return this.$getMaxChars()}$setMaxChars(t){return this.$propertyMap[21]!=t&&(this.$propertyMap[21]=t,!0)}$getMaxChars(){return this.$propertyMap[21]}set scrollV(t){this.$setScrollV(t)}get scrollV(){return this.$getScrollV()}$setScrollV(t){return(t=Math.max(t,1))!=this.$propertyMap[28]&&(this.$propertyMap[28]=t,this.$invalidateTextField(),!0)}$getScrollV(){return Math.min(Math.max(this.$propertyMap[28],1),this.maxScrollV)}get maxScrollV(){return this.$getMaxScrollV()}$getMaxScrollV(){return this.$getLinesArr(),Math.max(this.$propertyMap[29]-t.TextFieldUtil.getScrollNum(this)+1,1)}get numLines(){return this.$getLinesArr(),this.$propertyMap[29]}set multiline(t){this.$setMultiline(t)}get multiline(){return this.$getMultiline()}$setMultiline(t){return this.$propertyMap[30]!=t&&(this.$propertyMap[30]=t,this.$invalidateTextField(),!0)}$getMultiline(){return this.$propertyMap[30]}set restrict(t){this.$setRestrict(t)}get restrict(){return this.$getRestrict()}$setRestrict(t){let e=this.$propertyMap;if(null==t)return e[35]=null,e[36]=null,!1;let i=-1;for(;i<t.length&&0!=(i=t.indexOf("^",i))&&i>0&&"\\"==t.charAt(i-1);)i++;return 0==i?(e[35]=null,e[36]=t.substring(i+1)):i>0?(e[35]=t.substring(0,i),e[36]=t.substring(i+1)):(e[35]=t,e[36]=null),!0}$getRestrict(){let t,e=this.$propertyMap;return null!=e[35]&&(t=e[35]),null!=e[36]&&(null==t&&(t=""),t+="^"+e[36]),t}set border(t){this.$setBorder(t)}get border(){return this.$getBorder()}$setBorder(t){return this.$propertyMap[31]!=t&&(this.$propertyMap[31]=t,this.$invalidateTextField(),!0)}$getBorder(){return this.$propertyMap[31]}set borderColor(t){this.$setBorderColor(t)}get borderColor(){return this.$getBorderColor()}$setBorderColor(t){return this.$propertyMap[32]!=t&&(this.$propertyMap[32]=t,this.$invalidateTextField(),!0)}$getBorderColor(){return this.$propertyMap[32]}set background(t){this.$setBackground(t)}get background(){return this.$getBackground()}$setBackground(t){return this.$propertyMap[33]!=t&&(this.$propertyMap[33]=t,this.$invalidateTextField(),!0)}$getBackground(){return this.$propertyMap[33]}set backgroundColor(t){this.$setBackgroundColor(t)}get backgroundColor(){return this.$getBackgroundColor()}$setBackgroundColor(t){return this.$propertyMap[34]!=t&&(this.$propertyMap[34]=t,this.$invalidateTextField(),!0)}$getBackgroundColor(){return this.$propertyMap[34]}set textFlow(t){this.$setTextFlow(t)}get textFlow(){return this.$getTextFlow()}$setTextFlow(t){this._isFlow=!0;let e="";null==t&&(t=[]);for(let i=0;i<t.length;i++){e+=t[i].text}return this.$propertyMap[20]?this.$setBaseText(e):(this.$propertyMap[13]=e,this.setMiddleStyle(t)),!0}$getTextFlow(){return this._textArr}get textWidth(){return this.$getLinesArr(),this.$propertyMap[5]}get textHeight(){return this.$getLinesArr(),t.TextFieldUtil.getTextHeight(this)}set linkPreventTap(t){this.$setLinkPreventTap(t)}get linkPreventTap(){return this.$getLinkPreventTap()}$setLinkPreventTap(t){this._linkPreventTap=t}$getLinkPreventTap(){return this._linkPreventTap}$setWidth(t){let e=this.$propertyMap;if(isNaN(t)){if(isNaN(e[3]))return!1;e[3]=NaN}else{if(e[3]==t)return!1;e[3]=t}return!((t=+t)<0)&&(this.$invalidateTextField(),!0)}$getWidth(){let t=this.$propertyMap;return isNaN(t[3])?this.$getContentBounds().width:t[3]}$setHeight(t){let e=this.$propertyMap;if(isNaN(t)){if(isNaN(e[4]))return!1;e[4]=NaN}else{if(e[4]==t)return!1;e[4]=t}return!((t=+t)<0)&&(this.$invalidateTextField(),!0)}$getHeight(){let t=this.$propertyMap;return isNaN(t[4])?this.$getContentBounds().height:t[4]}$getLineHeight(){return this.$propertyMap[1]+this.$propertyMap[0]}invalidateFontString(){this.$propertyMap[17]=!0,this.$invalidateTextField()}$invalidateTextField(){this.$renderDirty=!0,this.$propertyMap[18]=!0;let t=this._parent;t&&!t.$cacheDirty&&(t.$cacheDirty=!0,t.$cacheDirtyUp());let e=this.$maskedObject;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp())}$getRenderBounds(){let e=this.$getContentBounds(),i=dou.recyclable(t.Rectangle);i.copy(e),this.$propertyMap[31]&&(i.width+=2,i.height+=2);let s=2*this.$propertyMap[27];return s>0&&(i.width+=2*s,i.height+=2*s),i.x-=s+2,i.y-=s+2,i.width=Math.ceil(i.width)+4,i.height=Math.ceil(i.height)+4,i}changeToPassText(t){if(this.$propertyMap[20]){let e="";for(let i=0,s=t.length;i<s;i++)switch(t.charAt(i)){case"\n":e+="\n";break;case"\r":break;default:e+="*"}return e}return t}setMiddleStyle(t){this.$propertyMap[18]=!0,this._textArr=t,this.$invalidateTextField()}setFocus(){1==this.type&&this._stage&&this._inputController.onFocus()}appendText(t){this.appendElement({text:t})}appendElement(t){let e=this.$propertyMap[13]+t.text;this.$propertyMap[20]?this.$setBaseText(e):(this.$propertyMap[13]=e,this._textArr.push(t),this.setMiddleStyle(this._textArr))}$getLinesArr(){let i=this.$propertyMap;if(!i[18])return this._linesArr;i[18]=!1;let s=this._textArr;this._linesArr.length=0,i[6]=0,i[5]=0;let r=i[3];if(!isNaN(r)&&0==r)return i[29]=0,[{width:0,height:0,charNum:0,elements:[],hasNextLine:!1}];let a,n=this._linesArr,h=0,o=0,l=0,c=0;for(let d=0,u=s.length;d<u;d++){let u=s[d];if(!u.text){a&&(a.width=h,a.height=l,a.charNum=o,i[5]=Math.max(i[5],h),i[6]+=l);continue}u.style=u.style||{};let g=u.text.toString().split(/(?:\r\n|\r|\n)/);for(let s=0,d=g.length;s<d;s++){null==n[c]&&(a={width:0,height:0,elements:[],charNum:0,hasNextLine:!1},n[c]=a,h=0,l=0,o=0),l=1==i[24]?i[0]:Math.max(l,u.style.size||i[0]);let p=!0;if(""==g[s])s==d-1&&(p=!1);else{let n=t.HtmlUtil.measureTextByStyle(g[s],i,u.style);if(isNaN(r))h+=n,o+=g[s].length,a.elements.push({width:n,text:g[s],style:u.style}),s==d-1&&(p=!1);else if(h+n<=r)a.elements.push({width:n,text:g[s],style:u.style}),h+=n,o+=g[s].length,s==d-1&&(p=!1);else{let l,c=0,d=0,f=g[s],_=(l=i[19]?f.split(e):f.match(/./g)).length,x=0;for(;c<_;c++){let e=l[c].length,s=!1;if(1==e&&c<_-1){let r=l[c].charCodeAt(0),a=l[c+1].charCodeAt(0);if(r>=55296&&r<=56319&&56320==(64512&a)){let r=l[c]+l[c+1];e=2,s=!0,n=t.HtmlUtil.measureTextByStyle(r,i,u.style)}else n=t.HtmlUtil.measureTextByStyle(l[c],i,u.style)}else n=t.HtmlUtil.measureTextByStyle(l[c],i,u.style);if(0!=h&&h+n>r&&h+c!=0)break;if(d+n>r){let e=l[c].match(/./g);for(let s=0,a=e.length;s<a;s++){let l=e[s].length,c=!1;if(1==l&&s<a-1){let r=e[s].charCodeAt(0),a=e[s+1].charCodeAt(0);if(r>=55296&&r<=56319&&56320==(64512&a)){let r=e[s]+e[s+1];l=2,c=!0,n=t.HtmlUtil.measureTextByStyle(r,i,u.style)}else n=t.HtmlUtil.measureTextByStyle(e[s],i,u.style)}else n=t.HtmlUtil.measureTextByStyle(e[s],i,u.style);if(s>0&&h+n>r)break;d+=n,h+=n,o+=x+=l,c&&s++}}else d+=n,h+=n,o+=x+=e;s&&c++}if(c>0){a.elements.push({width:d,text:f.substring(0,x),style:u.style});let t,e=f.substring(x),i=e.length;for(t=0;t<i&&" "==e.charAt(t);t++);g[s]=e.substring(t)}""!=g[s]&&(s--,p=!1)}}p&&(o++,a.hasNextLine=!0),s<g.length-1&&(a.width=h,a.height=l,a.charNum=o,i[5]=Math.max(i[5],h),i[6]+=l,c++)}d==s.length-1&&a&&(a.width=h,a.height=l,a.charNum=o,i[5]=Math.max(i[5],h),i[6]+=l)}return i[29]=n.length,n}$setIsTyping(t){this._isTyping=t,this.$invalidateTextField()}$setTouchEnabled(t){super.$setTouchEnabled(t),this.isInput()&&(this.$inputEnabled=!0)}isInput(){return 1==this.$propertyMap[24]}$onAddToStage(t,e){super.$onAddToStage(t,e),this.addEvent(),1==this.$propertyMap[24]&&this._inputController.addStageText()}$onRemoveFromStage(){super.$onRemoveFromStage(),this.removeEvent(),1==this.$propertyMap[24]&&this._inputController.removeStageText(),this._textNode&&this._textNode.clean()}addEvent(){this.on(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)}removeEvent(){this.off(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)}onTapHandler(e){if(1==this.$propertyMap[24])return;let i=t.TextFieldUtil.getTextElement(this,e.localX,e.localY);if(!i)return;let s=i.style;if(s&&s.href){if(s.href.match(/^event:/)){let i=s.href.match(/^event:/)[0],r={text:s.href.substring(i.length),stageX:e.stageX,stageY:e.stageY,localX:e.localX,localY:e.localY};this.dispatchEvent2D(t.Event2D.LINK,r)}else open(s.href,s.target||"_blank");this._linkPreventTap&&e.stopPropagation()}}$measureContentBounds(e){this.$getLinesArr();let i=0,s=0;i=isNaN(this.$propertyMap[3])?this.$propertyMap[5]:this.$propertyMap[3],s=isNaN(this.$propertyMap[4])?t.TextFieldUtil.getTextHeight(this):this.$propertyMap[4],e.set(0,0,i,s)}$updateRenderNode(){if(1==this.$propertyMap[24]){if(this._inputController.updateProperties(),this._isTyping)return void this.fillBackground()}else if(0==this.$propertyMap[3]){let t=this._graphicsNode;return void(t&&t.clear())}let t=this.drawText();this.fillBackground(t);let e=this.$getRenderBounds(),i=this._textNode;i.x=e.x,i.y=e.y,i.width=Math.ceil(e.width),i.height=Math.ceil(e.height),e.recycle()}fillBackground(e){let i=this._graphicsNode;i&&i.clear();let s=this.$propertyMap;if(s[33]||s[31]||e&&e.length>0){if(!i){i=this._graphicsNode=new t.rendering.GraphicsNode;let e=new t.rendering.GroupNode;e.addNode(i),e.addNode(this._textNode),this.$renderNode=e}let r,a;if(s[33]&&(r=i.beginFill(s[34])).drawRect(0,0,this.$getWidth(),this.$getHeight()),s[31]&&(a=i.lineStyle(1,s[32])).drawRect(0,0,this.$getWidth()-1,this.$getHeight()-1),e&&e.length>0){let t=s[2],r=-1,n=e.length;for(let s=0;s<n;s+=4){let n=e[s],h=e[s+1],o=e[s+2],l=e[s+3]||t;(r<0||r!=l)&&(r=l,a=i.lineStyle(2,l,1,"none")),a.moveTo(n,h),a.lineTo(n+o,h)}}}if(i){let t=this.$getRenderBounds();i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,t.recycle()}}drawText(){let e=this._textNode,s=this.$propertyMap;e.bold=s[15],e.fontFamily=s[8]||i.default_fontFamily,e.italic=s[16],e.size=s[0],e.stroke=s[27],e.strokeColor=s[25],e.textColor=s[2];let r=this.$getLinesArr();if(0==s[5])return[];let a=isNaN(s[3])?s[5]:s[3],n=t.TextFieldUtil.getTextHeight(this),h=0,o=t.TextFieldUtil.getStartLine(this),l=s[4];if(!isNaN(l)&&l>n){h+=t.TextFieldUtil.getValign(this)*(l-n)}h=Math.round(h);let c=t.TextFieldUtil.getHalign(this),d=0,u=[];for(let t=o,i=s[29];t<i;t++){let i=r[t],n=i.height;if(h+=n/2,t!=o){if(1==s[24]&&!s[30])break;if(!isNaN(l)&&h>l)break}d=Math.round((a-i.width)*c);for(let t=0,r=i.elements.length;t<r;t++){let r=i.elements[t],a=r.style.size||s[0],o=s[10];0==o?e.drawText(d,h-(n-a)/2,r.text,r.style):1==o?e.drawText(d,h,r.text,r.style):e.drawText(d,h+(n-a)/2,r.text,r.style),r.style.underline&&u.push(d,h+n/2,r.width,r.style.textColor),d+=r.width}h+=n/2+s[1]}return u}}i.default_fontFamily="Arial",i.default_size=30,i.default_textColor=16777215,t.TextField=i}(dou2d||(dou2d={})),function(t){class e extends t.SpriteSheet{constructor(t,e){super(t),this._firstCharHeight=0,this._charList="string"==typeof e?JSON.parse(e):e}getTexture(t){let e=this._textureMap[t];if(!e){let i=this._charList[t];if(!i)return null;e=this.createTexture(t,i.x,i.y,i.w,i.h,i.offX,i.offY,i.sourceW,i.sourceH),this._textureMap[t]=e}return e}getConfig(t,e){return this._charList[t]?this._charList[t][e]:0}getFirstCharHeight(){if(0==this._firstCharHeight)for(let t in this._charList){let e=this._charList[t];if(e){let t=e.sourceH;if(void 0===t){let i=e.h;void 0===i&&(i=0);let s=e.offY;void 0===s&&(s=0),t=i+s}if(t<=0)continue;this._firstCharHeight=t;break}}return this._firstCharHeight}}t.BitmapFont=e}(dou2d||(dou2d={})),function(t){class e extends t.DisplayObject{constructor(){super(),this._text="",this._smoothing=t.Bitmap.defaultSmoothing,this._lineSpacing=0,this._letterSpacing=0,this._textAlign=0,this._verticalAlign=0,this._textOffsetX=0,this._textOffsetY=0,this._textStartX=0,this._textStartY=0,this.$renderNode=new t.rendering.BitmapNode,this._textLines=[],this._lineHeights=[]}set text(t){this.$setText(t)}get text(){return this.$getText()}$setText(t){return(t=null==t?"":String(t))!=this._text&&(this._text=t,this.$invalidateContentBounds(),!0)}$getText(){return this._text}set font(t){this.$setFont(t)}get font(){return this.$getFont()}$setFont(t){return this._font!=t&&(this._font=t,this._fontStringChanged=!0,this.$invalidateContentBounds(),!0)}$getFont(){return this._font}set smoothing(t){this.$setSmoothing(t)}get smoothing(){return this.$getSmoothing()}$setSmoothing(t){if(t==this._smoothing)return;this._smoothing=t;let e=this.parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());let i=this.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())}$getSmoothing(){return this._smoothing}set lineSpacing(t){this.$setLineSpacing(t)}get lineSpacing(){return this.$getLineSpacing()}$setLineSpacing(t){return this._lineSpacing!=t&&(this._lineSpacing=t,this.$invalidateContentBounds(),!0)}$getLineSpacing(){return this._lineSpacing}set letterSpacing(t){this.$setLetterSpacing(t)}get letterSpacing(){return this.$getLetterSpacing()}$setLetterSpacing(t){return this._letterSpacing!=t&&(this._letterSpacing=t,this.$invalidateContentBounds(),!0)}$getLetterSpacing(){return this._letterSpacing}set textAlign(t){this.$setTextAlign(t)}get textAlign(){return this.$getTextAlign()}$setTextAlign(t){return this._textAlign!=t&&(this._textAlign=t,this.$invalidateContentBounds(),!0)}$getTextAlign(){return this._textAlign}set verticalAlign(t){this.$setVerticalAlign(t)}get verticalAlign(){return this.$getVerticalAlign()}$setVerticalAlign(t){return this._verticalAlign!=t&&(this._verticalAlign=t,this.$invalidateContentBounds(),!0)}$getVerticalAlign(){return this._verticalAlign}get textWidth(){return this.$getTextLines(),this._textWidth}get textHeight(){return this.$getTextLines(),this._textHeight}$setWidth(t){return!(t<0||t==this._textFieldWidth)&&(this._textFieldWidth=t,this.$invalidateContentBounds(),!0)}$getWidth(){let t=this._textFieldWidth;return isNaN(t)?this.$getContentBounds().width:t}$setHeight(t){return!(t<0||t==this._textFieldHeight)&&(this._textFieldHeight=t,this.$invalidateContentBounds(),!0)}$getHeight(){let t=this._textFieldHeight;return isNaN(t)?this.$getContentBounds().height:t}$invalidateContentBounds(){this.$renderDirty=!0,this._textLinesChanged=!0,this.$updateRenderNode()}$measureContentBounds(t){0==this.$getTextLines().length?t.clear():t.set(this._textOffsetX+this._textStartX,this._textOffsetY+this._textStartY,this._textWidth-this._textOffsetX,this._textHeight-this._textOffsetY)}$updateRenderNode(){let t=this.$getTextLines(),i=t.length;if(0==i)return;let s=this._textLinesWidth,r=this._font,a=this.$renderNode;r.texture&&(a.image=r.texture.bitmapData),a.smoothing=this._smoothing;let n=r.getFirstCharHeight(),h=Math.ceil(n*e.EMPTY_FACTOR),o=!isNaN(this._textFieldHeight),l=this._textWidth,c=this._textFieldWidth,d=this._textFieldHeight,u=this._textAlign,g=this._textOffsetY+this._textStartY,p=this._lineHeights;for(let e=0;e<i;e++){let i=p[e];if(o&&e>0&&g+i>d)break;let n=t[e],f=n.length,_=this._textOffsetX;if(0!=u){let t=c>l?c:l;2==u?_+=t-s[e]:1==u&&(_+=Math.floor((t-s[e])/2))}for(let t=0;t<f;t++){let e=n.charAt(t),i=r.getTexture(e);if(!i){" "==e?_+=h:console.warn(`BitmapText no corresponding characters: ${e}, please check the configuration file.`);continue}let s=i.bitmapWidth,o=i.bitmapHeight;a.imageWidth=i.sourceWidth,a.imageHeight=i.sourceHeight,a.drawImage(i.bitmapX,i.bitmapY,s,o,_+i.offsetX,g+i.offsetY,i.$getScaleBitmapWidth(),i.$getScaleBitmapHeight()),_+=(r.getConfig(e,"xadvance")||i.$getTextureWidth())+this._letterSpacing}g+=i+this._lineSpacing}}$getTextLines(){function t(t){return!(_&&i.length>0&&g>_)&&(g+=h+c,a||n||(o-=d),i.push(t),r.push(h),s.push(o),u=Math.max(o,u),!0)}if(!this._textLinesChanged)return this._textLines;let i=[];this._textLines=i;let s=[];this._textLinesWidth=s,this._textLinesChanged=!1;let r=[];if(this._lineHeights=r,!this._text||!this._font)return this._textWidth=0,this._textHeight=0,i;let a,n,h,o,l,c=this._lineSpacing,d=this._letterSpacing,u=0,g=0,p=!isNaN(this._textFieldWidth),f=this._textFieldWidth,_=this._textFieldHeight,x=this._font,m=x.getFirstCharHeight(),y=Math.ceil(m*e.EMPTY_FACTOR),$=this._text.split(/(?:\r\n|\r|\n)/),T=$.length,b=!0;for(let e=0;e<T;e++){let i=$[e],s=i.length;h=0,o=0,a=!0,n=!1;for(let e=0;e<s;e++){a||(o+=d);let r,n,l=i.charAt(e),c=x.getTexture(l);if(c)r=c.$getTextureWidth(),n=c.$getTextureHeight();else{if(" "!=l){console.warn(`BitmapText no corresponding characters: ${l}, please check the configuration file.`),a&&(a=!1);continue}r=y,n=m}if(a&&(a=!1),b&&(b=!1),p&&e>0&&o+r>f){if(!t(i.substring(0,e)))break;s=(i=i.substring(e)).length,o=(e=0)==s-1?r:x.getConfig(l,"xadvance")||r,h=n}else o+=e==s-1?r:x.getConfig(l,"xadvance")||r,h=Math.max(n,h)}if(_&&e>0&&g>_)break;if(n=!0,!t(i))break}return g-=c,this._textWidth=u,this._textHeight=g,this._textOffsetX=0,this._textOffsetY=0,this._textStartX=0,this._textStartY=0,f>u&&(2==(l=this._textAlign)?this._textStartX=f-u:1==l&&(this._textStartX=Math.floor((f-u)/2))),_>g&&(2==(l=this._verticalAlign)?this._textStartY=_-g:1==l&&(this._textStartY=Math.floor((_-g)/2))),i}}e.EMPTY_FACTOR=.33,t.BitmapText=e}(dou2d||(dou2d={})),function(t){let e;!function(t){const e=/^(color|textcolor|strokecolor|stroke|b|bold|i|italic|u|size|fontfamily|href|target)(\s)*=/,i=[[/&lt;/g,"<"],[/&gt;/g,">"],[/&amp;/g,"&"],[/&quot;/g,'"'],[/&apos;/g,"'"]];function s(t,e,i){""!=t&&(t=n(t),e.length>0?i.push({text:t,style:e[e.length-1]}):i.push({text:t}))}function r(t,i){let s=function(t){t=t.trim();let i={},s=[];if("i"==t.charAt(0)||"b"==t.charAt(0)||"u"==t.charAt(0))a(i,t,"true");else if(s=t.match(/^(font|a)\s/)){t=t.substring(s[0].length).trim();let r,n=0;for(;r=t.match(e);){let e=r[0],s="";'"'==(t=t.substring(e.length).trim()).charAt(0)?(n=t.indexOf('"',1),s=t.substring(1,n),n+=1):"'"==t.charAt(0)?(n=t.indexOf("'",1),s=t.substring(1,n),n+=1):(s=t.match(/(\S)+/)[0],n=s.length),a(i,e.substring(0,e.length-1).trim(),s.trim()),t=t.substring(n).trim()}}return i}(t);if(0==i.length)i.push(s);else{let t=i[i.length-1];for(let e in t)null==s[e]&&(s[e]=t[e]);i.push(s)}}function a(t,e,i){switch(e.toLowerCase()){case"color":case"textcolor":i=i.replace(/#/,"0x"),t.textColor=parseInt(i);break;case"strokecolor":i=i.replace(/#/,"0x"),t.strokeColor=parseInt(i);break;case"stroke":t.stroke=parseInt(i);break;case"b":case"bold":t.bold="true"==i;break;case"u":t.underline="true"==i;break;case"i":case"italic":t.italic="true"==i;break;case"size":t.size=parseInt(i);break;case"fontfamily":t.fontFamily=i;break;case"href":t.href=n(i);break;case"target":t.target=n(i)}}function n(t){for(let e=0;e<i.length;e++){let s=i[e][0],r=i[e][1];t=t.replace(s,r)}return t}t.parse=function(t){let e=[],i=[],a=0,n=t.length;for(;a<n;){let h=t.indexOf("<",a);if(h<0)s(t.substring(a),i,e),a=n;else{s(t.substring(a,h),i,e);let n=t.indexOf(">",h);-1==n?(console.error("XML format error!"),n=h):"/"==t.charAt(h+1)?i.pop():r(t.substring(h+1,n),i),a=n+1}}return e}}(e=t.HtmlTextParser||(t.HtmlTextParser={}))}(dou2d||(dou2d={})),function(t){!function(e){e.TouchHandler=class{constructor(i,s){this._scaleX=1,this._scaleY=1,this._rotation=0,this.onTouchBegin=t=>{let e=this.getLocation(t);this._touch.onTouchBegin(e.x,e.y,t.identifier)},this.onTouchMove=t=>{0==t.buttons?this.onTouchEnd(t):this.touchMove(t)},this.touchMove=t=>{let e=this.getLocation(t);this._touch.onTouchMove(e.x,e.y,t.identifier)},this.onTouchEnd=t=>{let e=this.getLocation(t);this._touch.onTouchEnd(e.x,e.y,t.identifier)},this._canvas=s,this._touch=new e.TouchHandlerImpl(i),this._point=new t.Point,this.addListeners()}addListeners(){t.Capabilities.isMobile||this.addMouseListener(),this.addTouchListener()}addMouseListener(){this._canvas.addEventListener("mousedown",this.onTouchBegin),this._canvas.addEventListener("mousemove",this.onTouchMove),this._canvas.addEventListener("mouseup",this.onTouchEnd)}addTouchListener(){this._canvas.addEventListener("touchstart",t=>{let e=t.changedTouches.length;for(let i=0;i<e;i++)this.onTouchBegin(t.changedTouches[i]);this.prevent(t)},!1),this._canvas.addEventListener("touchmove",t=>{let e=t.changedTouches.length;for(let i=0;i<e;i++)this.touchMove(t.changedTouches[i]);this.prevent(t)},!1),this._canvas.addEventListener("touchend",t=>{let e=t.changedTouches.length;for(let i=0;i<e;i++)this.onTouchEnd(t.changedTouches[i]);this.prevent(t)},!1),this._canvas.addEventListener("touchcancel",t=>{let e=t.changedTouches.length;for(let i=0;i<e;i++)this.onTouchEnd(t.changedTouches[i]);this.prevent(t)},!1)}prevent(t){t.stopPropagation(),1==t.isScroll||this._canvas.userTyping||t.preventDefault()}getLocation(t){t.identifier=+t.identifier||0;let e=document.documentElement,i=this._canvas.getBoundingClientRect(),s=i.left+window.pageXOffset-e.clientLeft,r=i.top+window.pageYOffset-e.clientTop,a=t.pageX-s,n=a,h=t.pageY-r,o=h;return 90==this._rotation?(n=h,o=i.width-a):-90==this._rotation&&(n=i.height-h,o=a),n/=this._scaleX,o/=this._scaleY,this._point.set(Math.round(n),Math.round(o))}updateScaleMode(t,e,i){this._scaleX=t,this._scaleY=e,this._rotation=i}updateMaxTouches(){this._touch.initMaxTouches()}}}(t.touch||(t.touch={}))}(dou2d||(dou2d={})),function(t){!function(e){e.TouchHandlerImpl=class{constructor(t){this._maxTouches=0,this._useTouchesCount=0,this._lastTouchX=-1,this._lastTouchY=-1,this._stage=t,this._touchDownTarget={}}initMaxTouches(){this._maxTouches=this._stage.maxTouches}onTouchBegin(e,i,s){if(this._useTouchesCount>=this._maxTouches)return;this._lastTouchX=e,this._lastTouchY=i;let r=this.findTarget(e,i);null==this._touchDownTarget[s]&&(this._touchDownTarget[s]=r,this._useTouchesCount++),r.dispatchTouchEvent(t.TouchEvent.TOUCH_BEGIN,e,i,s,!0,!0,!0)}onTouchMove(e,i,s){if(null==this._touchDownTarget[s])return;if(this._lastTouchX==e&&this._lastTouchY==i)return;this._lastTouchX=e,this._lastTouchY=i,this.findTarget(e,i).dispatchTouchEvent(t.TouchEvent.TOUCH_MOVE,e,i,s,!0,!0,!0)}onTouchEnd(e,i,s){if(null==this._touchDownTarget[s])return;let r=this.findTarget(e,i),a=this._touchDownTarget[s];delete this._touchDownTarget[s],this._useTouchesCount--,r.dispatchTouchEvent(t.TouchEvent.TOUCH_END,e,i,s,!1,!0,!0),a==r?r.dispatchTouchEvent(t.TouchEvent.TOUCH_TAP,e,i,s,!1,!0,!0):a.dispatchTouchEvent(t.TouchEvent.TOUCH_RELEASE_OUTSIDE,e,i,s,!1,!0,!0)}findTarget(t,e){let i=this._stage.$hitTest(t,e);return i||(i=this._stage),i}}}(t.touch||(t.touch={}))}(dou2d||(dou2d={})),function(t){let e;t.callLater=function(t,i,...s){e.callLater(t,i,...s)},t.callLaterUnique=function(t,i,...s){e.callLaterUnique(t,i,...s)},function(t){let e=[],i=[],s=[],r=[],a=[],n=[];t.updateCallLater=function(){if(e.length>0){let t=e,r=i,a=s;e=[],i=[],s=[];for(let e=0,i=t.length;e<i;e++)t[e].apply(r[e],...a[e])}if(r.length>0){let t=r,e=a,i=n;r=[],a=[],n=[];for(let s=0,r=t.length;s<r;s++)t[s].apply(e[s],...i[s])}},t.callLater=function(t,r,...a){e.push(t),i.push(r),s.push(a)},t.callLaterUnique=function(t,e,...i){for(let i=0,s=r.length;i<s;i++)if(r[i]===t&&a[i]===e)return;r.push(t),a.push(e),n.push(i)}}(e=t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){let e;t.setTimeout=function(t,i,s,...r){return e.setTimeout(t,i,s,...r)},t.clearTimeout=function(t){e.clearTimeout(t)},function(t){let e=0,i={},s=0;function r(t){i[t]&&(delete i[t],--s)}t.updateTimeout=function(t){if(s>0)for(let e in i){let s=i[e];s.delay-=t,s.delay<=0&&(r(+e),s.method.apply(s.thisObj,...s.args))}},t.setTimeout=function(t,r,a,...n){let h={method:t,thisObj:r,delay:a,args:n};return i[e++]=h,++s,e},t.clearTimeout=r}(e=t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){let e;t.setInterval=function(t,i,s,...r){return e.setInterval(t,i,s,...r)},t.clearInterval=function(t){return e.clearInterval(t)},function(t){let e=0,i={},s=0;t.updateInterval=function(t){if(s>0)for(let e in i){let s=i[e];s.delay-=t,s.delay<=0&&(s.delay=s.originDelay,s.method.apply(s.thisObj,...s.args))}},t.setInterval=function(t,r,a,...n){let h={method:t,thisObj:r,delay:a,args:n,originDelay:a};return i[e++]=h,++s,e},t.clearInterval=function(t){i[t]&&(delete i[t],--s)}}(e=t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){let e;!function(t){t.PI_HALF=.5*Math.PI,t.PI_QUARTER=.25*Math.PI,t.PI_DOUBLE=2*Math.PI,t.RAD_DEG=180/Math.PI,t.DEG_RAD=Math.PI/180,t.SQRT_2=1.4142135623731,t.SQRT1_2=.5*t.SQRT_2,t.clamp=function(t,e=0,i=1){return t<e?e:t>i?i:t},t.lerp=function(t,e,i){return t+(e-t)*i},t.toRadians=function(t){return t*Math.PI/180},t.toDegrees=function(t){return 180*t/Math.PI},t.clampAngle=function(t){return(t%=2*Math.PI)<0&&(t+=2*Math.PI),t},t.clampRotation=function(t){return(t%=360)>180?t-=360:t<-180&&(t+=360),t}}(e=t.MathUtil||(t.MathUtil={}))}(dou2d||(dou2d={})),function(t){let e;!function(e){let i;function s(t,e){return t.measureText(e).width}function r(t,e){if(t in e)return"";t=t.charAt(0).toUpperCase()+t.substring(1,t.length);let i=["webkit","ms","Moz","O"];for(let s=0;s<i.length;s++){if(i[s]+t in e)return i[s]}return""}e.createCanvas=function(t,e){let i=document.createElement("canvas");return isNaN(t)||(i.width=t),isNaN(e)||(i.height=e),i},e.get2DContext=function(t){return t.getContext("2d")},e.getWebGLContext=function(t,e=!1,i=!1){let s,r=["webgl","experimental-webgl"];try{for(let a=0;a<r.length&&!(s=t.getContext(r[a],{antialias:e,stencil:i}));a++);}catch(t){}return s||console.log("Nonsupport WebGL!"),s},e.resizeContext=function(t,e,i,s){let r=t.surface;s?(r.width<e&&(r.width=e),r.height<i&&(r.height=i)):(r.width!==e&&(r.width=e),r.height!==i&&(r.height=i)),t.onResize()},e.measureTextByStyle=function(i,s,r){let a=(r=r||{}).italic?r.italic:s[16],n=r.bold?r.bold:s[15],h=r.size?r.size:s[0],o=r.fontFamily||s[8]||t.TextField.default_fontFamily;return e.measureText(i,o,h,n,a)},e.measureText=function(e,i,r,a,n){let h="";return n&&(h+="italic "),a&&(h+="bold "),h+=(r||12)+"px ",h+=i||"Arial",t.sys.context2D.font=h,s(t.sys.context2D,e)},e.measureTextWidth=s,e.getStyleName=function(t,e){let s="";if(e)s=r(t,e);else{if(!i){let t=document.createElement("div").style;i=r("transform",t)}s=i}return""==s?t:s+t.charAt(0).toUpperCase()+t.substring(1,t.length)},e.getFontString=function(t,e){let i=(null==e.italic?t.italic:e.italic)?"italic ":"normal ";return i+=(null==e.bold?t.bold:e.bold)?"bold ":"normal ",i+=(null==e.size?t.size:e.size)+"px "+(e.fontFamily||t.fontFamily)},e.toColorString=function(t){t<0&&(t=0),t>16777215&&(t=16777215);let e=t.toString(16).toUpperCase();for(;e.length>6;)e=e.slice(1,e.length);for(;e.length<6;)e="0"+e;return"#"+e}}(e=t.HtmlUtil||(t.HtmlUtil={}))}(dou2d||(dou2d={})),function(t){let e;!function(e){e.createTexture=function(e,i,s,r){let a=e.context,n=a.createTexture();if(n)return n[t.sys.glContext]=a,a.bindTexture(a.TEXTURE_2D,n),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),n[t.sys.unpackPremultiplyAlphaWebgl]=!0,"number"==typeof i?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,i,s,0,a.RGBA,a.UNSIGNED_BYTE,r):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),n;e.contextLost=!0},e.deleteTexture=function(e){if(e[t.sys.engineDefaultEmptyTexture])return void 0;let i=e[t.sys.glContext];i&&i.deleteTexture(e)},e.premultiplyTint=function(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;let i=t>>16&255,s=t>>8&255,r=255&t;return(255*e<<24)+((i=i*e+.5|0)<<16)+((s=s*e+.5|0)<<8)+(r=r*e+.5|0)}}(e=t.WebGLUtil||(t.WebGLUtil={}))}(dou2d||(dou2d={})),function(t){let e;!function(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256);for(let t=0;t<e.length;t++)i[e.charCodeAt(t)]=t;t.encode=function(t){let i=new Uint8Array(t),s=i.length,r="";for(let t=0;t<s;t+=3)r+=e[i[t]>>2],r+=e[(3&i[t])<<4|i[t+1]>>4],r+=e[(15&i[t+1])<<2|i[t+2]>>6],r+=e[63&i[t+2]];return s%3==2?r=r.substring(0,r.length-1)+"=":s%3==1&&(r=r.substring(0,r.length-2)+"=="),r},t.decode=function(t){let e=.75*t.length,s=t.length,r=0,a=0,n=0,h=0,o=0;"="===t[t.length-1]&&(e--,"="===t[t.length-2]&&e--);let l=new ArrayBuffer(e),c=new Uint8Array(l);for(let e=0;e<s;e+=4)a=i[t.charCodeAt(e)],n=i[t.charCodeAt(e+1)],h=i[t.charCodeAt(e+2)],o=i[t.charCodeAt(e+3)],c[r++]=a<<2|n>>4,c[r++]=(15&n)<<4|h>>2,c[r++]=(3&h)<<6|63&o;return l}}(e=t.Base64Util||(t.Base64Util={}))}(dou2d||(dou2d={})),function(t){const e={};t.registerImplementation=function(t,i){e[t]=i},t.getImplementation=function(t){return e[t]}}(dou2d||(dou2d={})),function(t){let e;!function(t){t.engineVersion="0.1.0",t.os="Unknown",t.init=function(){let e=navigator.userAgent.toLowerCase();t.isMobile=-1!=e.indexOf("mobile")||-1!=e.indexOf("android"),t.isMobile?e.indexOf("windows")<0&&(-1!=e.indexOf("iphone")||-1!=e.indexOf("ipad")||-1!=e.indexOf("ipod"))?t.os="iOS":-1!=e.indexOf("android")&&-1!=e.indexOf("linux")?t.os="Android":-1!=e.indexOf("windows")&&(t.os="Windows Phone"):-1!=e.indexOf("windows nt")?t.os="Windows PC":-1!=e.indexOf("mac os")&&(t.os="Mac OS");let i=navigator.language.toLowerCase(),s=i.split("-");s.length>1&&(s[1]=s[1].toUpperCase()),i=s.join("-")}}(e=t.Capabilities||(t.Capabilities={}))}(dou2d||(dou2d={})),function(t){let e;!function(t){t.getStartLine=function(e){let i=e.$propertyMap,s=t.getTextHeight(e),r=0,a=i[4];return isNaN(a)||(s<a||s>a&&(r=Math.max(i[28]-1,0),r=Math.min(i[29]-1,r)),i[30]||(r=Math.max(i[28]-1,0),i[29]>0&&(r=Math.min(i[29]-1,r)))),r},t.getHalign=function(t){let e=t.$getLinesArr(),i=0;return 1==t.$propertyMap[9]?i=.5:2==t.$propertyMap[9]&&(i=1),1==t.$propertyMap[24]&&!t.$propertyMap[30]&&e.length>1&&(i=0),i},t.getTextHeight=function(t){return 1!=t.$propertyMap[24]||t.$propertyMap[30]?t.$propertyMap[6]+(t.$propertyMap[29]-1)*t.$propertyMap[1]:t.$propertyMap[0]},t.getValign=function(e){let i=t.getTextHeight(e),s=e.$propertyMap[4];if(!isNaN(s)&&i<s){let t=0;return 1==e.$propertyMap[10]?t=.5:2==e.$propertyMap[10]&&(t=1),t}return 0},t.getTextElement=function(e,i,s){let r=t.getHit(e,i,s),a=e.$getLinesArr();return r&&a[r.lineIndex]&&a[r.lineIndex].elements[r.textElementIndex]?a[r.lineIndex].elements[r.textElementIndex]:null},t.getHit=function(e,i,s){let r=e.$getLinesArr();if(0==e.$propertyMap[3])return null;let a=0,n=t.getTextHeight(e),h=0,o=e.$propertyMap[4];if(!isNaN(o)&&o>n){0!=(h=t.getValign(e)*(o-n))&&(s-=h)}let l=0;for(let i=t.getStartLine(e);i<r.length;i++){let t=r[i];if(l+t.height>=s){l<s&&(a=i+1);break}if((l+=t.height)+e.$propertyMap[1]>s)return null;l+=e.$propertyMap[1]}if(0==a)return null;let c=r[a-1],d=e.$propertyMap[3];isNaN(d)&&(d=e.textWidth),i-=t.getHalign(e)*(d-c.width);let u=0;for(let t=0;t<c.elements.length;t++){let e=c.elements[t];if(u+e.width<=i)u+=e.width;else if(u<i)return{lineIndex:a-1,textElementIndex:t}}return null},t.getScrollNum=function(t){let e=1;if(t.$propertyMap[30]){let i=t.height,s=t.size,r=t.lineSpacing;i-(s+r)*(e=Math.floor(i/(s+r)))>s/2&&e++}return e}}(e=t.TextFieldUtil||(t.TextFieldUtil={}))}(dou2d||(dou2d={})),function(t){let e;!function(t){let e,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=new Array(36),r=0;t.generate=function(){for(let t=0;t<36;t++)8===t||13===t||18===t||23===t?s[t]="-":14===t?s[t]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,s[t]=i[19===t?3&e|8:e]);return s.join("")}}(e=t.UUID||(t.UUID={}))}(dou2d||(dou2d={})),function(t){let e;t.Time=class{static get time(){return dou.getTimer()}static get deltaTime(){return e.deltaTime}static set fixedDeltaTime(t){e.fixedDeltaTime=t}static get fixedDeltaTime(){return e.fixedDeltaTime}},function(t){t.deltaTime=0,t.fixedDeltaTime=50,t.fixedPassedTime=0}(e=t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){let e;!function(e){e.quadratic=function(e,i,s,r,a){return a||(a=dou.recyclable(t.Point)),a.x=(1-e)*(1-e)*i.x+2*e*(1-e)*s.x+e*e*r.x,a.y=(1-e)*(1-e)*i.y+2*e*(1-e)*s.y+e*e*r.y,a},e.cube=function(e,i,s,r,a,n){n||(n=dou.recyclable(t.Point));let h=1-e;return n.x=i.x*Math.pow(h,3)+3*s.x*Math.pow(h,2)*e+3*r.x*Math.pow(e,2)*h+a.x*Math.pow(e,3),n.y=i.y*Math.pow(h,3)+3*s.y*Math.pow(h,2)*e+3*r.y*Math.pow(e,2)*h+a.y*Math.pow(e,3),n}}(e=t.BezierUtil||(t.BezierUtil={}))}(dou2d||(dou2d={})),function(t){!function(t){t.Stat=class{setListener(t,e){this._method=t,this._thisObj=e}onFrame(t,e,i){this._method&&this._method.call(this._thisObj,t,e,i)}}}(t.sys||(t.sys={}))}(dou2d||(dou2d={})),function(t){class e extends t.DisplayObjectContainer{constructor(){super(),this._time=0,this._frame=0,this._drawCalls=0,this._logicTime=0,this._renderTime=0,this._label=new t.TextField,this._label.text="FPS: 0\rDraw: 0\rLogic: 0ms\rRender: 0ms",this._label.size=20,this._label.textColor=16777215,this._label.strokeColor=0,this._label.stroke=1,this.addChild(this._label),t.sys.stat.setListener(this.receive,this),t.sys.stage.addChild(this)}receive(e,i,s){if(this._time+=t.Time.deltaTime,this._frame+=1,this._drawCalls+=s,this._logicTime+=e,this._renderTime+=i,this._frame==t.sys.stage.frameRate){let t=.001*this._time,e=(this._frame/t).toFixed(1),i=Math.ceil(this._drawCalls/this._frame),s=Math.ceil(this._logicTime/this._frame),r=Math.ceil(this._renderTime/this._frame);this._label.text=`FPS: ${e}\rDraw: ${i}\rLogic: ${s}ms\rRender: ${r}ms`,this._time=0,this._frame=0,this._drawCalls=0,this._logicTime=0,this._renderTime=0}}}t.StatPanel=e}(dou2d||(dou2d={})),function(t){t.Engine=class{constructor(t,e,i){this.init(t,e,i)}init(e,i,s){i||((i=document.createElement("div")).style.position="fixed",i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="100%",document.body.appendChild(i)),this._container=i;let r=this._options=this.readOptions(e,s);t.sys.stage=new t.Stage(this),t.sys.screenAdapter=r.screenAdapter,t.sys.renderer=new t.rendering.Renderer;let a=new t.rendering.RenderBuffer(void 0,void 0,!0);t.sys.canvas=a.surface,this.attachCanvas(this._container,t.sys.canvas),t.sys.context2D=t.HtmlUtil.get2DContext(t.HtmlUtil.createCanvas(2,2)),this._touchHandler=new t.touch.TouchHandler(t.sys.stage,t.sys.canvas),t.sys.inputManager=new t.input.InputManager,t.sys.inputManager.initStageDelegateDiv(this._container,t.sys.canvas),t.sys.player=new t.sys.Player(a,t.sys.stage,r.rootClass),t.sys.player.start(),t.sys.ticker=new t.sys.Ticker,this.startTicker(),t.sys.stage.scaleMode=r.scaleMode,t.sys.stage.orientation=r.orientation,t.sys.stage.maxTouches=r.maxTouches,t.sys.stage.frameRate=r.frameRate,t.sys.stage.textureScaleFactor=r.textureScaleFactor,this.updateScreenSize(),window.addEventListener("resize",()=>{window.setTimeout(()=>{this.updateScreenSize()},300)}),t.sys.stat=new t.sys.Stat}readOptions(e,i){return i||(i={}),{rootClass:e,contentWidth:i.contentWidth||480,contentHeight:i.contentHeight||800,scaleMode:i.scaleMode||"showAll",orientation:i.orientation||"auto",maxTouches:i.maxTouches||2,frameRate:i.frameRate||60,antialias:i.antialias||!1,screenAdapter:i.screenAdapter||new t.DefaultScreenAdapter,textureScaleFactor:i.canvasScaleFactor?i.canvasScaleFactor(t.sys.canvas.getContext("2d")):1}}attachCanvas(t,e){let i=e.style;i.cursor="inherit",i.position="absolute",i.top="0",i.bottom="0",i.left="0",i.right="0",t.appendChild(e),(i=t.style).overflow="hidden",i.position="absolute"}startTicker(){requestAnimationFrame((function e(){t.sys.ticker.update(),requestAnimationFrame(e)}))}setContentSize(t,e){let i=this._options;i.contentWidth=t,i.contentHeight=e,this.updateScreenSize()}updateScreenSize(){let e=t.sys.canvas,i=this._options,s=this._container.getBoundingClientRect(),r=0,a=s.width,n=s.height;if(0==a||0==n)return;s.top<0&&(n+=s.top,r=-s.top);let h=!1,o=t.sys.stage.orientation;"auto"!=o&&(h="portrait"!=o&&n>a||"portrait"==o&&a>n);let l=h?n:a,c=h?a:n;t.Capabilities.boundingClientWidth=l,t.Capabilities.boundingClientHeight=c;let d=t.sys.screenAdapter.calculateStageSize(t.sys.stage.scaleMode,l,c,i.contentWidth,i.contentHeight),u=d.stageWidth,g=d.stageHeight,p=d.displayWidth,f=d.displayHeight;e.style[t.HtmlUtil.getStyleName("transformOrigin")]="0% 0% 0px",e.width!=u&&(e.width=u),e.height!=g&&(e.height=g);let _=0;h?"landscape"==o?(_=90,e.style.top=r+(n-p)/2+"px",e.style.left=(a+f)/2+"px"):(_=-90,e.style.top=r+(n+p)/2+"px",e.style.left=(a-f)/2+"px"):(e.style.top=r+(n-f)/2+"px",e.style.left=(a-p)/2+"px");let x=p/u,m=f/g,y=x*t.rendering.DisplayList.canvasScaleFactor,$=m*t.rendering.DisplayList.canvasScaleFactor,T=dou.recyclable(t.Matrix);T.scale(x/y,m/$),T.rotate(_*Math.PI/180);let b=`matrix(${T.a},${T.b},${T.c},${T.d},${T.tx},${T.ty})`;T.recycle(),e.style[t.HtmlUtil.getStyleName("transform")]=b,t.rendering.DisplayList.setCanvasScale(y,$),this._touchHandler.updateScaleMode(x,m,_),t.sys.inputManager.updateSize(),t.sys.player.updateStageSize(u,g)}updateMaxTouches(t){this._touchHandler.updateMaxTouches()}}}(dou2d||(dou2d={}));